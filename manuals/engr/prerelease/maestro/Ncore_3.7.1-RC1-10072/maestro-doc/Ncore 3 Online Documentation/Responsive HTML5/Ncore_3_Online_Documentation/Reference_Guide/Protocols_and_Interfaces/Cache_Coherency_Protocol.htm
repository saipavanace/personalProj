<html lang="en-US">
<head>
<meta content="IE=edge" http-equiv="X-UA-Compatible" />
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
<title>Cache_Coherency_Protocol</title>
<meta content="Cache Coherency Protocol" name="title_original" />
<link href="../../../rhstylemapping.css" rel="stylesheet" type="text/css" />
<link href="../Reference_Guide.css" rel="stylesheet" type="text/css" />
<link href="../../../editstyle.css" rel="stylesheet" type="text/css" /><script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
p.WebHelpNavBar { text-align:right; }
-->
</style>
 <meta name="generator" content="Adobe FrameMaker v17.0" />
<script type="text/javascript" src="../../../template/scripts/rh.min.js"></script>
<script type="text/javascript" src="../../../template/scripts/common.min.js"></script>
<script type="text/javascript" src="../../../template/scripts/topic.min.js"></script>
<script type="text/javascript" src="../../../template/scripts/constants.js"></script>
<script type="text/javascript" src="../../../template/scripts/utils.js"></script>
<script type="text/javascript" src="../../../template/scripts/mhutils.js"></script>
<script type="text/javascript" src="../../../template/scripts/mhlang.js"></script>
<script type="text/javascript" src="../../../template/scripts/mhver.js"></script>
<script type="text/javascript" src="../../../template/scripts/settings.js"></script>
<script type="text/javascript" src="../../../template/scripts/XmlJsReader.js"></script>
<script type="text/javascript" src="../../../template/scripts/loadparentdata.js"></script>
<script type="text/javascript" src="../../../template/scripts/loadscreen.js"></script>
<script type="text/javascript" src="../../../template/scripts/loadprojdata.js"></script>
<script type="text/javascript" src="../../../template/scripts/mhtopic.js"></script>
 <link rel="stylesheet" type="text/css" href="../../../template/styles/topic.min.css">
<script type="text/javascript" >
gRootRelPath = "../../..";
gCommonRootRelPath = "../../..";
gTopicId = "4.2.1";
</script>
 <meta name="brsprev" value="Ncore_3_Online_Documentation/Reference_Guide/Protocols_and_Interfaces/Protocols_and_Interfaces.htm">
 <meta name="brsnext" value="Ncore_3_Online_Documentation/Reference_Guide/Protocols_and_Interfaces/Supported_Protocols.htm">
 <meta name="topic-breadcrumbs" content="Reference Guide > Ncore 3 Protocol" />
</head>
<body dir="ltr">
<script type="text/javascript" src="../../../ehlpdhtm.js"></script>
<div><p class="Heading1" id="1004400"><a id="1086_Heading1_1004400" name="1086_Heading1_1004400"></a>2.1 <a id="XREF_87084__2_1_Cache_Coherency_Protocol20" name="XREF_87084__2_1_Cache_Coherency_Protocol20">Cache Coherency Protocol</a></p><p class="BodyAfterHead" id="1004401"><a id="1086_BodyAfterHead_1004401" name="1086_BodyAfterHead_1004401"></a>Ncore components communicate and enforce cache coherence via the Arteris cache coherence protocol, which defines several protocol transactions, each of which accesses a single directory cache line, classified as follows&#x3A;</p><p class="Bullet_1" id="1004402"><span class="BulletSymbol">&#x2022; </span>A coherent read transaction fetches a coherent copy of data for an agent and may or may not invalidate copies in other caching agents</p><p class="Bullet_1" id="1004403"><span class="BulletSymbol">&#x2022; </span>A coherent clean transaction transfers any modified data from a caching agent to memory and may or may not invalidate the copies in other caching agents</p><p class="Bullet_1" id="1004404"><span class="BulletSymbol">&#x2022; </span>A coherent write transaction transfers any modified data from a caching agent to memory, invalidating copies in other caching agents</p><p class="Bullet_1" id="1004405"><span class="BulletSymbol">&#x2022; </span>A memory update transaction transfers modified data from a caching agent to memory but does not invalidate the copies in the other caching agents</p><p class="BodyAfterHead" id="1004406">At a high level, each native transaction received by a CAIU or an NCAIU will be translated into one or more protocol transactions, based on the alignment and length of the original coherent transaction. Protocol transactions will be completed in accordance with the requirements of the original native protocol, including sequencing responses from multiple transactions, if necessary. </p><p class="BodyAfterHead" id="1004407">Each transaction consists of one or more protocol messages, divided into protocol control messages and protocol data messages exchanged between pairs of Ncore components. For brevity the following section refers to CAIU and NCAIU as AIU. Protocol control messages are classified as follows&#x3A;</p><p class="Bullet_1" id="1004408"><span class="BulletSymbol">&#x2022; </span>A command message (CMD) initiates a coherent or non&#x2D;coherent transaction. CMD flows between AIU and DCE&#47;DMI&#47;DII&#47;DVE.</p><p class="Bullet_1" id="1004409"><span class="BulletSymbol">&#x2022; </span>A snoop message (SNP) transmits coherence operations to caching agents and consists of a request and response phase. SNP flows between DCE&#47;DVE and AIU.</p><p class="Bullet_1" id="1004410"><span class="BulletSymbol">&#x2022; </span>A memory read message (MRD) performs a non&#x2D;speculative memory read. MRD flows between DCE and DMI.</p><p class="Bullet_1" id="1004411"><span class="BulletSymbol">&#x2022; </span>A request buffer message (RB) handles memory write buffer allocation. RB flows between DCE and DMI.</p><p class="Bullet_1" id="1004412"><span class="BulletSymbol">&#x2022; </span>A state reply message (STR) communicates transaction progress information to the requesting agent and consists of a request and response phase. STR flows between DCE&#47;DMI&#47;DII and AIU.</p><p class="Bullet_1" id="1004413"><span class="BulletSymbol">&#x2022; </span>An update message (UPD) communicates cache state information to a directory. UPD flows between AIU and DCE.</p><p class="Body" id="1004414">Protocol data messages are classified as follows&#x3A;</p><p class="Bullet_1" id="1004415"><span class="BulletSymbol">&#x2022; </span>A data read message (DTR) transfers data to the requesting agent. DTR flows between AIU&#47;DMI&#47;DII and AIU.</p><p class="Bullet_1" id="1004416"><span class="BulletSymbol">&#x2022; </span>A data write message (DTW) transfers data from the requesting agent to memory or device. DTW flows between AIU and DMI&#47;DII&#47;DVE.</p><p class="BodyAfterHead" id="1004417">The sequence of protocol messages associated with a native transaction depends on the type of protocol transaction and the state of the snoop filters.</p><p class="Heading2" id="1009841"><a id="1086_Heading2_1009841" name="1086_Heading2_1009841"></a>2.1.1 Coherent Read Request</p><p class="BodyAfterHead" id="1009896"><br/></p><p class="Figure" id="1004435">Figure&#160;3. Coherent Read Request<img align="" alt="100052_003" class="imageSettings" height="370.550446" preserveAspectRatio="none" src="../assets/100052_003.jpg" style="max-width: 100% ;height: auto;display:block;margin:auto;" width="495.637482" x="8.000000" y="8.000000" />&#160;</p><p class="BodyAfterHead" id="1004418">In a coherent read request&#x3A; </p><p class="Bullet_1" id="1004419"><span class="BulletSymbol">&#x2022; </span>CMD message is issued by an AIU to a DCE. </p><p class="Bullet_1" id="1004420"><span class="BulletSymbol">&#x2022; </span>In DCE, the arriving transaction is ordered with respect to other requests to the same cache line. Then the snoop filters will be accessed to determine what SNP messages, if any, need to be issued to AIU to enforce coherence. The request phase of the SNP message indicates the type of coherence operation to be performed, while the response phase of the SNP message indicates the result of the coherence operation. </p><p class="Bullet_1" id="1004421"><span class="BulletSymbol">&#x2022; </span>Depending on the state of the cache line in the snooped caching agent, the snooped agent forwards data to the requesting agent by issuing a DTR message in response to the SNP message.</p><p class="Bullet_1" id="1004422"><span class="BulletSymbol">&#x2022; </span>If, based on the state of the snoop filters, no SNP messages are issued or, based on the responses to the SNP messages, no snooped agent will provide data, the DCE issues an MRD message to a DMI.</p><p class="Bullet_1" id="1004423"><span class="BulletSymbol">&#x2022; </span>If configured with a system cache, the DMI will first check its cache. On a hit data will be returned from the system cache. If no system cache has been instantiated or the system cache does not hold a copy of the requested cache line, the DMI will issue a memory read transaction downstream and data will be provided in a DTR message, once it arrives from memory.</p><p class="Body" id="1004374">Once all SNP message responses have been gathered and consolidated, the DCE issues an STR message to the requesting AIU. The response phase of the STR message indicates completion of the transaction to DCE and is the final ordering event in the processing sequence. This concludes the processing of a transaction and any request ordered behind this transaction will proceed.</p><p class="Heading2" id="1009862"><a id="1086_Heading2_1009862" name="1086_Heading2_1009862"></a>2.1.2 Coherent Clean Request</p><p class="BodyAfterHead" id="1009893"><br/></p><p class="Figure" id="1004488">Figure&#160;4. Coherent Clean Transaction<img align="" alt="100052_004" class="imageSettings" height="404.159271" preserveAspectRatio="none" src="../assets/100052_004.jpg" style="max-width: 100% ;height: auto;display:block;margin:auto;" width="516.637573" x="8.000000" y="8.000000" /></p><p class="Body" id="1010270">&#160;</p><p class="Body" id="1004474">In a coherent clean request&#x3A;</p><p class="Bullet_1" id="1004475"><span class="BulletSymbol">&#x2022; </span>CMD message is issued by an AIU to a DCE. In the DCE, a coherent clean transaction behaves similarly to a coherent read transaction, and SNP messages are issued to the appropriate AIUs. </p><p class="Bullet_1" id="1004476"><span class="BulletSymbol">&#x2022; </span>Additionally, RB is issued to DMI. In this case, however, if a caching agent has a modified copy of data, the AIU issues a DTW message to DMI to update the memory with the most recent value. </p><p class="Body" id="1004470">Once memory has been updated and all the SNP message responses have been gathered, the DCE issues and completes an STR message.</p><p class="Heading2" id="1009905"><a id="1086_Heading2_1009905" name="1086_Heading2_1009905"></a>2.1.3 Coherent Write Request</p><p class="Body" id="1009901"><br/></p><p class="Figure" id="1004543">Figure&#160;5. Coherent Write Request<img align="" alt="100052_005" class="imageSettings" height="auto" preserveAspectRatio="none" src="../assets/100052_005.jpg" style="max-width: 100% ;height: auto;display:block;margin:auto;" width="557.507324" x="8.000000" y="8.000000" /></p><p class="Body" id="1004528">&#160;In a coherent write request&#x3A;</p><p class="Bullet_1" id="1004529"><span class="BulletSymbol">&#x2022; </span>CMD message is likewise issued to a DCE. </p><p class="Bullet_1" id="1004530"><span class="BulletSymbol">&#x2022; </span>DCE effectively performs a coherent clean transaction to ensure that memory has been updated and that all copies of data have been invalidated. </p><p class="Bullet_1" id="1004531"><span class="BulletSymbol">&#x2022; </span>DCE issues the STR request message to the requesting AIU, and upon receiving the STR message, the AIU issues a DTW request message to a DMI.</p><p class="Body" id="1004524">Upon receiving the DTW Coherent Write Request message from the AIU, the DMI performs a memory write transaction to update the data stored in the memory and issues the DTW response message to the requesting AIU. Once the requesting AIU has processed the DTW response from the DMI, the AIU issues the STR response message to the DCE that process it and the operation is complete when all hazards are removed in the DCE and pending transactions ordered behind this request may proceed.</p><p class="Heading2" id="1009928"><a id="1086_Heading2_1009928" name="1086_Heading2_1009928"></a>2.1.4 Non&#x2D;Coherent Read and Write Requests</p><p class="BodyAfterHead" id="1010131"><br/></p><p class="Figure" id="1010100">Figure&#160;6. Non&#x2D;Coherent Read and Write Requests<object class="imageSettings" data="../assets/Non-coherent_flow_FOM_SVG_363.svg" height="333.593160" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="618.767395"></object></p><p class="Body" id="1009765">&#160;In a non&#x2D;coherent read request&#x3A;</p><p class="Bullet_1" id="1009767"><span class="BulletSymbol">&#x2022; </span>A CMD message is issued to either a DMI or DII depending on the memory address.</p><p class="Bullet_1" id="1009810"><span class="BulletSymbol">&#x2022; </span>The DMI&#47;DII then issues a STR message and forwards data to the requesting agent by issuing a DTR message.</p><p class="Body" id="1009984">In a non&#x2D;coherent write request&#x3A;</p><p class="Bullet_1" id="1009775"><span class="BulletSymbol">&#x2022; </span>A CMD message is issued to either a DMI or DII depending on the memory address.</p><p class="Bullet_1" id="1009834"><span class="BulletSymbol">&#x2022; </span>The DMI&#47;DII issues a STR message and upon receiving the STR message, the AIU issues a DTW to the DMI&#47;DII to update the memory with the write value.</p></div>
</body>
</html>