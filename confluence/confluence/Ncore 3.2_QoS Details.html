<p>Ncore 3.2 QoS support applies to CHIAIU, IOAIU, DCE and DMI only, as per Ncore Architecture spec.</p><p>Details of implementations are in the respective blocks micro-architecture specification.</p><p><br/></p><p><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156322/QOS+Implementation+Details" data-linked-resource-id="16156322" data-linked-resource-version="7" data-linked-resource-type="page">QOS Implementation Details</a></p><p><strong><a class="external-link" href="https://confluence.arteris.com/pages/viewpage.action?spaceKey=ENGR&amp;title=Arch+Ncore+3.X+Docs" rel="nofollow">Arch Ncore 3.X Docs - Engineering - Confluence (arteris.com)</a></strong></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="150" src="https://arterisip.atlassian.net/wiki/download/attachments/247564663/QoS-Ncore3-Architecture-Spec.JPG?api=v2"></span></p><p><br/></p><p>For AIU:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="150" src="https://arterisip.atlassian.net/wiki/download/attachments/247564663/QoS-AIU-arch-spec-page304.JPG?api=v2"></span></p><p>For DCE:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="150" src="https://arterisip.atlassian.net/wiki/download/attachments/247564663/QoS-DCE-arch-spec.JPG?api=v2"></span></p><p>For DMI:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="https://arterisip.atlassian.net/wiki/download/attachments/247564663/QoS-DMI-arch-spec.JPG?api=v2"></span></p><p><br/></p><p><br/></p><p><strong><a class="external-link" href="https://confluence.arteris.com/display/ENGR/Ncore+3.0+System+Specification#_Toc56333369" rel="nofollow">Ncore 3.0 System Specification - Engineering - Confluence (arteris.com)</a> </strong></p><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="https://arterisip.atlassian.net/wiki/download/attachments/247564663/QoS-System-Spec.JPG?api=v2"></span></strong></p><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="https://arterisip.atlassian.net/wiki/download/attachments/247564663/QoS-System-Spec-Starvation.JPG?api=v2"></span></strong></p><p><br/></p><p><strong>Question #1</strong></p><p>When in starvation mode IOAIU, DCE and DMI give highest priority to the starved request, if the starved request is not able to make forward progress as it does not have credits or what not then the logic lets regular unstarved request go through (what order these unstarved request are served in during this time? Age order or priority?). The logic stays in starved mode until either all starved requests are served, or the starvation counter runs out again. It then goes back to normal operation.</p><p><strong>Question #2</strong></p><p>Does IOAIU and CHI-AIU allocate credits up front so that once in starved mode the starved request will make forward progress for sure? Currently CHI-AIU is not doing that, CHI-AIU does not support credits reservation.</p><p><strong>Question #3</strong></p><p>During starvation mode, CHI-AIU is processing starved requests in age order. What about IOAIU? DCE and DMI?</p><p><br/></p><p><strong>Parameters</strong></p><p>JSON parameters for QoS:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">  &quot;QosInfo&quot;: {
    &quot;qosMap&quot;: [
      &quot;16&#39;hC000&quot;,
      &quot;16&#39;h3000&quot;,
      &quot;16&#39;h0C00&quot;,
      &quot;16&#39;h0300&quot;,
      &quot;16&#39;h00C0&quot;,
      &quot;16&#39;h0030&quot;,
      &quot;16&#39;h000C&quot;,
      &quot;16&#39;h0003&quot;
    ],
    &quot;qosCredits&quot;: [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0
    ],
    &quot;qosCreditsRsv&quot;: [],
    &quot;qosEventThreshold&quot;: 64
  },
  &quot;fnEnableQos&quot;: 1,
  &quot;fnEnableTimeOutRef&quot;: 0,
  &quot;timeOutThreshold&quot;: 16384,

</pre>
</div></div><p><br/></p><p>hw-ncr/cpr/tachl/lib/QosInfo.tachl.cpr</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;name&quot;: &quot;qosInfo&quot;,
  &quot;tachl&quot;: [
    {
      &quot;name&quot;: &quot;qosInfo&quot;,
      &quot;params&quot;: [
        {
          &quot;parameterName&quot;: &quot;qosMap&quot;,
          &quot;type&quot;: &quot;array&quot;,
          &quot;parameterType&quot;: &quot;micro-architecture&quot;,
          &quot;arrayType&quot;: &quot;string&quot;,
          &quot;default&quot;: [],
          &quot;formula&quot;: &quot;return system.qosparams.fnEnableQos ? system.qosparams.qosMap : []&quot;,
          &quot;description&quot;: &quot;Length of array defines number of buckets. Bucket 0 is LSB.&quot;
        },
        {
          &quot;parameterName&quot;: &quot;qosCredits&quot;,
          &quot;type&quot;: &quot;array&quot;,
          &quot;parameterType&quot;: &quot;micro-architecture&quot;,
          &quot;arrayType&quot;: &quot;integer&quot;,
          &quot;default&quot;: [],
          &quot;formula&quot;: &quot;return system.qosparams.qosMap.map(v =&gt; 0);&quot;,
          &quot;description&quot;: &quot;Credit per bucket maps to buckets in qosMap.&quot;
        },
        {
          &quot;parameterName&quot;: &quot;qosCreditsRsv&quot;,
          &quot;type&quot;: &quot;array&quot;,
          &quot;parameterType&quot;: &quot;micro-architecture&quot;,
          &quot;arrayType&quot;: &quot;integer&quot;,
          &quot;default&quot;: [],
          &quot;formula&quot;: &quot;return system.qosparams.fnEnableQos ? system.qosparams.qosCreditsRsv : []&quot;,
          &quot;description&quot;: &quot;Number of credits reserved per QoS (for now this is fixed at 1 per bucket).&quot;
        },
        {
          &quot;parameterName&quot;: &quot;qosEventThreshold&quot;,
          &quot;type&quot;: &quot;integer&quot;,
          &quot;parameterType&quot;: &quot;micro-architecture&quot;,
          &quot;default&quot;: 0,
          &quot;formula&quot;: &quot;return system.qosparams.fnEnableQos ? system.qosparams.qosEventThreshold : 0&quot;,
          &quot;description&quot;: &quot;This is the reset value for starvation event counter.&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p><p>NOTES:</p><p>RTL doesn't support qosCredits. Exception?</p><p>RTL doesn't support qosCreditsRsv. Exception?</p><p><br/></p><p>RTL supports qosMap.</p><p>Mapping of 4-bit QoS from native interface to 8-bit Priority on SMI interface (NOTE: Priority on SMI interface is descending order; priority 0 is the highest priority)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">input       [3:0]   rx_req_qos,
output      [7:0]   req_pri,

wire [15:0] pri_0 = 16&#39;hC000; //i.e. QosInfo.qosMap[0]
wire [15:0] pri_1 = 16&#39;h3000; //i.e. QosInfo.qosMap[1]
wire [15:0] pri_2 = 16&#39;h0C00; //i.e. QosInfo.qosMap[2]
wire [15:0] pri_3 = 16&#39;h0300; //i.e. QosInfo.qosMap[3]
wire [15:0] pri_4 = 16&#39;h00C0; //i.e. QosInfo.qosMap[4]
wire [15:0] pri_5 = 16&#39;h0030; //i.e. QosInfo.qosMap[5]
wire [15:0] pri_6 = 16&#39;h000C; //i.e. QosInfo.qosMap[6]
wire [15:0] pri_7 = 16&#39;h0003; //i.e. QosInfo.qosMap[7]

wire req_qos[15:0] = 16&#39;b1 &lt;&lt; rx_req_qos[3:0];

assign req_pri[0] = |(req_qos[15:0] &amp; pri_0);
assign req_pri[1] = |(req_qos[15:0] &amp; pri_1);
assign req_pri[2] = |(req_qos[15:0] &amp; pri_2);
assign req_pri[3] = |(req_qos[15:0] &amp; pri_3);
assign req_pri[4] = |(req_qos[15:0] &amp; pri_4);
assign req_pri[5] = |(req_qos[15:0] &amp; pri_5);
assign req_pri[6] = |(req_qos[15:0] &amp; pri_6);
assign req_pri[7] = |(req_qos[15:0] &amp; pri_7);</pre>
</div></div><p><br/></p><p>RTL supports propagation of priority in Concerto messages.</p><p><br/></p><p><br/></p><p>hw-ncr/cpr/tachl/lib/QosInfo.tachl.cpr</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">        {
          &quot;parameterName&quot;: &quot;fnEnableQos&quot;,
          &quot;type&quot;: &quot;integer&quot;,
          &quot;parameterType&quot;: &quot;architecture&quot;,
          &quot;validValues&quot;: &quot;0,1&quot;,
          &quot;default&quot;: 0,
          &quot;formula&quot;: &quot;return system.qosparams.fnEnableQos ? 1 : 0&quot;,
          &quot;description&quot;: &quot;Enable QoS.&quot;
        },
        {
          &quot;parameterName&quot;: &quot;fnEnableTimeOutRef&quot;,
          &quot;type&quot;: &quot;integer&quot;,
          &quot;parameterType&quot;: &quot;architecture&quot;,
          &quot;validValues&quot;: &quot;0,1&quot;,
          &quot;formula&quot;: &quot;return system.fnEnableTimeOutRef ? 1 : 0&quot;,
          &quot;default&quot;: 0,
          &quot;description&quot;: &quot;Used to add extra timeout reference signal input port. This will be one port per Ncore unit AIUs, DCEs and DMIs. (At top level for Ncore this may be tied to single port out of Ncore)&quot;
        },
        {
          &quot;parameterName&quot;: &quot;timeOutThreshold&quot;,
          &quot;type&quot;: &quot;integer&quot;,
          &quot;parameterType&quot;: &quot;architecture&quot;,
          &quot;formula&quot;: &quot;return system.timeOutThreshold&quot;,
          &quot;default&quot;: 0,
          &quot;description&quot;: &quot;Timeout threshold value; counts in increments of 4K cycles.&quot;
        }</pre>
</div></div><p><br/></p><p><strong>CSR Registers</strong></p><p>hw-ncr/cpr/csr/miscCSR.json</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">  {
    &quot;name&quot;: &quot;xTOCR&quot;,
    &quot;fields&quot;: [
      {
        &quot;name&quot;: &quot;TimeOutThreshold&quot;,
        &quot;bitOffset&quot;: 0,
        &quot;bitWidth&quot;: &quot;31&quot;,
        &quot;access&quot;: &quot;RW&quot;,
        &quot;hardware&quot;: &quot;RO&quot;,
        &quot;linkOp&quot;: &quot;NULL&quot;,
        &quot;opOrder&quot;: &quot;NULL&quot;,
        &quot;description&quot;: &quot;Time out threshold value; counts in increments of 4K cycles.&quot;,
        &quot;reset&quot;: &quot;return derived.timeOutThreshold&quot;,
        &quot;scope&quot;: &quot;All&quot;
      },
      {
        &quot;name&quot;: &quot;TimeOutRefEn&quot;,
        &quot;bitOffset&quot;: 31,
        &quot;bitWidth&quot;: &quot;1&quot;,
        &quot;access&quot;: &quot;RW&quot;,
        &quot;hardware&quot;: &quot;RO&quot;,
        &quot;reset&quot;: &quot;0x0&quot;,
        &quot;linkOp&quot;: &quot;NULL&quot;,
        &quot;opOrder&quot;: &quot;NULL&quot;,
        &quot;description&quot;: &quot;Set to use reference singal input instead of counting every 4K cycle&quot;,
        &quot;scope&quot;: &quot;Engg&quot;
      }
    ]
  },
  {
    &quot;name&quot;: &quot;xQOSCR&quot;,
    &quot;fields&quot;: [
      {
        &quot;name&quot;: &quot;EventThreshold&quot;,
        &quot;bitOffset&quot;: 0,
        &quot;bitWidth&quot;: &quot;16&quot;,
        &quot;access&quot;: &quot;RW&quot;,
        &quot;hardware&quot;: &quot;RO&quot;,
        &quot;reset&quot;: &quot;return derived.QosInfo.qosEventThreshold&quot;,
        &quot;linkOp&quot;: &quot;NULL&quot;,
        &quot;opOrder&quot;: &quot;NULL&quot;,
        &quot;description&quot;: &quot;Event threshold value counts every event (command issues) if value is 0 event count is disabled (event starvation disabled).&quot;,
        &quot;scope&quot;: &quot;All&quot;
      }
    ]
  },
  {
    &quot;name&quot;: &quot;xQOSSR&quot;,
    &quot;fields&quot;: [
      {
        &quot;name&quot;: &quot;EventStatus&quot;,
        &quot;bitOffset&quot;: 0,
        &quot;bitWidth&quot;: &quot;1&quot;,
        &quot;access&quot;: &quot;RO&quot;,
        &quot;hardware&quot;: &quot;RW&quot;,
        &quot;reset&quot;: &quot;0x0&quot;,
        &quot;linkOp&quot;: &quot;NULL&quot;,
        &quot;opOrder&quot;: &quot;NULL&quot;,
        &quot;description&quot;: &quot;0: Normal Mode \n1: Starvation Mode &quot;,
        &quot;scope&quot;: &quot;Engg&quot;,
        &quot;link&quot;: &quot;&quot;
      },
      {
        &quot;name&quot;: &quot;EventStatusCountOverflow&quot;,
        &quot;bitOffset&quot;: 1,
        &quot;bitWidth&quot;: &quot;1&quot;,
        &quot;access&quot;: &quot;W1C&quot;,
        &quot;hardware&quot;: &quot;RW&quot;,
        &quot;reset&quot;: &quot;0x0&quot;,
        &quot;linkOp&quot;: &quot;NULL&quot;,
        &quot;opOrder&quot;: &quot;NULL&quot;,
        &quot;description&quot;: &quot;Event count overflow bit, this bit is set once the counter overflows&quot;,
        &quot;scope&quot;: &quot;Engg&quot;,
        &quot;link&quot;: &quot;&quot;
      },
      {
        &quot;bitOffset&quot;: 4,
        &quot;name&quot;: &quot;EventStatusCount&quot;,
        &quot;bitWidth&quot;: &quot;16&quot;,
        &quot;access&quot;: &quot;W1C&quot;,
        &quot;hardware&quot;: &quot;RW&quot;,
        &quot;reset&quot;: &quot;0x0&quot;,
        &quot;linkOp&quot;: &quot;NULL&quot;,
        &quot;opOrder&quot;: &quot;NULL&quot;,
        &quot;description&quot;: &quot;Counts number of times event threshold was hit&quot;,
        &quot;scope&quot;: &quot;Engg&quot;,
        &quot;link&quot;: &quot;&quot;
      }
    ]
  }

</pre>
</div></div><p><br/></p><p><br/></p><p><br/></p><p><strong>Known Issue #1</strong></p><p>IOAIU has its own spec for QoS Starvation Avoidance that is different from the Ncore3 System Specification.</p><p>DCE and DMI are using the pri_age_buffer_arbiter module that is following the IOAIU spec for QoS Starvation to a large degree.</p><p>CHI-AIU is following Ncore3 System Architecture spec for QoS Starvation.</p><p>Ncore3 system specification specifies one global counter (to count command sent).</p><p>IOAIU uarch specification specifies two counters, one global counter to count cycles, another global counter to count either OTT deallocation or Command Sent.</p><p>IOAIU uarch spec also has additional implementation:</p><p>-upon entering starvation mode, this event is logged in the error register to allow an interrupt to be raised if enabled</p><p>-credits sharing across priority levels where a high priority level can consume credit from a lower priority level</p><p>-each priority level has one credit that is reserved and cannot be borrowed by a higher priority level.</p><p>-If the head of the queue that is competing to enter the pipeline finds an address dependency on a younger request, then the head will compete at the younger request's level.</p><p><a class="external-link" href="https://confluence.arteris.com/display/ENGR/Ncore+3.0+IOAIU+Micro-Architecture+Specification" rel="nofollow">https://confluence.arteris.com/display/ENGR/Ncore+3.0+IOAIU+Micro-Architecture+Specification</a></p><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="https://arterisip.atlassian.net/wiki/download/attachments/247564663/QoS-IOAIU-uarch-spec.png?api=v2"></span></strong></p><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="https://arterisip.atlassian.net/wiki/download/attachments/247564663/QoS-Starvation-IOAIU-uarch-spec.png?api=v2"></span></strong></p><p><br/></p><p><strong>Known Issue #2</strong></p><p>IOAIU eAge parameter (for enabling Age Ordering) is always tied low by Maestro.</p><p>IOAIU eAge parameter when enabled (set to 1) is not able to meet synthesis timing.</p><p><strong>Known Issue #3</strong></p><p>IOAIU does not implement QoS Arbitration. IOAIU detects the entry to Starvation Mode.</p><p><strong>Known Issue #4</strong></p><p>CHI-AIU does not implement QoS Arbitration. CHI-AIU only implements Age-order Arbitration. CHI-AIU detects the entry to Starvation Mode.</p><p><strong>Known Issue #5</strong></p><p>DCE command skid buffer doesn't consider address collision when selecting and sending out the request from the skid buffer. This deviates from the System Architecture Spec.</p><p>The address collision is handled downstream by the DCE Transaction Manager. The DCE serialization point is after the DCE command skid buffer.</p><p><strong>Known Issue #6</strong></p><p>DMI command skid buffer doesn't consider address collision when selecting and sending out the request from the skid buffer. This deviates from the System Architecture Spec.</p><p>NOTE: The address collision is handled after the DMI command skid buffer.</p><p><strong>Known Issue #7</strong></p><p>Ncore3 System Architecture Spec / Ncore3 System Spec should specify the behavior of QoS Credits Allocation and Reservation.</p><p><strong>Known Issue #8</strong></p><p>Ncore3 System Architecture Spec / Ncore3 System Spec should make it clear that DII and DVE should propagate the QoS priority end-to-end.</p><p><strong>Known Issue #9</strong></p><p>Ncore3 System Architecture Spec / Ncore3 System Spec should specify the behavior when a new request coming has an dependency on a lower priority pending.</p><p><strong>Known Issue #10</strong></p><p>Ncore3 System Architecture Spec / Ncore3 System Spec should clarify if credits availability is included in the dependencies for QoS Arbitration.</p><p><br/></p><p><br/></p><p><strong>Existing Hardware Component #1</strong></p><p>pri_age_buffer_arbiter is used in DCE and DMI command skid buffer. Its Verilog output RTL is shown as below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module pri_age_buffer_arbiter_a (
    input       starv_en,
    input       [15:0]  starv_threshold,
    input       qos_disable,
    output      empty,
    input       clk,
    input       reset_n,
    input       [N-1:0]   req_in_bundle,
    input       req_in_valid,
    output      req_in_ready,
    output      [N-1:0]   req_out_bundle,
    input       req_out_ready,
    output      req_out_valid);

This module internally instantiates a linked-list to record the arrival order and the priority level, and to be used to pick the oldest request for a priority level. The number of chains in the linked list is the number of priority levels.</pre>
</div></div><p><br/></p><p><strong>Existing Hardware Component #2</strong></p><p>CHI-AIU instantiates chi_age_arb module to issue requests in age-order.</p><p>CHI-AIU instantiates chi_aiu_prio_sel module to select a set of highest priority requests from input requests. The output of this module is to be connected to the chi_age_arb module. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module chi_age_arb_a (
    input       clk,
    input       reset_n,
    input       push_en,
    input       pop_en,
    input       [95:0]  push_data,
    input       [95:0]  req_vec,
    output      [95:0]  grant_vec,
    output      [31:0]  valid_vec,
    output      empty,
    output      full);

module chi_aiu_prio_sel_a (
  input [2:0]   entry0_prio,
...
  input [2:0]   entry95_prio,
  input [95:0]  starv,
  input [95:0]  in_req,
  output        [95:0]  out_req);</pre>
</div></div><p><br/></p><p>========================</p><p><strong>Recent emails regarding QoS Support</strong></p><p>========================</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">From: Eric Taylor &lt;Eric.Taylor@arteris.com&gt; 
Sent: Wednesday, September 1, 2021 7:06 AM
To: Boon Chuan &lt;Boon.Chuan@arteris.com&gt;
Subject: Re: IOAIU QoS

Hey,

Here&#39;s what I found

{
 ...
  &quot;Credits&quot;: {
    &quot;MaxCreditPerDCE&quot;: Yes
    &quot;MaxCreditPerDMI&quot;: Yes
    &quot;MaxCreditPerDII&quot;: Yes
    &quot;MaxCreditPerQOS&quot;: Yes
    &quot;ReserveWrPerDCE&quot;: Yes
    &quot;ReserveWrPerDMI&quot;:  Yes
    &quot;ReserveWrPerDII&quot;: Yes
    &quot;ReserveWrPerQOS&quot;: Yes
  &quot;nDveCredits&quot;: 2,
...
  &quot;nDii&quot;: 3,
  &quot;QosInfo&quot;: {
    &quot;qosMap&quot;: Yes
    &quot;qosCredits&quot;: No
    &quot;qosCreditsRsv&quot;: No
    &quot;qosEventThreshold&quot;: No
  },
  &quot;fnEnableQos&quot;: No
  &quot;fnEnableTimeOutRef&quot;: No 
  &quot;timeOutThreshold&quot;: No 
  &quot;csr&quot;: {
    &quot;addressWidth&quot;: 12,
    &quot;width&quot;: 32,
    &quot;spaceBlock&quot;: [
     
          {
            &quot;name&quot;: &quot;XAIUEDR6&quot;,
            &quot;description&quot;: &quot;Engineering Debug Register 6&quot;,
            &quot;csrDescription&quot;: &quot;Credit adjustment per target type basis: 0x1: Max 1. 0x2: Max 2. 0x3: Max 3. 0x5: Minus 1. 0x6: Minus 2. 0x7: Minus 3. 0x9: 1 read others writes. 0xa: Reserve 1 write. 0xb: No limit. 0xd: reserve 1 extra write, 0xe: reserve 2 extra writes, 0xf: reserve 3 extra writes, Others: no change&quot;,
            &quot;addressOffset&quot;: 2584,
            &quot;fields&quot;: [
              {
                &quot;name&quot;: &quot;DCE&quot;, Yes
              },
              {
                &quot;name&quot;: &quot;DMI&quot;, Yes
              },
              {
                &quot;name&quot;: &quot;DII&quot;, Yes
              },
              {
                &quot;name&quot;: &quot;DVE&quot;, Yes
              },
              {
                &quot;name&quot;: &quot;QOS&quot;, Yes
              },
              {
                &quot;name&quot;: &quot;Rsvd1&quot;,
                &quot;bitOffset&quot;: 20,
                &quot;bitWidth&quot;: 12,
                &quot;access&quot;: &quot;RO&quot;,
                &quot;hardware&quot;: &quot;RO&quot;,
                &quot;reset&quot;: 0,
                &quot;linkOp&quot;: &quot;NULL&quot;,
                &quot;opOrder&quot;: &quot;NULL&quot;,
                &quot;scope&quot;: &quot;&quot;,
                &quot;description&quot;: &quot;Reserved&quot;
              }
            ],
            &quot;specialImplementation&quot;: false
          },
          {
            &quot;name&quot;: &quot;XAIUEDR7&quot;,
            &quot;description&quot;: &quot;Engineering Debug Register 7&quot;,
            &quot;csrDescription&quot;: &quot;Specify period length for starvation detection&quot;,
            &quot;addressOffset&quot;: 2588,
            &quot;fields&quot;: [
              {
                &quot;name&quot;: &quot;EVENT&quot;, Yes
              {
                &quot;name&quot;: &quot;TIME&quot;, Yes
          },
          {
            &quot;name&quot;: &quot;XAIUQOSCR&quot;,
            &quot;description&quot;: &quot;XAIU QoS Control Register &quot;,
            &quot;csrDescription&quot;: &quot;XAIU QoS Control Register &quot;,
            &quot;addressOffset&quot;: 512,
            &quot;fields&quot;: [
              {
                &quot;name&quot;: &quot;EventThreshold&quot;, Yes
          },
          {
            &quot;name&quot;: &quot;XAIUQOSSR&quot;,
            &quot;description&quot;: &quot;XAIU QoS Status Register &quot;,
            &quot;csrDescription&quot;: &quot;XAIU QoS Status Register &quot;,
            &quot;addressOffset&quot;: 516,
            &quot;fields&quot;: [
              {
                &quot;name&quot;: &quot;EventStatus&quot;,  Yes
              },
              {
                &quot;name&quot;: &quot;EventStatusCountOverflow&quot;,  Yes
              {
                 ...
              },
              {
                &quot;name&quot;: &quot;EventStatusCount&quot;,  Yes
              },
              {
            &quot;specialImplementation&quot;: false
          },

</pre>
</div></div><p><br/></p><p>========================</p><p><strong>Old emails regarding QoS support</strong></p><p>========================</p><p><br/></p><p><strong>From:</strong> Mohammed Khaleeluddin <br/><strong>Sent:</strong> Friday, June 28, 2019 5:50 PM<br/><strong>To:</strong> Sanjay Deshpande &lt;<a class="external-link" href="mailto:sanjay.deshpande@arteris.com" rel="nofollow">sanjay.deshpande@arteris.com</a>&gt;; Khaled Labib &lt;<a class="external-link" href="mailto:Khaled.Labib@arteris.com" rel="nofollow">Khaled.Labib@arteris.com</a>&gt;<br/><strong>Cc:</strong> Shilpa Sawant &lt;<a class="external-link" href="mailto:shilpa.sawant@arteris.com" rel="nofollow">shilpa.sawant@arteris.com</a>&gt;; Nabil Masri &lt;<a class="external-link" href="mailto:nabil.masri@arteris.com" rel="nofollow">nabil.masri@arteris.com</a>&gt;; Tso-Wei Chang &lt;<a class="external-link" href="mailto:TsoWei.Chang@arteris.com" rel="nofollow">TsoWei.Chang@arteris.com</a>&gt;<br/><strong>Subject:</strong> QOS impmentation details</p><p><br/></p><p>Based on the chapter 13 of arch document requirements and the meeting where we discussed what RTL is going to implement here are the details based on discussion between Nabil, Shilpa, Tso-Wei and myself.</p><p>Please comment if you see issues</p><p><br/></p><p>Common:</p><ol><li>QOS value to QOS bucket (priority) mapping function. The priority value is sent on the legato interface.</li><li>QOS credit implementation.</li><ol><li>Each priority will have its own set of credits</li><li>Every priority will be able to borrow credits form lower priority than its own</li><li>Every priority will have one credit reserved for itself</li><li>Credits are returned back to the priorities in a round robin fashion.</li></ol><li>Starvation implementation.</li></ol><p>Starvation mechanism can be configured in the design with parameters and the behavior can be controlled through CSR. It is implemented as two common state machines with three bits per transaction table entry. It has four phases:</p><ol><ol><li>Starvation Detection:</li></ol></ol><p>One global counter is designed to count commands sent. Once the counter reaches a programmable threshold, an overflow bit in all valid entries which have not sent out a commands and have their protocol dependencies (Address, AXI ID etc.) resolved is set. This indicates the start of the period where the entry must make progress. The Overflow bit will be cleared if the entry sends a command. If the global counter reaches the threshold again while the overflow bit is still set, then that entry is starving because it hasn’t made progress for at least one complete period. The state machine now enters Starvation mode, the event is logged in an error register to allow an interrupt to be raised if enabled.</p><ol><ol><li>Starvation Handling:</li></ol></ol><p>Stop servicing all requests other than the currently starved requests. The global counter will be paused in this mode. The state machine mode will be readable via CSR and software if desired can disable QOS via CSR and resume normal operation.</p><p>Once all the starved requests have been serviced the normal processing resumes and the global counter resumes counting.   </p><ol><ol><li>Timeout Detection:</li></ol></ol><p>One global counter is designed to count cycles (it will have an option to use an external reference input to count).  Once the counter reaches a programmable threshold, the timeout overflow bit in all valid entries is set. This indicates the start of the period where</p><p>the entry must make progress. The timeout overflow bit will be cleared if the entry deallocates. If the global counter reaches the threshold again while the timeout overflow bit is still set, then that entry has timed out. The event is logged in an error register to allow an interrupt to be raised if enabled.</p><ol><ol><li>Timeout Handling:</li></ol></ol><p>The status is logged in the CSR software will now have the option to either disable timeout and continue or treat this as a fatal error. The timeout counter will stop running, until software restarts it via CSR.</p><ol><ol><li>Software via CSR will also have to the option to enable both, none or only one of the starvation / timeout mechanisms described above.</li></ol></ol><p><br/></p><p>IOAIU:</p><ol><li>Linked list based implementation to send transactions (initial commands) out based on QOS values in age order after all other (AXID / address / read and write) dependencies are resolved</li><li>All outgoing associated messages will have the calculated priority value on SMI.</li></ol><p>CHI_AIU:</p><ol><li>Use linked list based implementation to send transactions (initial commands) out based on QOS values in age order after all other (LPID /  address / read and write) dependencies are resolved</li><li>All outgoing associated messages will have the calculated priority value on SMI.</li></ol><p>DCE:</p><ol><li>Incoming commands are stored in a skid buffer and QOS in age order is used to pick Commands form the buffer</li><li>All outgoing associated messages will have the calculated priority value on SMI.</li></ol><p>DMI:</p><ol><li>Incoming commands are stored in a skid buffer and QOS in age order is used to pick Commands form the buffer</li><ol><li>MRD buffer</li><li>NC read write command buffer (does same address checks)</li></ol><li>All outgoing associated messages will have the calculated priority value on SMI and QOS is forwarded on native interface</li></ol><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><strong>From:</strong> Mohammed Khaleeluddin &lt;mohammed.khaleeluddin@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt; <br/><strong>Sent:</strong> Thursday, July 11, 2019 11:42 AM<br/><strong>To:</strong> Nabil Masri &lt;nabil.masri@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Tso-Wei Chang &lt;TsoWei.Chang@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Shilpa Sawant &lt;shilpa.sawant@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Boon Chuan &lt;boon.chuan@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Eric Taylor &lt;Eric.Taylor@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;<br/><strong>Subject:</strong> RE: QOS impmentation Parameters &amp; CSR details</p><p>Please see updates below based on inputs.</p><p><br/></p><p>Parameters:</p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Type</p></td><td class="confluenceTd"><p>Constraint</p></td><td class="confluenceTd"><p>Default</p></td><td class="confluenceTd"><p>Value example</p></td><td class="confluenceTd"><p>Description</p></td></tr><tr><td class="confluenceTd"><p>fnEanbleQos</p></td><td class="confluenceTd"><p>Integer</p></td><td class="confluenceTd"><p>0, 1</p></td><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>Enable QOS</p></td></tr><tr><td class="confluenceTd"><p>QosInfo</p></td><td class="confluenceTd"><p>Object</p></td><td class="confluenceTd"><p>Not empty if fnEanbleQos is 1</p></td><td class="confluenceTd"><p>Empty</p></td><td class="confluenceTd"><p><br/></p></td><td class="confluenceTd"><p>Info for QOS logic</p></td></tr><tr><td class="confluenceTd"><p>QosInfo.qosMap</p></td><td class="confluenceTd"><p>Array of strings</p></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><p>[]</p></td><td class="confluenceTd"><p>[16’h0780,</p><p>16’h0030,</p><p>16’h0018,</p><p>16’h0006,</p><p>16’h0001]</p></td><td class="confluenceTd"><p>Length of array defines number of buckets. Bucket 0 is LSB</p><p><br/></p></td></tr><tr><td class="confluenceTd"><p>QosInfo.qosCredits</p></td><td class="confluenceTd"><p>Array of integers</p></td><td class="confluenceTd"><p><br/></p></td><td class="confluenceTd"><p>[]</p></td><td class="confluenceTd"><p>[4,5,3,2,1]</p></td><td class="confluenceTd"><p>Credit per bucket maps to buckets in qosMap</p></td></tr><tr><td class="confluenceTd"><p>QosInfo.qosCreditsShareEnable</p></td><td class="confluenceTd"><p>Integer</p></td><td class="confluenceTd"><p>0,1</p></td><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>When set disable credit sharing.</p></td></tr><tr><td class="confluenceTd"><p>QosInfo.qosStarvationThreshold</p></td><td class="confluenceTd"><p>Integer</p></td><td class="confluenceTd"><p>0x0 to 0xFF</p></td><td class="confluenceTd"><p>0xF</p></td><td class="confluenceTd"><p>0xF</p></td><td class="confluenceTd"><p>Threshold value to be used as reset for the CSR</p></td></tr><tr><td colspan="6" class="confluenceTd"><p><strong>Time out parameter</strong></p></td></tr><tr><td class="confluenceTd"><p>fnEnableTimeoutRef</p></td><td class="confluenceTd"><p>Integer</p></td><td class="confluenceTd"><p>0,1</p></td><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>Used to add extra timeout reference signal input port. This will be one port per Ncore unit AIUs, DCEs and DMIs. (At top level for Ncore this may be tied to single port out of Ncore)</p></td></tr><tr><td class="confluenceTd"><p>timeoutThreshold</p></td><td class="confluenceTd"><p>Integer</p></td><td class="confluenceTd"><p>0x0 to 0xF_FFFF</p></td><td class="confluenceTd"><p>0XFFF</p></td><td class="confluenceTd"><p>0X7FF</p></td><td class="confluenceTd"><p>Threshold value to be used as reset for the timeout CSR</p></td></tr></tbody></table></div><p><br/></p><p>All QOS logic should be wrapped around fnEnableQos except starvation logic that will always be there to be used as timeout</p><p><br/></p><p>CSRs:</p><p><br/></p><p><a class="external-link" href="mailto:nabil.masri@arteris.com" rel="nofollow">@Nabil Masri</a> modified based on your suggestion to keep both registers consistent in terms of the enable field.</p><p><br/></p><p>Starvation timeout register (always present)</p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Bits</p></td><td class="confluenceTd"><p>Description</p></td></tr><tr><td class="confluenceTd"><p>TimeOutEnable</p></td><td class="confluenceTd"><p>31</p></td><td class="confluenceTd"><p>Time out enable</p><p>1: timeout counter enabled</p><p>0: timeout counter disabled</p><p>(Note: if the system is in timeout mode and the time out is disabled then the system shall move back to normal mode)</p></td></tr><tr><td class="confluenceTd"><p>TimeOutRefEn</p></td><td class="confluenceTd"><p>30</p></td><td class="confluenceTd"><p>Set to use reference signal input instead of counting every 4k cycle (filed is visible only if  fnEnableTimeoutRef is 1)</p></td></tr><tr><td class="confluenceTd"><p>Reserved</p></td><td class="confluenceTd"><p>29:20</p></td><td class="confluenceTd"><p>Reserved</p></td></tr><tr><td class="confluenceTd"><p>TimeOutThreshold</p></td><td class="confluenceTd"><p>19:0</p></td><td class="confluenceTd"><p>Time out threshold value; counts in increments of 4K cycles.</p></td></tr></tbody></table></div><p><br/></p><p>Generate an uncorrectable interrupt when threshold is met this is captured in our uncorrectable error register.</p><p>The info filed can capture information like address and request type. Capture the oldest entry in the case of multiple entries hit it.  </p><p><br/></p><p><br/></p><p>Starvation QOS event register (present only when QOS is enabled)</p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Bits</p></td><td class="confluenceTd"><p>Description</p></td></tr><tr><td class="confluenceTd"><p>StarvationEnable</p></td><td class="confluenceTd"><p>31</p></td><td class="confluenceTd"><p>Starvation enable</p><p>1: starvation counter enabled</p><p>0: starvation counter disabled</p><p>(Note: if the system is in starvation mode and the starvation is disabled then the system shall move back to normal mode)</p></td></tr><tr><td class="confluenceTd"><p>Reserved</p></td><td class="confluenceTd"><p>30:8</p></td><td class="confluenceTd"><p>Reserved</p></td></tr><tr><td class="confluenceTd"><p>StarvationThreshold</p></td><td class="confluenceTd"><p>7:0</p></td><td class="confluenceTd"><p>Starvation threshold value counts every 16 events (command issues).</p></td></tr></tbody></table></div><p><br/></p><p><br/></p><p>Starvation status register (engineering register not visible to customers)</p><p><br/></p><p>Address offset:</p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Bits</p></td><td class="confluenceTd"><p>Description</p></td></tr><tr><td class="confluenceTd"><p>TimeOutStatus</p></td><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>0: Normal operation</p><p>1: starvation mode</p></td></tr><tr><td class="confluenceTd"><p>TimeOutStatusCountOverflow</p></td><td class="confluenceTd"><p>3</p></td><td class="confluenceTd"><p>Timeout count overflow bit, set if the counter overflows</p></td></tr><tr><td class="confluenceTd"><p>TimeOutStatusCount</p></td><td class="confluenceTd"><p>15:4</p></td><td class="confluenceTd"><p>Count of number of times we hit timeout threshold</p></td></tr><tr><td class="confluenceTd"><p>EventStatus</p></td><td class="confluenceTd"><p>16</p></td><td class="confluenceTd"><p>0: Normal operation</p><p>1: Starvation mode</p></td></tr><tr><td class="confluenceTd"><p>EventStatusCountOverflow</p></td><td class="confluenceTd"><p>1</p></td><td class="confluenceTd"><p>Timeout count overflow bit, set if the counter overflows</p></td></tr><tr><td class="confluenceTd"><p>EventStatusCount</p></td><td class="confluenceTd"><p>31:20</p></td><td class="confluenceTd"><p>Count of number of times we hit event threshold</p></td></tr></tbody></table></div><p><br/></p><p>Additional credit count over right registers</p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Bits</p></td><td class="confluenceTd"><p>Description</p></td></tr><tr><td class="confluenceTd"><p>ThresholdQosBucket0</p></td><td class="confluenceTd"><p>7:0</p></td><td class="confluenceTd"><p>Threshold value for qos bucket</p></td></tr><tr><td class="confluenceTd"><p>ThresholdQosBucket1</p></td><td class="confluenceTd"><p>15:8</p></td><td class="confluenceTd"><p>Threshold value for qos bucket</p></td></tr><tr><td class="confluenceTd"><p>ThresholdQosBucket2</p></td><td class="confluenceTd"><p>23:16</p></td><td class="confluenceTd"><p>Threshold value for qos bucket</p></td></tr><tr><td class="confluenceTd"><p>ThresholdQosBucket3</p></td><td class="confluenceTd"><p>31:24</p></td><td class="confluenceTd"><p>Threshold value for qos bucket</p></td></tr></tbody></table></div><p><br/></p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Bits</p></td><td class="confluenceTd"><p>Description</p></td></tr><tr><td class="confluenceTd"><p>ThresholdQosBucket4</p></td><td class="confluenceTd"><p>7:0</p></td><td class="confluenceTd"><p>Threshold value for qos bucket</p></td></tr><tr><td class="confluenceTd"><p>ThresholdQosBucket5</p></td><td class="confluenceTd"><p>15:8</p></td><td class="confluenceTd"><p>Threshold value for qos bucket</p></td></tr><tr><td class="confluenceTd"><p>ThresholdQosBucket6</p></td><td class="confluenceTd"><p>23:16</p></td><td class="confluenceTd"><p>Threshold value for qos bucket</p></td></tr><tr><td class="confluenceTd"><p>ThresholdQosBucket7</p></td><td class="confluenceTd"><p>31:24</p></td><td class="confluenceTd"><p>Threshold value for qos bucket</p></td></tr></tbody></table></div><p><br/></p><p><br/></p><p>Regards,</p><p>MK</p><p><br/></p><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">
From: Boon Chuan 
Sent: Wednesday, September 8, 2021 12:15 PM
To: Eric Taylor &lt;Eric.Taylor@arteris.com&gt;; Mohammed Khaleeluddin &lt;mohammed.khaleeluddin@arteris.com&gt;; Akarsh Hebbar &lt;Akarsh.Hebbar@arteris.com&gt;; Balaji Krishnaswamy &lt;Balaji.Krishnaswamy@arteris.com&gt;; David Clarino &lt;david.clarino@arteris.com&gt;; Kjeld Svendsen &lt;Kjeld.Svendsen@arteris.com&gt;
Cc: Michael Frank &lt;Michael.Frank@arteris.com&gt;; Junie Um &lt;Junie.Um@arteris.com&gt;; John Coddington &lt;john.coddington@arteris.com&gt;
Subject: RE: CHI-AIU updated with QoS Arbitration with Age Order and Starvation Handling

For CHI-AIU, if there’s no eligible requests to the arbiter, i.e. the arbiter doesn’t see any request, then starvation mode if set will be cleared.

For CHI-AIU, if OTT entries are available, then new requests coming in will be loaded to OTT entries.

-Boon

From: Eric Taylor &lt;Eric.Taylor@arteris.com&gt; 
Sent: Wednesday, September 8, 2021 12:07 PM
To: Boon Chuan &lt;Boon.Chuan@arteris.com&gt;; Mohammed Khaleeluddin &lt;Mohammed.Khaleeluddin@arteris.com&gt;; Akarsh Hebbar &lt;Akarsh.Hebbar@arteris.com&gt;; Balaji Krishnaswamy &lt;Balaji.Krishnaswamy@arteris.com&gt;; David Clarino &lt;David.Clarino@arteris.com&gt;; Kjeld Svendsen &lt;Kjeld.Svendsen@arteris.com&gt;
Cc: Michael Frank &lt;Michael.Frank@arteris.com&gt;; Junie Um &lt;Junie.Um@arteris.com&gt;; John Coddington &lt;John.Coddington@arteris.com&gt;
Subject: Re: CHI-AIU updated with QoS Arbitration with Age Order and Starvation Handling

If there are multiple request that are starved, how do you arbitrate between them?
•	By default means. In Starvation mode all transactions are still eligible to go from the OTT, however no new transactions can enter the OTT.
•	This includes credits, qos, etc. 
•	The prevailing method is when an ordering dependency is cleared since that is the main reason a transaction will be put in the OTT to be slept. 
How does the AIU come out of starvation mode to normal mode? 
•	When no transaction is in a starvation mode anymore. 
What happens if one of the starved requests does not have credits to make forward progress?
•	It will have to wait until it gets credits from an incoming response.  We dont ignore the credit check. 
In summary now the only thing Starvation mode does is make only transactions from the OTT eligible to be sent. No other transaction can make it out. 

-ET

________________________________________
From: Boon Chuan &lt;Boon.Chuan@arteris.com&gt;
Sent: Wednesday, September 8, 2021 1:37 PM
To: Mohammed Khaleeluddin &lt;Mohammed.Khaleeluddin@arteris.com&gt;; Akarsh Hebbar &lt;Akarsh.Hebbar@arteris.com&gt;; Balaji Krishnaswamy &lt;Balaji.Krishnaswamy@arteris.com&gt;; David Clarino &lt;David.Clarino@arteris.com&gt;; Eric Taylor &lt;Eric.Taylor@arteris.com&gt;; Kjeld Svendsen &lt;Kjeld.Svendsen@arteris.com&gt;
Cc: Michael Frank &lt;Michael.Frank@arteris.com&gt;; Junie Um &lt;Junie.Um@arteris.com&gt;; John Coddington &lt;John.Coddington@arteris.com&gt;
Subject: RE: CHI-AIU updated with QoS Arbitration with Age Order and Starvation Handling 
 
+John
 
From: Boon Chuan 
Sent: Wednesday, September 8, 2021 11:35 AM
To: Mohammed Khaleeluddin &lt;mohammed.khaleeluddin@arteris.com&gt;; Akarsh Hebbar &lt;Akarsh.Hebbar@arteris.com&gt;; Balaji Krishnaswamy &lt;Balaji.Krishnaswamy@arteris.com&gt;; David Clarino &lt;david.clarino@arteris.com&gt;; Eric Taylor &lt;Eric.Taylor@arteris.com&gt;; Kjeld Svendsen &lt;Kjeld.Svendsen@arteris.com&gt;
Cc: Michael Frank &lt;Michael.Frank@arteris.com&gt;; Junie Um &lt;Junie.Um@arteris.com&gt;
Subject: RE: CHI-AIU updated with QoS Arbitration with Age Order and Starvation Handling
 
Regarding:
“””
If there are multiple request that are starved, how do you arbitrate between them? 
“””
Because starved requests have arbitration priority of level 0 (highest priority), they will be serviced in age order.
 
Regarding:
“”””
How does the AIU come out of starvation mode to normal mode? 
“”””
when all starved requests are serviced.
 
 
Regarding:
“”””
What happens if one of the starved requests does not have credits to make forward progress? 
“”””
If starved requests do not have credits, then the starved requests are not eligible to issue requests to the arbiter.
 
See the RTL behavior spec in this email:
“”””
OTT Entries that have eligible requests (free of transaction dependency and credit is available) issue requests to the CMDreq Arbiter.
“”””
 
-Boon
 
From: Boon Chuan 
Sent: Wednesday, September 8, 2021 11:28 AM
To: Mohammed Khaleeluddin &lt;mohammed.khaleeluddin@arteris.com&gt;; Akarsh Hebbar &lt;Akarsh.Hebbar@arteris.com&gt;; Balaji Krishnaswamy &lt;Balaji.Krishnaswamy@arteris.com&gt;; David Clarino &lt;david.clarino@arteris.com&gt;; Eric Taylor &lt;Eric.Taylor@arteris.com&gt;; Kjeld Svendsen &lt;Kjeld.Svendsen@arteris.com&gt;
Cc: Michael Frank &lt;Michael.Frank@arteris.com&gt;; Junie Um &lt;Junie.Um@arteris.com&gt;
Subject: RE: CHI-AIU updated with QoS Arbitration with Age Order and Starvation Handling
 
Hi Khaleel,
 
Regarding:
“ When the OTT Entry is marked as starved, the arbitration priority is loaded with the highest priority (priority level=0).”
 
It’s for timing reason.
Otherwise we have to use the starvation bit vector to filter out non-starving requests during starvation mode. This hurts timing (we want to save every level of logic gate as possible) for the QoS Arbiter with Age Order.
 
NOTE: the starvation bit vector is one bit per OTT entry.
NOTE: the QoS Arbiter with Age Order is a zero-cycle arbiter (grant is given is the same clock cycle as request), designed to meet 1.6GHz timing for up to 128 OTT entries with 8 levels of priorities.
 
If this is not acceptable, then I can remove it. 
I can revert back to use the starvation bit vector to filter out non-starving requests.
 
The starvation bit vector is automatically cleared (i.e exiting starvation mode) when all starved requests are serviced.
 
-Boon
 
P/S: 
This is also not in the intended spec today. So, please confirm if this is acceptable.
“””
  When the OTT Entry is marked as having dependency, the arbitration priority is loaded with the highest priority (priority level=0).
“””
 
From: Mohammed Khaleeluddin &lt;Mohammed.Khaleeluddin@arteris.com&gt; 
Sent: Wednesday, September 8, 2021 10:42 AM
To: Akarsh Hebbar &lt;Akarsh.Hebbar@arteris.com&gt;; Boon Chuan &lt;Boon.Chuan@arteris.com&gt;; Balaji Krishnaswamy &lt;Balaji.Krishnaswamy@arteris.com&gt;; David Clarino &lt;David.Clarino@arteris.com&gt;; Eric Taylor &lt;Eric.Taylor@arteris.com&gt;; Kjeld Svendsen &lt;Kjeld.Svendsen@arteris.com&gt;
Cc: Michael Frank &lt;Michael.Frank@arteris.com&gt;; Junie Um &lt;Junie.Um@arteris.com&gt;
Subject: Re: CHI-AIU updated with QoS Arbitration with Age Order and Starvation Handling
 
Hi Boon, 
 
Thanks, few questions.
 
“ When the OTT Entry is marked as starved, the arbitration priority is loaded with the highest priority (priority level=0).”
 
 
So, you are upgrading the priority of the starved request to the highest priority here? This is not the intended spec as of today. To the best of my knowledge this is not done by any other Ncore unit i.e. IOAIU, DCE and DMI 
 
If there are multiple request that are starved, how do you arbitrate between them? 
How does the AIU come out of starvation mode to normal mode? What happens if one of the starved requests does not have credits to make forward progress? 
 
@Eric Taylor / @Kjeld Svendsen above questions also apply to current IOAIU implementation. 
 
Regards,
MK
 
 
 
 	Mohammed Khaleeluddin  |  Director of HW Design
+1 (408) 470 7300 (Office) | +1 (571) 594 2070 (Mobile) | mohammed.khaleeluddin@arteris.com
ArterisIP | 595 Millich Dr Suite 200, Campbell, CA 95008, USA |  www.arteris.com
  
 
 
From: Akarsh Hebbar &lt;Akarsh.Hebbar@arteris.com&gt;
Date: Tuesday, September 7, 2021 at 7:57 PM
To: Boon Chuan &lt;Boon.Chuan@arteris.com&gt;, Balaji Krishnaswamy &lt;Balaji.Krishnaswamy@arteris.com&gt;, David Clarino &lt;David.Clarino@arteris.com&gt;, Eric Taylor &lt;Eric.Taylor@arteris.com&gt;, Kjeld Svendsen &lt;Kjeld.Svendsen@arteris.com&gt;
Cc: Michael Frank &lt;Michael.Frank@arteris.com&gt;, Mohammed Khaleeluddin &lt;Mohammed.Khaleeluddin@arteris.com&gt;, Junie Um &lt;Junie.Um@arteris.com&gt;
Subject: RE: CHI-AIU updated with QoS Arbitration with Age Order and Starvation Handling
Thanks Boon.
 
From: Boon Chuan &lt;Boon.Chuan@arteris.com&gt; 
Sent: Tuesday, September 7, 2021 9:55 PM
To: Balaji Krishnaswamy &lt;Balaji.Krishnaswamy@arteris.com&gt;; David Clarino &lt;David.Clarino@arteris.com&gt;; Eric Taylor &lt;Eric.Taylor@arteris.com&gt;; Kjeld Svendsen &lt;Kjeld.Svendsen@arteris.com&gt;
Cc: Akarsh Hebbar &lt;Akarsh.Hebbar@arteris.com&gt;; Michael Frank &lt;Michael.Frank@arteris.com&gt;; Mohammed Khaleeluddin &lt;Mohammed.Khaleeluddin@arteris.com&gt;; Junie Um &lt;Junie.Um@arteris.com&gt;
Subject: CHI-AIU updated with QoS Arbitration with Age Order and Starvation Handling
 
I have just pushed in the complete RTL changes to CHI-AIU to support QoS Arbitration with Age Order, as well as QoS Starvation Handling.
 
Below describes the RTL implementation:
 
The age order is the request arrival order on the native interface.
 
OTT Entries that have eligible requests (free of transaction dependency and credit is available) issue requests to the CMDreq Arbiter.
A request, upon acceptance by the arbiter, consumes one credit in the corresponding credit counter.
 
When useQoS=0, the CMDreq Arbiter is an Age Order Arbiter. 
The oldest, eligible request is picked and sent out as CMDreq.
 
When useQoS=1, the CMDreq Arbiter is a QoS Arbiter with Age Order.
The highest priority, oldest, eligible request is picked and sent out as CMDreq.
OTT Entry stores the native priority that is mapped from native QoS. The native priority propagates in the outgoing Concerto messages.
OTT Entry also stores the arbitration priority. OTT Entry issues a request - together with the arbitration priority – to the CMDreq Arbiter.
  For a DVM request, the arbitration priority is loaded with the highest priority (priority level=0).
  For non-DVM request, the arbitration priority is loaded with the native priority.
  When the OTT Entry is marked as starved, the arbitration priority is loaded with the highest priority (priority level=0).
  When the OTT Entry is marked as having dependency, the arbitration priority is loaded with the highest priority (priority level=0).
 
-Boon
 
P/S: CHI-AIU follows Ncore3 System Specification, Section 7.1 Starvation Mechanism

</pre>
</div></div><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p>