<p> </p><p> </p><p><strong>From:</strong> John Coddington &lt;john.coddington@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt; <br/> <strong>Sent:</strong> Tuesday, November 12, 2019 7:01 AM<br/> <strong>To:</strong> Mokhtar Hirech &lt;Mokhtar.Hirech@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;<br/> <strong>Cc:</strong> Boon Chuan &lt;boon.chuan@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Allan Lobo &lt;allan.lobo@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Youcef Bourai &lt;youcef.bourai@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Syed Ijlal Shah &lt;Syed.shah@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Dan Takyrbashev &lt;Dan.Takyrbashev@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;; Federico Angiolini &lt;federico.angiolini@<a class="external-link" href="http://arteris.com" rel="nofollow">arteris.com</a>&gt;<br/> <strong>Subject:</strong> Re: multicast</p><p> </p><p>There’s a pretty good description in the microarchitecture document of how the multicast block and its parameters work:</p><p> </p><p>               <a class="external-link" href="https://confluence.arteris.com/display/ENGR/sym_multicast" rel="nofollow">https://confluence.arteris.com/display/ENGR/sym_multicast</a></p><p> </p><p>I strongly suggest you read it.</p><p> </p><p>The width fo wH_multi_label is determined by the number of broadcast trees in the design. It is always at least one bit and multicast label 0 is reserved for non multicast transactions.</p><p> </p><p>The label on a transaction is programmed in the PAM table of the initiator.</p><p> </p><p>The width of wH_multi_mask is set by the number of targets you have in your multicast tree. It’s a bit per target. The values in the mask come from Aw user bits in the AXI interface, so you have to map user bits to the multi_mask field in the ATU initiator.</p><p> </p><p>There are three other parameters that go together and are used to route a packet through the multicast block to the target:</p><p> </p><p>               mask2TrgGrp</p><p>               trgPathLut</p><p>               trgPathEgress</p><p> </p><p>If you only have one multicast block in your tree, these parameters will all have a width of the number of your targets. An example would be for a four target multicast would be:</p><p> </p><p>               mask2TrgGrp: [‘0001’,’0010’,’0100’,’1000’], &lt;— which bits in the multi mask correspond to the same index in trgPathLut array.</p><p>               trgPathLut[{targ_id: 10, route: ‘0010’},{targ_id: 11, route: ‘1010’},{targ_id: 12, route: ‘1110’},{targ_id: 13, route: ‘1111’}],</p><p>               trgPathEgress:[{targ_id: 10, egress: 0},{targ_id: 11, egress: 1},{targ_id:12, egress: 2},{targ_id:13, egress: 3}],</p><p> </p><p>The first two arrays are correlated, so index 0 in mask2TrgGrp goes with index 0 in trgPathLut.</p><p>The last array corresponds to the 2nd array by targ_id.</p><p> </p><p>This says that mult_mask[0] is mapping to targ_id: 10, goes out egress port 0 and has a route of ‘0010’.</p><p> </p><p>When you have a multicast tree, then these parameters have the width of the number of outputs, (for now, but not in the future.) There’s an example of how this works in the microarchitecture document. The target ID is the target ID of the next element in the tree, so if it’s a multicast block it's the ID of that multicast block.</p><p> </p><p>The parameter:</p><p> </p><p>               srcPathLut</p><p> </p><p>Controls how responses are routed back to requestors. So, if there are three requestors that can initiate transactions on the multicast tree, then there will be three entrees. If there are multiple multicast blocks in a multicast tree, only the first multicast block (from the perspective of the request) would have multiple entries. Again, the targ_id refers to the next target in the tree, so if it’s a multicast block, it’s the id of that multicast block.</p><p> </p><p>John</p><p> </p><p>On Nov 12, 2019, at 2:03 AM, Mokhtar Hirech &lt;<a class="external-link" href="mailto:Mokhtar.Hirech@arteris.com" rel="nofollow">Mokhtar.Hirech@arteris.com</a>&gt; wrote:</p><p> </p><p>Hi Boon,</p><p> </p><p>Any idea how to set the width for multicast label and multicast mask in the ATP packet ?</p><p>I guess you are referring to wH_multi_label and wH_multi_mask. Right?</p><p> </p><p>Thanks,</p><p> </p><p>-Mokhtar</p>