<h1 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-1.History">1. History</h1><h2 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-1.1Version">1.1 Version</h2><div class="table-wrap"><table class="confluenceTable"><thead><tr><th class="confluenceTh"><div class="tablesorter-header-inner"><div class="tablesorter-header-inner">version</div></div></th><th class="confluenceTh"><div class="tablesorter-header-inner"><div class="tablesorter-header-inner">date</div></div></th><th class="confluenceTh"><div class="tablesorter-header-inner"><div class="tablesorter-header-inner">comments</div></div></th><th colspan="1" class="confluenceTh"><div class="tablesorter-header-inner"><div class="tablesorter-header-inner">reviewers</div></div></th></tr></thead><tbody><tr><td class="confluenceTd">0.1</td><td class="confluenceTd">08/22/2018</td><td class="confluenceTd"> </td><td colspan="1" class="confluenceTd"><a class="confluence-userlink user-mention" data-account-id="624b36eda629c30068a79e97" href="https://arterisip.atlassian.net/wiki/people/624b36eda629c30068a79e97?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Aman Khandelwal (Deactivated)</a></td></tr><tr><td colspan="1" class="confluenceTd">0.2</td><td colspan="1" class="confluenceTd">09/13/2018</td><td colspan="1" class="confluenceTd">Testplan review</td><td colspan="1" class="confluenceTd"><a class="confluence-userlink user-mention" data-account-id="624b3806258562006fa69302" href="https://arterisip.atlassian.net/wiki/people/624b3806258562006fa69302?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Chirag Gandhi (Deactivated)</a>, <a class="confluence-userlink user-mention" data-account-id="624b378ef407980070592335" href="https://arterisip.atlassian.net/wiki/people/624b378ef407980070592335?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Satya Prakash (Deactivated)</a>, <a class="confluence-userlink user-mention" data-account-id="624b37ffad6b7e006aa7d897" href="https://arterisip.atlassian.net/wiki/people/624b37ffad6b7e006aa7d897?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Mohammed Khaleeluddin (Deactivated)</a>, <a class="confluence-userlink user-mention" data-account-id="624b36eda629c30068a79e97" href="https://arterisip.atlassian.net/wiki/people/624b36eda629c30068a79e97?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Aman Khandelwal (Deactivated)</a></td></tr></tbody></table></div><h2 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-1.2.References">1.2. References</h2><ul><li><a class="external-link" href="https://confluence.arteris.com/pages/viewpage.action?pageId=4853089" rel="nofollow">https://confluence.arteris.com/pages/viewpage.action?pageId=4853089</a></li><li><a href="https://arterisip.atlassian.net/wiki/spaces/OP/pages/16777526/Arch-Resiliency" data-linked-resource-id="16777526" data-linked-resource-version="3" data-linked-resource-type="page">Arch-Resiliency</a></li></ul><h1 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-2.IntroductionIntroduction">2.   <span class="confluence-anchor-link" id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-Introduction"><span class="confluence-anchor-link" id="Introduction"></span></span>Introduction</h1><p>In this testplan, testbench support for Resiliency verification has been described including Knobs used in the testbench to control the fault injection, Checks and used APFs.</p><p>You can find more detail on Resiliency feature on the above mentioned references.</p><h2 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-2.1DifferenttypesoferrorsthatRTLsupports">2.1 Different types of errors that RTL supports</h2><ol><li>Mission fault: All the below described faults lead to a Mission fault in that unit and the System<ol><li>Bypass fault: This fault comes into the picture when the placeholder has been enabled in RTL. This error comes when a non-coherent transaction comes from an Agent with error (correctable or uncorrectable) injected and the placeholder logic catches it.</li><li>Interface fault: This fault also comes into the picture when the placeholder has been enabled in RTL. This error comes when a coherent transaction comes from an Agent with error (correctable or uncorrectable) injected and the placeholder logic catches it.</li><li>Socket fault: This fault occurs when the SFI request (addr/priv/prot) or data signal is received by a unit with uncorrectable error injected.</li></ol></li><li>Latent fault<ol><li>To catch the issue in the fault checker itself, fault checker logic is duplicated and then outputs of both fault checker units (main and duplicated) are compared. And if they do not match, it will be a Latent fault. This fault only comes into the picture in the case when the Unit is duplicated or if the BIST sequence is running.</li></ol></li><li>Correctable error fault<ol><li>Socket cerr fault: This fault occurs when the SFI request (addr/priv/prot) or data signal is received by a unit with correctable error injected.</li></ol></li></ol><h1 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-3.Testbenchdescription">3. Testbench description</h1><h2 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-3.1Typesoffaultinjectionandchecksimplementedinthetestbench:">3.1 Types of fault injection and checks implemented in the testbench:</h2><p><strong>Notes:</strong></p><ol><li>In case of injecting errors in the prot and data signal of DCE units, errors are injected only in DCE0 (Relevant JIRAs: CONC-4307, CONC-4357)</li><li>All scoreboards and below timeout assertions are disabled in all tests except 3.1.2 i.e. Correctable error injection<ol><li>available in <em>sfi_mst_if.</em>sv file: <em>assert_pending_rsps_timeout </em>and<em> assert_req_vld_set_rdy_nset</em></li></ol></li><li>If a transaction is killed in the middle of the test due to error injection, then test exits after a fixed timeout as the test will hang otherwise</li><li>Uncorrectable errors are injected in one unit in one test because injecting uncorrectable errors in multiple units in a single test leads to a system hang and units stop receiving transactions and uncorrectable errors are not detected by all the selected units which leads to test failure</li><li>Latent fault should always be 0 in case of Unit Duplication except when BIST seq is running</li></ol><h3 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-3.1.1Uncorrectableerrorinjection">3.1.1 Uncorrectable error injection</h3><ol><li><p>Knobs used: “<strong>inject_sfi_slv_req_uncorr_error</strong>” and “<strong>inject_sfi_slv_data_uncorr_error</strong>”</p></li><li><p>Injects both correctable and uncorrectable errors on SFI req/data signals on one randomly selected unit in one test</p><ol><li>There does not seem to be a way of injecting only uncorrectable errors</li><li>Do not keep count of how many uncorrectable errors have been injected, and at the end of the test check the outputs</li></ol></li><li>Mission fault signal for units with errors injected and for the System should be high</li><li><p>Latent fault of every unit as well as the overall system is low</p></li></ol><h3 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-3.1.2Correctableerrorinjection">3.1.2 Correctable error injection</h3><ol><li><p>Knobs used: “<strong>inject_sfi_slv_req_corr_error</strong>” and “<strong>inject_sfi_slv_data_corr_error</strong>”</p></li><li><p>Injects correctable errors on SFI req/data signals on N number of units (where N is less than or equal to total number of Units)</p><ol><li>Sets the threshold limit to a random value from 1 to 15.</li><li>Do not keep count of how many correctable errors have been injected, and at the end of the test check the outputs</li></ol></li><li><p>Check corr_over_thres signal (for units with errors injected) and corr_over_thres_int signal values are high</p></li><li><p>Check every unit’s Mission fault and the system’s Mission fault is low</p></li><li><p>Also, the Latent fault of every unit as well as the system is low</p></li></ol><h3 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-3.1.3Mission/Latentfaultinjection"><strong>3.1.3 Mission/Latent fault injection</strong></h3><p>Mission/Latent error injection is done using the following ways (This is done per unit)</p><p><strong>Note</strong>: If Unit duplication is disabled, then, Latent fault should always be low</p><ol><li>Force all <strong>socket/bypass/interface</strong> (on bypass/interface if placeholder fault is enabled) errors to be high (one at a time) on either func or check (on check only if the unit duplication is enabled) or both modules<ol><li>To understand the Socket/Bypass/Interface faults, please go to the <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16777310/Ncore+2.6+Resiliency+Verification+Testplan+Unit+Level+and+System+Level#Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-Introduction">Introduction section</a>.</li><li>Knob used:<strong> &quot;inject_socket_fault&quot;</strong></li><li>No transaction is needed in this test</li><li>Check the Mission and the Latent fault of that Unit<ol><li>If socket_fault of only Unit module goes high, both Mission fault and Latent faults should be high</li><li>If socket_fault of only Checker module goes high, Mission fault should be low and Latent fault should be High</li><li>If socket_fault of both Unit and Checker modules are high, Mission fault should be high and Latent fault should be low</li></ol></li></ol></li><li>Force different outputs at func and check (only if the unit duplication is enabled) modules using the following steps<ol><li>Knob used:<strong> &quot;<strong>inject_mission_fault&quot;</strong></strong></li><li>Makes one output of func or check module different than the other (To select the module &quot;<strong>inject_unit</strong>&quot; knobs is used),<ol><li>These outputs include socket/bypass/interface cerr signals as well, they are treated as any other output</li></ol></li><li>Then, checks that Mission fault is high and the Latent fault is low of that unit</li><li>Calls BIST sequence to clear out the faults</li><li>Repeat it for all the outputs and all the units</li></ol></li><li>Inject ACE/AXI placeholder fault (placeholder/bypass fault)<ol><li>This is a manual test</li><li>In this, an APF is created with some added signals related to placeholder</li><li>Then, RTL is modified locally to use the additional input signals to drive Mission/Latent fault</li><li>Testbench randomly drives those added placeholder signals in the simulation</li><li>At the end of the simulation, check Mission/Latent faults accordingly</li></ol></li></ol><p><strong style="font-size: 16.0px;">3.1.4 BIST sequence and corresponding checks</strong></p><ol><li>BIST sequence is run before any type of error injection or when clearing out all types of faults</li><li><a class="external-link" href="https://confluence.arteris.com/pages/viewpage.action?spaceKey=OP&amp;title=Arch-Resiliency" rel="nofollow">https://confluence.arteris.com/pages/viewpage.action?spaceKey=OP&amp;title=Arch-Resiliency</a> : Page 8</li><li>One BIST step completes after following steps:<ol><li>bist_next (System) == 1</li><li>bist_next_ack of a unit == 1</li><li>bist_next (System) == 0</li><li>bist_next_ack of a unit == 0</li></ol></li><li>Checks are implemented per unit:<br/><ol><li>After the first BIST step, Corr/Mission/Latent faults should all be 0</li><li>After the second BIST step, Mission and Latent both faults go to 1</li><li>After the third BIST step, Mission fault should be 0 and Latent fault should be 1</li><li>After the fourth BIST step, Mission fault should be 1 and Latent fault should be 0</li><li>After final BIST step, Mission/Latent faults should all be 0<ol><li><p>After final BIST step finishes, wait for 500 cycles then check all faults should be 0</p></li></ol></li></ol></li></ol><h3 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-3.1.5ForceMission/Latent/Cerrfaults"><strong>3.1.5 Force Mission/Latent/Cerr faults</strong></h3><ol><li>Knobs used:<strong>  &quot;test_mission_fault_connections_in_full_system</strong>&quot;, &quot;<strong>test_latent_fault_connections_in_full_system</strong>&quot; and &quot;<strong>test_cerr_fault_connections_in_full_system</strong>&quot;</li><li>Force Mission/Latent/Cerr faults of N number of units to be high (where N is a random number, less than or equal to the total number of Units)</li><li>Check that the system Mission/Latent/Cerr fault go high when test ends</li></ol><h2 id="Ncore2.6ResiliencyVerificationTestplan(UnitLevelandSystemLevel)-3.2ResiliencyparametersoftheAPFsused">3.2 Resiliency parameters of the APFs used</h2><p style="margin-left: 30.0px;">APFs shown in the following table have been used in Resiliency verification:</p><p style="margin-left: 30.0px;">All the APFs can be found inside &quot;<em>test_projects/fsys_v2.0_configs</em>&quot;</p><p style="margin-left: 30.0px;"><strong>Testlist path:</strong><em> sub_sys/</em>tb<em>/fsys_v2.0_testlist_resil_new</em></p><div class="table-wrap"><table style="margin-left: 30.0px;" class="confluenceTable"><tbody><tr><th style="margin-left: 30.0px;" class="confluenceTh">APF #</th><th style="margin-left: 30.0px;" class="confluenceTh">Unit duplication</th><th style="margin-left: 30.0px;" class="confluenceTh">Transport protection</th><th style="margin-left: 30.0px;" class="confluenceTh">Native protection</th><th colspan="1" class="confluenceTh">useCleanDirtyInterface </th><th colspan="1" class="confluenceTh">Name</th><th colspan="1" class="confluenceTh">Comments</th></tr><tr style="margin-left: 30.0px;"><td style="margin-left: 30.0px;" class="confluenceTd"><span class="inline-comment-marker" data-ref="62393db6-33bd-4089-9175-ac333aaf5bc0">1</span></td><td style="margin-left: 30.0px;" class="confluenceTd"><span class="inline-comment-marker" data-ref="62393db6-33bd-4089-9175-ac333aaf5bc0">No</span></td><td style="margin-left: 30.0px;" class="confluenceTd"><span class="inline-comment-marker" data-ref="62393db6-33bd-4089-9175-ac333aaf5bc0">None</span></td><td style="margin-left: 30.0px;" class="confluenceTd">Yes</td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd"><span class="inline-comment-marker" data-ref="62393db6-33bd-4089-9175-ac333aaf5bc0">fsys_config5_None._PH.apf</span></td><td colspan="1" class="confluenceTd"><p style="margin-left: 0.0px;text-align: left;">remove the following error injections since transportation is None:</p><p style="margin-left: 0.0px;text-align: left;">inject_sfi_slv_data_uncorr_error (inject error on sfi_slv_req_data), inject_sfi_slv_req_uncorr_error(inject error on sfipriv/prot/addr)</p></td></tr><tr style="margin-left: 30.0px;"><td style="margin-left: 30.0px;" class="confluenceTd">2</td><td style="margin-left: 30.0px;" class="confluenceTd">No</td><td style="margin-left: 30.0px;" class="confluenceTd">Parity</td><td style="margin-left: 30.0px;" class="confluenceTd">No</td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd">fsys_config5_Parity.apf</td><td colspan="1" class="confluenceTd"> </td></tr><tr style="margin-left: 30.0px;"><td style="margin-left: 30.0px;" class="confluenceTd">3</td><td style="margin-left: 30.0px;" class="confluenceTd">No</td><td style="margin-left: 30.0px;" class="confluenceTd">ECC</td><td style="margin-left: 30.0px;" class="confluenceTd"><span>No</span></td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd">fsys_config5_ECC.apf</td><td colspan="1" class="confluenceTd"> </td></tr><tr style="margin-left: 30.0px;"><td style="margin-left: 30.0px;" class="confluenceTd">4</td><td style="margin-left: 30.0px;" class="confluenceTd">Yes</td><td style="margin-left: 30.0px;" class="confluenceTd"><span>None</span></td><td style="margin-left: 30.0px;" class="confluenceTd"><span>No</span></td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd">fsys_config5_UD_None.apf</td><td colspan="1" class="confluenceTd"><p>remove the following error injections since transportation is None:</p><p>inject_sfi_slv_data_uncorr_error (inject error on sfi_slv_req_data), inject_sfi_slv_req_uncorr_error(inject error on sfipriv/prot/addr)</p></td></tr><tr style="margin-left: 30.0px;"><td style="margin-left: 30.0px;" class="confluenceTd">5</td><td style="margin-left: 30.0px;" class="confluenceTd">Yes</td><td style="margin-left: 30.0px;" class="confluenceTd"><span>Parity</span></td><td style="margin-left: 30.0px;" class="confluenceTd"><span>No</span></td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd">fsys_config5_UD_Parity.apf</td><td colspan="1" class="confluenceTd"> </td></tr><tr style="margin-left: 30.0px;"><td style="margin-left: 30.0px;" class="confluenceTd">6</td><td style="margin-left: 30.0px;" class="confluenceTd">Yes</td><td style="margin-left: 30.0px;" class="confluenceTd">ECC</td><td style="margin-left: 30.0px;" class="confluenceTd"><span>No</span></td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd">fsys_config5_UD_ECC.apf</td><td colspan="1" class="confluenceTd"> </td></tr><tr style="margin-left: 30.0px;"><td colspan="1" class="confluenceTd">7</td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd">ECC</td><td colspan="1" class="confluenceTd"><p>Yes for all units with both coherent and</p><p>non-coherent protection enabled</p></td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd"><p>fsys_config5_ECC_Coh_Ncoh_PH.apf</p></td><td colspan="1" class="confluenceTd"> </td></tr><tr style="margin-left: 30.0px;"><td colspan="1" class="confluenceTd">8</td><td colspan="1" class="confluenceTd">Yes</td><td colspan="1" class="confluenceTd">ECC</td><td colspan="1" class="confluenceTd"><p>Yes for all units with both coherent and</p><p>non-coherent protection enabled</p></td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd"><p>fsys_config5_UD_ECC_Coh_Ncoh_PH.apf</p></td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">9</td><td class="confluenceTd">No</td><td class="confluenceTd">Parity</td><td class="confluenceTd">No</td><td class="confluenceTd">Yes</td><td class="confluenceTd">fsys_config5_Parity_cln_dty.apf</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">10</td><td class="confluenceTd">No</td><td class="confluenceTd">ECC</td><td class="confluenceTd">No</td><td class="confluenceTd">Yes</td><td class="confluenceTd">fsys_config5_ECC<span>_cln_dty</span>.apf</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">11</td><td class="confluenceTd">Yes</td><td class="confluenceTd">None</td><td class="confluenceTd">No</td><td class="confluenceTd">Yes</td><td class="confluenceTd">fsys_config5_UD_None<span>_cln_dty</span>.apf</td><td colspan="1" class="confluenceTd"><p style="margin-left: 0.0px;text-align: left;">remove the following error injections since transportation is None:</p><p style="margin-left: 0.0px;text-align: left;">inject_sfi_slv_data_uncorr_error (inject error on sfi_slv_req_data), inject_sfi_slv_req_uncorr_error(inject error on sfipriv/prot/addr)</p></td></tr><tr><td class="confluenceTd">12</td><td class="confluenceTd">Yes</td><td class="confluenceTd">Parity</td><td class="confluenceTd">No</td><td class="confluenceTd">Yes</td><td class="confluenceTd">fsys_config5_UD_Parity<span>_cln_dty</span>.apf</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">13</td><td class="confluenceTd">Yes</td><td class="confluenceTd">ECC</td><td class="confluenceTd">No</td><td class="confluenceTd">Yes</td><td class="confluenceTd">fsys_config5_UD_ECC<span>_cln_dty</span>.apf</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">14</td><td class="confluenceTd">No</td><td class="confluenceTd">ECC</td><td class="confluenceTd"><p>Yes for all units with both coherent and</p><p>non-coherent protection enabled</p></td><td class="confluenceTd">Yes</td><td class="confluenceTd"><p>fsys_config5_ECC_Coh_Ncoh_PH<span>_cln_dty</span>.apf</p></td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd">15</td><td class="confluenceTd">Yes</td><td class="confluenceTd">ECC</td><td class="confluenceTd"><p>Yes for all units with both coherent and</p><p>non-coherent protection enabled</p></td><td class="confluenceTd">Yes</td><td class="confluenceTd"><p>fsys_config5_UD_ECC_Coh_Ncoh_PH<span>_cln_dty</span>.apf</p></td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">16</td><td colspan="1" class="confluenceTd">No</td><td colspan="1" class="confluenceTd">None</td><td colspan="1" class="confluenceTd">Yes</td><td colspan="1" class="confluenceTd">Yes</td><td colspan="1" class="confluenceTd">fsys_config5_None_PH_cln_dty.apf</td><td colspan="1" class="confluenceTd"> </td></tr></tbody></table></div><p>TODO: Run above tests on an APF with useCleanDirtyInterface enabled.</p>