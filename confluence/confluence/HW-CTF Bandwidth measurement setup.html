<p>This page describes a proposal on how to set up events and timer resources in PMON blocks using their parameters to generate logic for bandwidth measurement of an ATP link. The BW measurement here is defined for an ATP link and is expected to be measured as the ratio of two values: Number of beats sent on the link / Number of clock-ticks during the same interval. The measurement involves providing timer registers that measure the numerator and denominator quantities separately. The ratio is expected to be calculated by the software that programs these registers.</p><h2 id="HW-CTFBandwidthmeasurementsetup-Events">Events</h2><p>To generate the number of beats sent on an ATP link, this setup relies on just one event - the <em>beat_sent</em> reference event from a pmon_probe. The <em>beat_sent</em> event is an event that is generated for every valid-ready handshake on the ATP link on which the probe sits. This event is used to count the BW Timer.</p><h2 id="HW-CTFBandwidthmeasurementsetup-Timers">Timers</h2><p>The setup requires two timers </p><ol><li>BW - Timer to count every <em>beat_sent</em> event if en_bw_measurement is high.</li><li>BW_REF - Reference timer that counts every clock if en_bw_measurement is high.</li></ol><h2 id="HW-CTFBandwidthmeasurementsetup-Registers">Registers</h2><p>Each of the two timers comes with a set of 4 registers:</p><ol><li>Timer value (val)</li><li>Timer limit (limit)</li><li>Timer control (ctrl)</li><li>Timer enable and mode (en_mode)</li></ol><p>In addition this setup requires a user-defined register in pmon_stats to hold the en_bw_measurement bit.</p><h2 id="HW-CTFBandwidthmeasurementsetup-Stepstomeasure">Steps to measure</h2><p>The measurement starts with programming the duration of measurement in the BW_REF_limit register. To actually start the measurement, the <em>en_bw_measurement</em> bit needs to be set. Once set both the timers stop counting only when the BW_REF_val reaches the limit programmed in the limit register. A BW_REF timer event is generated internally which can be used to freeze both the timers and generate an interrupt to indicate completion of the measurement. </p><p>Software is then expected to read the value in the two registers and compute the ratio to determine the BW in the programmed interval.</p><p><br/></p><p><br/></p><p><br/></p>