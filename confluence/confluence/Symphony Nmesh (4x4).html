<h1 id="SymphonyNmesh(4x4)-Themeshhasthefollowingtopology">The mesh has the following topology</h1><p>The top uses a template named meshSMI_Nmesh.json.template. It maps the I/O ports in meshATP_Nmesh.json.template has follows</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">in SMI</th><th class="confluenceTh">in ATP</th><th class="confluenceTh">out SMI</th><th class="confluenceTh">out ATP</th></tr><tr><td class="confluenceTd">smi_I0_</td><td class="confluenceTd">sw0_0_I0_</td><td class="confluenceTd">smi_Z0_</td><td class="confluenceTd">sw0_0_Z0_</td></tr><tr><td class="confluenceTd">smi_I1_</td><td class="confluenceTd">sw0_1_I0_</td><td class="confluenceTd">smi_Z1_</td><td class="confluenceTd">sw0_1_Z0_</td></tr><tr><td class="confluenceTd">smi_I2_</td><td class="confluenceTd">sw0_2_I0_</td><td class="confluenceTd">smi_Z2_</td><td class="confluenceTd">sw0_2_Z0_</td></tr><tr><td class="confluenceTd">smi_I3_</td><td class="confluenceTd">sw0_3_I0_</td><td class="confluenceTd">smi_Z3_</td><td class="confluenceTd">sw0_3_Z0_</td></tr><tr><td class="confluenceTd">smi_I4_</td><td class="confluenceTd">sw1_0_I0_</td><td class="confluenceTd">smi_Z4_</td><td class="confluenceTd">sw1_0_Z0_</td></tr><tr><td class="confluenceTd">smi_I5_</td><td class="confluenceTd">sw1_1_I0_</td><td class="confluenceTd">smi_Z5_</td><td class="confluenceTd">sw1_1_Z0_</td></tr><tr><td class="confluenceTd">smi_I6_</td><td class="confluenceTd">sw1_2_I0_</td><td class="confluenceTd">smi_Z6_</td><td class="confluenceTd">sw1_2_Z0_</td></tr><tr><td class="confluenceTd">smi_I7_</td><td class="confluenceTd">sw1_3_I0_</td><td class="confluenceTd">smi_Z7_</td><td class="confluenceTd">sw1_3_Z0_</td></tr><tr><td class="confluenceTd">smi_I8_</td><td class="confluenceTd">sw2_0_I0_</td><td class="confluenceTd">smi_Z8_</td><td class="confluenceTd">sw2_0_Z0_</td></tr><tr><td class="confluenceTd">smi_I9_</td><td class="confluenceTd">sw2_1_I0_</td><td class="confluenceTd">smi_Z9_</td><td class="confluenceTd">sw2_1_Z0_</td></tr><tr><td class="confluenceTd">smi_I10_</td><td class="confluenceTd">sw2_2_I0_</td><td class="confluenceTd">smi_Z10_</td><td class="confluenceTd">sw2_2_Z0_</td></tr><tr><td class="confluenceTd">smi_I11_</td><td class="confluenceTd">sw2_3_I0_</td><td class="confluenceTd">smi_Z11_</td><td class="confluenceTd">sw2_3_Z0_</td></tr><tr><td class="confluenceTd">smi_I12_</td><td class="confluenceTd">sw3_0_I0_</td><td class="confluenceTd">smi_Z12_</td><td class="confluenceTd">sw3_0_Z0_</td></tr><tr><td class="confluenceTd">smi_I13_</td><td class="confluenceTd">sw3_1_I0_</td><td class="confluenceTd">smi_Z13_</td><td class="confluenceTd">sw3_1_Z0_</td></tr><tr><td class="confluenceTd">smi_I14_</td><td class="confluenceTd">sw3_2_I0_</td><td class="confluenceTd">smi_Z14_</td><td class="confluenceTd">sw3_2_Z0_</td></tr><tr><td colspan="1" class="confluenceTd">smi_I15_</td><td colspan="1" class="confluenceTd">sw3_3_I0_</td><td colspan="1" class="confluenceTd">smi_Z15_</td><td colspan="1" class="confluenceTd">sw3_3_Z0_</td></tr></tbody></table></div><p>The following figure shows the topology implemented in meshATP_Nmesh.json.template</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="https://arterisip.atlassian.net/wiki/download/attachments/16155728/veriph_Nmesh.svg?api=v2"></span></p><p>Each U_swY_X represents a node in the mesh and they are all identical. Each node starts as node_Nmesh.json.template and looks like</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="https://arterisip.atlassian.net/wiki/download/attachments/16155728/veriph_Nmesh_node.svg?api=v2"></span></p><h1 id="SymphonyNmesh(4x4)-IDtoPortMapping">ID to Port Mapping</h1><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Port</th><th colspan="2" class="confluenceTh">ID (Hex)</th></tr><tr><td class="confluenceTd"><p>0</p></td><td colspan="2" class="confluenceTd"><pre>{5'd0,5'd0} ('h0)</pre></td></tr><tr><td class="confluenceTd"><p>1</p></td><td colspan="2" class="confluenceTd"><pre>{5'd0,5'd1} ('h1)</pre></td></tr><tr><td class="confluenceTd"><p>2</p></td><td colspan="2" class="confluenceTd"><pre>{5'd0,5'd2} ('h2)</pre></td></tr><tr><td class="confluenceTd"><p>3</p></td><td colspan="2" class="confluenceTd"><pre>{5'd0,5'd3} ('h3)</pre></td></tr><tr><td class="confluenceTd"><p>4</p></td><td colspan="2" class="confluenceTd"><pre>{5'd1,5'd0} ('h20)</pre></td></tr><tr><td class="confluenceTd"><p>5</p></td><td colspan="2" class="confluenceTd"><pre>{5'd1,5'd1} ('h21)</pre></td></tr><tr><td class="confluenceTd"><p>6</p></td><td colspan="2" class="confluenceTd"><pre>{5'd1,5'd2} ('h22)</pre></td></tr><tr><td class="confluenceTd"><p>7</p></td><td colspan="2" class="confluenceTd"><pre>{5'd1,5'd3} ('h23)</pre></td></tr><tr><td class="confluenceTd"><p>8</p></td><td colspan="2" class="confluenceTd"><pre>{5'd2,5'd0} ('h40)</pre></td></tr><tr><td class="confluenceTd"><p>9</p></td><td colspan="2" class="confluenceTd"><pre>{5'd2,5'd1} ('h41)</pre></td></tr><tr><td class="confluenceTd"><p>10</p></td><td colspan="2" class="confluenceTd"><pre>{5'd2,5'd2} ('h42)</pre></td></tr><tr><td class="confluenceTd"><p>11</p></td><td colspan="2" class="confluenceTd"><pre>{5'd2,5'd3} ('h43)</pre></td></tr><tr><td class="confluenceTd"><p>12</p></td><td colspan="2" class="confluenceTd"><pre>{5'd3,5'd0} ('h60)</pre></td></tr><tr><td class="confluenceTd"><p>13</p></td><td colspan="2" class="confluenceTd"><pre>{5'd3,5'd1} ('h61)</pre></td></tr><tr><td class="confluenceTd"><p>14</p></td><td colspan="2" class="confluenceTd"><pre>{5'd3,5'd2} ('h62)</pre></td></tr><tr><td class="confluenceTd"><p>15</p></td><td colspan="2" class="confluenceTd"><pre>{5'd3,5'd3} ('h63)</pre></td></tr></tbody></table></div><p> </p><h1 id="SymphonyNmesh(4x4)-Togeneratea4x4mesh,Createaregressionarea.">To generate a 4x4 mesh, Create a regression area.</h1><pre>mkdir {fill_in_directory_name_here}<br/>cd {directory_name}<br/>/engr/dev/tools/script/setup_sym -d master<br/>source SOURCEME.tcsh <br/>(for bash: source SOURCEME.bash)</pre><h1 id="SymphonyNmesh(4x4)-CDtoNmesharea">CD to Nmesh area</h1><p>cd $WORK_TOP/tb/top/Nmesh</p><h1 id="SymphonyNmesh(4x4)-CreateanJSONfilethat&#39;sconfiguredforthenetworkyouaretryingtocreate.">Create an JSON file that's configured for the network you are trying to create.</h1><p>An example exist in the directory called BasePketParamsExpl.json</p><p>The route must be 30 to support X-Y-X or Y-X-Y routing.</p><p>The width of H_pri must be 3.</p><p>The width of steer in SMI must be 0. The width of H_steer must be 0.</p><p>The IDs are hardcoded to width of 10 This first 5 are the Y in the mesh and the last 5 are the X in the mesh. The instanced name is u_swY_X in above figures.</p><p>Number of VCs must be 1 ($4 of create_Nmesh.sh)</p><h1 id="SymphonyNmesh(4x4)-Runcreate_Nmesh.shscripttogenerateyournetwork">Run create_Nmesh.sh script to generate your network</h1><p>The script includes usage:</p><pre>[jcodd@mondavi Nmesh]$ ./create_Nmesh.sh<br/>ERROR: ./create_Nmesh.sh Not enough arguments<br/>USAGE: ./create_Nmesh.sh $1 $2 $3 $4 $5 $6 $7<br/> $1 = JSON file to base backet parameters<br/> $2 = target data width<br/> $3 = packet type (parallel, serial or fixed)<br/> $4 = number of VCs<br/> $5 = arbType for all switch arbs<br/> $6 = name to give mesh<br/> $7 = Value for lock on Valid in sym_switch</pre><pre>Base packet parameters JSON file format:<br/> { &quot;params&quot; {base packet parameters}}</pre><pre>[jcodd@mondavi Nmesh]$ ./create_Nmesh.sh BasePketParamsExpl.json 128 parallel 1 arb_pri_rr1 req false</pre><pre>Bus width: 384<br/>max_beats: 4<br/>header_width: 231<br/>max_header_field_width: 136<br/>data_beat_multiplier: 8<br/>data_beat_width: 153<br/>min_data_beat_width_F: 19<br/>min_data_beat_width_C: 1<br/>min_data_width: 16<br/>number_data_beats: 4<br/>null bits to total bits: 0.451171875<br/>data bits to beat bits: 0.3984375</pre><pre><span style="font-family: Arial , sans-serif;">The above command creates a top level JSON file named req_meshATP_Nmesh.json, where &quot;req&quot; is the name passed in for $6. All the sub files are uniquified with the $6 string, including the packet cpr, which is put in the cpr directory.</span></pre><h1 id="SymphonyNmesh(4x4)-RunthefollowingcommandtogeneratetheveriloginaDirectorycalledNmesh:">Run the following command to generate the verilog in a Directory called Nmesh:</h1><p>./run_Nmesh req_meshATP_Nmesh.json gen_wrapper.tachl Nmesh</p><h1 id="SymphonyNmesh(4x4)-Thepieces">The pieces</h1><p>BasePketParamsExpl.json: Example JSON file that describes base packet definition<br/>calc_xy_route.js: A javascript program that calculates the route for smi_pkt.tachl based on target ID. Sixteen JSONs are created to use by the sixteen pkt_smi.<br/>create_intSMI.js: Takes in a Base Packet parameter file and caculates the SMI parameters needed for a SMI interface to fully utilize packet.<br/>create_Nmesh.sh: A sh script that creates the Nmesh based on your inputs<br/>depkt_Nmesh.json.template: A JSON file template used to generate the JSON file for the smi_depkt used in design<br/>meshATP_Nmesh.json.template: A JSON file template used to generate the JSON file for the ATP mesh. Done in a generic wrapper.<br/>meshSMI_Nmesh.json.template: A JSON file template use to generate the JSON file that instances the ATP mesh and all the smi_pkt and smi_depkt used. Done in a generic wrapper.<br/>Nmesh: A directory that contains some files I use to validate the design.<br/>node_Nmesh.json.template: A JSON file template used to generate the JSON file that creates a node in the mesh. Done in a generic wrapper. Contains a 5x5 switch and 5 pipeline stages.<br/>pkt_Nmesh.json.template: A JSON file template used to generate the JSON files that create the smi_pkt instances used in the design. Sixteen version are created.<br/>run_Nmesh: A sh script used to run TACHL on the generated JSON files.<br/>sym_pipe_Nmesh.json.template: A JSON file template used to generate the JSON file for the pipeline stages.</p><p> </p>