<h2 id="process_testlist.py-JIRAsofinterest"><style>[data-colorid=krc7ug94k5]{color:#ff5630} html[data-color-mode=dark] [data-colorid=krc7ug94k5]{color:#cf2600}[data-colorid=ekssdrf82m]{color:#ff5630} html[data-color-mode=dark] [data-colorid=ekssdrf82m]{color:#cf2600}[data-colorid=benex1rlu0]{color:#ff5630} html[data-color-mode=dark] [data-colorid=benex1rlu0]{color:#cf2600}[data-colorid=d96h0kethd]{color:#ff5630} html[data-color-mode=dark] [data-colorid=d96h0kethd]{color:#cf2600}</style><span data-colorid="d96h0kethd">JIRAs of interest</span></h2><ul><li><p>

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="CONC-10759">
                <a href="https://arterisip.atlassian.net/browse/CONC-10759?src=confmacro" class="jira-issue-key">CONC-10759</a>
                            </span>
 </p></li></ul><hr /><h2 id="process_testlist.py-Whatisthisabout?"><span data-colorid="krc7ug94k5">What is this about?</span></h2><p>I spent a day trying to cleanup IOAIU testlist started manually. But with more clarity on the current state and end goal, realized it would be better to script it for the following benefits:-</p><ul><li><p>Can be reused in the future with other test lists</p></li><li><p>Chances of manual errors are lesser</p></li></ul><p>There are a few limitations though:-</p><ul><li><p>Parsing a testlist json is very challenging as users can get creative in so many ways</p></li><li><p>This results in this script requiring update for scenarios not accounted for (party due to my limited experience with the testlist)</p></li></ul><p>Now to the usage of the script and sharing outputs:-</p><hr /><h2 id="process_testlist.py-Howtousethescript?"><span data-colorid="benex1rlu0">How to use the script?</span></h2><p style="margin-left: 30.0px;"><code>usage: process_testlist.py [-h] --tlist TLIST [--fmt_tlist FMT_TLIST]</code><br /><code>                           [--flatten_config] [--flatten_plusargs]</code><br /><code>                           [--merge_flavors]</code><br /><code>                           [--flavor_match_length FLAVOR_MATCH_LENGTH]</code><br /><code>                           [--get_stats] [--get_flavor_candidates] [--debug]</code><br /><code>                           [--verbose]</code></p><p style="margin-left: 30.0px;"><code>used to analyze the given testlist</code></p><p style="margin-left: 30.0px;"><code>optional arguments:</code><br /><code>  -h, --help            show this help message and exit</code><br /><code>  --tlist TLIST         testlist with path</code><br /><code>  --fmt_tlist FMT_TLIST</code><br /><code>                        name of formatted testlist</code><br /><code>  --flatten_config      print configs in one line to make json readable</code><br /><code>  --flatten_plusargs    print plusargs in one line to make json readable</code><br /><code>  --merge_flavors       merge flavor candidates and dumps it into a new</code><br /><code>                        testlist with a prefix merged_flavors</code><br /><code>  --flavor_match_length FLAVOR_MATCH_LENGTH</code><br /><code>                        number of characters to match in testname for flavor</code><br /><code>                        match</code><br /><code>  --get_flavor_candidates</code><br /><code>                        get the flavor candidates that can be potentially</code><br /><code>                        merged using flavors</code><br /><code>  --debug               steps through one test at a time and turns on verbose</code><br /><code>                        mode</code><br /><code>  --verbose             print debug messages</code></p><hr /><h2 id="process_testlist.py-Explainingaboveoptions"><span data-colorid="ekssdrf82m">Explaining above options</span></h2><p>Let me illustrate how the above options can be used with some examples:-</p><ul><li><p><code>--fmt_list FMT_LIST</code></p><ul><li><p>This option is used if the testlist format is messed up with different tab-spaces/spaces being used</p></li><li><p>This option creates file names <code>FMT_LIST</code> that contains neatly formatted contents with proper indentation to make the json more readable</p><ul><li><p>Each config is expanded by default to make it more readable</p></li><li><p>Each plusargs is expanded by default to make it more readable</p></li><li><p>Each label is flattened into one line for concise content</p></li><li><p>Each flavor is flattened into one line for concise content</p></li></ul></li><li><p>This can be used along with <code>--flatten_config</code> and <code>--flatten_plusargs</code></p><ul><li><p><code>--flatten_config</code></p><ul><li><p>Flattens config associated with each test entry into one line</p></li><li><p>This is used when you want a very concise view of the json and looking at configs is not important</p></li></ul></li><li><p><code>--flatten_plusargs</code></p><ul><li><p>Flattens plusargs into a single line to give a concise view of the json</p></li></ul></li><li><p>Note that, we can always go back to older formats if we rerun the script with <code>--fmt_tlist</code> option without the <code>--flatten*</code> options</p></li><li><p>I used the above options when I wanted to review/edit the labels, where the expanded view of config and plusarg was taking too much space and was a pain to scroll through</p></li></ul></li></ul></li><li><p><code>--get_flavor_candidates</code></p><ul><li><p>Prints out test entries in the json that can possibly be merged into flavors</p></li><li><p>When multiple test entries in the json use the same uvm_test and same set of configs, this makes it eligible to be merged under flavors, thus avoiding duplicated contents in the json file</p></li><li><p>Note that this just informs the user of the script who are all the flavor candidates and doesn't merge them yet</p></li></ul></li><li><p><code>--merge_flavors</code></p><ul><li><p>When used, the script goes through the identified flavor candidates and checks who are all potential matches by matching <code>FLAVOR_MATCH_LENGTH</code> number of characters of the test entry name</p></li><li><p>If there are more than one possible match, then they are merged as flavors</p></li><li><p>The new flavor name is the name of the test entry, thus ensuring the user can still run that test entry using proper wild card option with runsim</p></li><li><p>This also prints stats before merge and after merge to understand what happens before and after this run</p></li><li><p>Note that, there is manual effort involved after this step, namely</p><ul><li><p>Rename the merged test entry name</p><ul><li><p>When the script tries to merge two or more test entries, it doesn't know the new test entry should be name as and just uses <code>__merged_entry_FIXME_&lt;id&gt;</code>. User then can open the merged flavor file, look for the FIXME tag and replace it with proper name</p></li><li><p>Similarly, the script doesn't know what the purpose of the new merged test entry is going to be. User needs to update that as well</p></li></ul></li></ul></li></ul></li><li><p>IOAIU testlist stats looked as below before and after merge (reduced the contents by 40%)</p></li></ul><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" width="680" src="https://arterisip.atlassian.net/wiki/download/attachments/125895076/image-20230114-090346.png?api=v2" /></span><p /><p />