<p> </p><p>This page is written with Symphony DV team in mind, but examples can be applied to other functional pieces of the tool </p><h4 id="Ariadeveloperguide-Prerequisites">Prerequisites</h4><p>Make sure you use RH7 host, such as gr6-3 and do <code>module load dev/maestro_test/stable</code> - this sets correct version of node.js and few other things </p><h4 id="Ariadeveloperguide-AccessingAriacode">Accessing Aria code</h4><p>Git repository is here: <a class="external-link" href="http://gitlab.arteris.com/maestro-dev/services/m-phys" rel="nofollow">http://gitlab.arteris.com/maestro-dev/services/m-phys</a>  </p><p>*It's called m-phys rather than aria for historical reasons. Too much trouble to rename...</p><p>To clone code in you local dir:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">git clone git@gitlab.arteris.com:maestro-dev/services/m-phys.git</pre>
</div></div><p>Add the following to your .bashrc, otherwise testing script shown below wont' work</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">export ARIA_SRC=&lt;Path to dir where you cloned Aria&gt; # In my case /home/bennyw/source_code/m-phys
alias aria-dev=&quot;$ARIA_SRC/node_modules/.bin/electron $ARIA_SRC/src/main.js&quot;</pre>
</div></div><p>This will enable you to start your local version of Aria interactively.</p><h4 id="Ariadeveloperguide-InstallrequiredJavascriptpackages">Install required Javascript packages</h4><p>1.Make sure that you're in $ARIA_SRC dir</p><p>2. Check your node.js version with<strong> <code>node -v</code></strong>   , it should be 10.* </p><p>3. Finally run <strong><code>npm install</code></strong>  , this can take few minutes</p><p><span style="font-weight: bold;">Changing code</span></p><p>Symphony testbench Json generation code was extracted to a separate file <code>src/lib/sym_dv_utils.js</code>  Avoid changing the &quot;core&quot; of the tool (files datamodel.js, parser_utils.js, etc)  </p><h4 id="Ariadeveloperguide-Testingyourchanges">Testing your changes</h4><p>First look at and run this example script : <code>$ARIA_SRC/scripts/gen_sym_dv_json.js</code> and make sure that it doesn't crash and tb.json gets created. I recommend to run it from a separate clean directory, so created files do not mix up with Aria source code.</p><p> There are two ways to run it</p><ol><li>Source as a script in Aria executable<br/><strong><code>aria-dev -s </code></strong><span><strong><code>$ARIA_SRC/scripts/gen_sym_dv_json.js</code></strong><br/></span></li><li>Run under node - in this case Aria is &quot;required&quot;<br/><strong><code>node $ARIA_SRC/scripts/gen_sym_dv_json.js</code></strong></li></ol><p>Here is the entire content of gen_sym_dv_json.js script</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl hide-border-bottom">
  <b class="code-title"></b><span class="collapse-source expand-control" style="display:none;"><span class="expand-control-icon icon">&nbsp;</span><span class="expand-control-text">Expand source</span></span><span class="collapse-spinner-wrapper"></span>
 </div>
 <div class="codeContent panelContent pdl hide-toolbar">
  <pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence; collapse: true" data-theme="Confluence">// Determine if we run this script under node or source in Aria. 
// In the former case we need to require Aria's index.js to load Aria's functionality
if (process.argv[0].split('/').pop() === 'node') {
  let ariaRequireFile;
  if (__dirname === process.env.ARIA_SRC + '/scripts') {
    // If this file is found directly in my source dir, use index.js from the source dir as well
    ariaRequireFile = '../index';
  } else {
    // Otherwise take index.js from Aria deployment area
    ariaRequireFile = '/engr/dev/releases/utils/aria/latest/aria-linux-x64/resources/app/index';
  }
  console.log(`Loading Aria from ${ariaRequireFile}`);
  // Expose critical Aria's functions. Have to use var because variables are accessed outside of the
  // clause of this if. Functions like getObjs are needed if you write custom functions 
  // Return prepopulated symphonyChecker
  var {genSymphonyTbJson,readCpr,readRtlJson,symphonyChecker,getObjs,print,logger} = require(ariaRequireFile);
}

// Optional - add custom checker functions to symphonyChecker. Parameters are
//  a. name 
//  b. callback function performing the check, can be anonymous
//  c. severity - fatal, error (default) or warning
//  d. description - optional 
symphonyChecker.addCheck({
  name:'test_1',
  callback:function() {return true},
  description:'This test always passes'}
);

// Generate Symphony TB json from rtl Json
// Notice two optional parameters
//  symphonyChecker - by default it will run, but won't exit(i.e abort) if errors are detected
//  dutModuleParamsAsFilePath - by default it's false, i.e entire generated TB json is flat
//   and all the params of m_top_wrapper are copied from rtl json
genSymphonyTbJson({
  rtlJsonFile: process.env.ARIA_SRC + '/samples/tb_gen/rtl_4x4_smi.json',
  outputFile: 'tb.json',
  importantPkgParams: ['interfaces.axiInterface','interfaces.smiInterface','pamTid','pamBaseMask','pamBaseAddr'],
  symphonyChecker: {run:true, exitOnError:true},
  dutModuleParamsAsFilePath: true
});
// If we source this script in Aria exec - exit from Aria
if (process.argv[0].split('/').pop() !== 'node') {
  exit();
}</pre>
 </div>
</div><p>If basic function works, run Aria test suite</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">cd $ARIA_SRC
npm run ava</pre>
</div></div><h4 id="Ariadeveloperguide-Re-goldeningtestcases"><br/>Re-goldening testcases</h4><p>If the format of generated DV jsons changes , it may require replacement of &quot;golden&quot; files under<code> $ARIA_SRC/samples/tb_gen<br/></code></p><p>For ex if ,after running npm run ava,  you see that 4x4_smi testcase failed</p><ol><li><h4 id="Ariadeveloperguide-"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="600" src="https://arterisip.atlassian.net/wiki/download/attachments/16166658/image2019-10-4%2016:53:34.png?api=v2"></span></h4></li></ol><p>But you know, that this is expected and the new tb json, which is generated by the test in  ./tmp/tb_4x4_smi.json, is correct. Then all you need to do is to</p><p><strong><code> cp</code> ./tmp/tb_4x4_smi.json<code> $ARIA_SRC/samples/tb_gen/</code></strong></p><p>and then check-in updated $ARIA_SRC/samples/tb_gen/tb_4x4_smi.json with your code change</p><h4 id="Ariadeveloperguide-Checkinginanddeployingyourchanges">Checking in and deploying your changes</h4><p>1.First commit your changes locally with <strong><code>git commit</code></strong>   ,or if you use vscode editor, it's just a button click</p><p>2.If <strong><code>git status</code></strong> shows that your code diverged with remote , merge with git pull --rebase </p><p>3. Finally submit your code with <strong><code>git push</code></strong>. This triggers a  build and deployment process, which you can monitor on <a class="external-link" href="http://jenkins.arteris.com:8080/job/mphys/" rel="nofollow">http://jenkins.arteris.com:8080/job/mphys/</a>, notice the build number</p><p>It usually takes ~5min,  then you can verify that deployed  Aria exec show this last build number</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&gt; aria
****************************************************************************
  Genwrapper analysis utility. Version 0.17.2
  Build id: 128, built at: 2019-10-04 12:31:02 PDT
****************************************************************************</pre>
</div></div><p> </p><h2 id="Ariadeveloperguide-WorkingwithGITbranches">Working with GIT branches</h2><p>If your change is large it's recommended to make it on a branch and then merge here is step-by-step procedure. It shows examples based on existing 'dev' branch, but you can create new branches easily</p><ol><li>Make sure to pull master branch to be sure you start from the most up-to-date code<br/><code>git pull origin master<br/></code> </li><li>Switch to branch 'dev'<br/><code>git checkout dev<br/><br/></code></li><li>Merge master branch into dev<br/><code>git merge master<br/><br/></code></li><li>Check that dev is identical to master. Command below should return no output at all!<br/><code>git diff master</code><br/><br/></li><li>Make the changes. Run testing normally with<br/><code>npm run ava</code><br/><br/></li><li>Commit your changes exactly with the same command/s as you'd do for master branch<br/><code>git commit ... </code><br/><br/></li><li>Push your changes to remote<br/><code>git push -u origin dev</code></li></ol><p>          This will trigger Aria <a class="external-link" href="http://jenkins.arteris.com:8080/job/mphys/" rel="nofollow">pipeline</a>, but it only runs through unit tests! So your code will not be deployed.  </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="150" src="https://arterisip.atlassian.net/wiki/download/attachments/16166658/image2019-11-7%2014:29:25.png?api=v2"></span></p><p>       8.  Submit merge request </p><p>Go to <a class="external-link" href="http://gitlab.arteris.com/maestro-dev/services/m-phys/commits/dev" rel="nofollow">http://gitlab.arteris.com/maestro-dev/services/m-phys/commits/dev</a> and click on Create Merge Request button. </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="500" src="https://arterisip.atlassian.net/wiki/download/attachments/16166658/image2019-11-7%2014:43:0.png?api=v2"></span></p><p>Choose benny as assignee and specify source -&gt; dev and target -&gt; master</p><p> </p><p> </p>