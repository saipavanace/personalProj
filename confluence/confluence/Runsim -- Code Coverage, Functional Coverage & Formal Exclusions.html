<p>runsim has code coverage options integrated inside that takes care of running the code coverage, merging the coverage database and generating HTML report files.</p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-1.1Usage:">1.1 Usage:</h3><p>Along with the standard runsim options that select a regression (or a test) to run, the following additional options are available:</p><pre>-c_cov : Code Coverage                    - Specify this option to enable Code Coverage<br/>-cca   : Code Coverage All tests          - Specify this option to enable Code Coverage on Passing + Failing tests (Default is only passing tests)<br/>-ccme  : Merge ExclusionsDo File          - Specify this option to enable merging of the exclusions DoFile in the ucdb generated by covercheck tool in Code Coverage (testlist needs to have the pointer to exclusionsDoFile and/or patFile)<br/>-ccmu  : Merge Previous Regression Ucdb   - Specify this option to enable merging of the ucdb's from previous regression runs in Code Coverage (only works on same work area)<br/>-cx    : Code Coverage Formal Cover Check - Specify this option to enable formal cover check in Code Coverage<br/><br/>-f_cov : Functional Coverage              - Specify this option to enable Functional Coverage</pre><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-1.2Examplerunsimcommand:">1.2 Example runsim command:</h3><p><span class="legacy-color-text-blue4"><strong>runsim -e ioaiu -l regr_cov -c_cov -f_cov -ccmu -ccme</strong></span></p><p>Here the runsim command runs IOAIU block level regression for label &quot;regr_cov&quot; with code coverage (-c_cov) &amp; functional coverage (-f_cov) enabled.<br/>The additional options -ccme enables merging of the external exclusions.do file &amp; pattern file generated by find_pat.js script (Further explained in detail in Section 2.1 &amp; 2.2 below),<br/>-ccmu enables merging from previous regression coverage database, if any present at $WORK_TOP/regression. (Note that this only works when used in the same ncore work area) </p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-1.3HTMLreportandUcdbDumpFolder:">1.3 HTML report and Ucdb Dump Folder:</h3><p>All the coverage ucdb's (universal coverage data base) &amp; HTML report files are dumped in the regression directory in this folder format:</p><p>$WORK_TOP/regession/<em>&lt;time_stamp&gt;</em>/debug/<em>&lt;block_name&gt;</em>/<em>&lt;config_name&gt;</em>/coverage/<strong>merged_<em>&lt;block_name&gt;_&lt;config_name&gt;</em>.ucdb</strong></p><p>$WORK_TOP/regession/<em>&lt;time_stamp&gt;</em>/debug/<em>&lt;block_name&gt;</em>/<em>&lt;config_name&gt;</em>/coverage<strong>/html/index.html</strong></p><p><strong>Example: </strong><span class="legacy-color-text-blue4">/scratch/kavish/8JanCodeCov/hw-ncr/regression/2022_01_17_1615/debug/ioaiu/hw_cfg_2_ioc_64b/coverage/merged_ioaiu_hw_cfg_2_ioc_64b.ucdb</span></p><p><strong>Command to load UCDB</strong> : <span class="legacy-color-text-blue4"><strong>vsim -viewcov &lt;path_to.ucdb&gt;</strong></span></p><p><span class="legacy-color-text-default">Click-able HTML reports can also be accessed from the regression report generated by runsim present at following folder → $WORK_TOP/regession/<em>&lt;time_stamp&gt;</em>/regression_report_<em>&lt;time_stamp&gt;</em>.html</span></p><p><span class="legacy-color-text-default"><br/><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="https://arterisip.atlassian.net/wiki/download/attachments/16159829/image2022-1-24_4-31-55.png?api=v2"></span><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="https://arterisip.atlassian.net/wiki/download/attachments/16159829/image2022-1-24_4-32-39.png?api=v2"></span><br/></span></p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-2.1Addingexclusions.dofilesinrunsim_testlistfor-ccmeswitch">2.1 Adding exclusions.do files in runsim _testlist for -ccme switch </h3><p>runsim_testlist.json requires pointer to the exclusion.do files that need to be merged with the coverage.<br/><span class="legacy-color-text-pink1"><strong>Note: </strong></span>Multiple do files can be passed by comma &quot;,&quot; separating them.<br/>And <span class="legacy-color-text-orange2">-ccme switch needs to be enabled</span> to use this on the runsim command line.<br/>This is the example of how the runsim_testlist option will look like:</p><p>&quot;256b_narrow_axid&quot;: {<br/>             &quot;purpose&quot;: &quot;coverage test&quot;,<br/>             &quot;tcl_lib&quot;: &quot;hw_config_01&quot;,<br/>             &quot;tcl_dir&quot;: &quot;$WORK_TOP/../test_projects/ncore_v3.0_configs/dii_config/256b_narrow_axid&quot;,<br/>              &quot;instance&quot; : &quot;dii0&quot;,<br/>             &quot;compile_args&quot;: &quot;&quot;,<br/>             &quot;<span class="legacy-color-text-red2"><strong>exclusionsDoFile</strong></span>&quot;: &quot;$WORK_TOP/rtl/dii/exclusions/dii_256b_narrow_axid.do&quot;,<br/>             &quot;label&quot;: [&quot;regr_cov&quot;, &quot;tachl_cover&quot;]<br/>         },</p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-2.2Addingpattern.jsonfilesinrunsimtestlistforfind_pat.jsscriptwith-ccmeswitch">2.2 Adding pattern.json files in runsim testlist for find_pat.js script with -ccme switch </h3><p>Runsim.js has integrated find_pat.js script which generates rtl exclusions on the fly according to generated code.<br/>Runsim requires a pointer to the json file that feeds into the find_pat.js script<br/><span class="legacy-color-text-pink1"><strong>Note</strong></span>: Unlike exclusionsDoFile, only 1 json file can be accepted in this option.<br/>And<span class="legacy-color-text-orange2"> -ccme switch needs to be enabled</span> to use this on the runsim command line.<br/>So any exclusion .do files generated by this script<strong> will be merged internally, we do not have to checkin</strong> rtl_exclusions.do file generated from the find_pat.js script output, only the pattern.json file should be checked in.<br/>This is the example of how the runsim_testlist option will look like:</p><p>&quot;256b_narrow_axid&quot;: {<br/>             &quot;purpose&quot;: &quot;coverage test&quot;,<br/>             &quot;tcl_lib&quot;: &quot;hw_config_01&quot;,<br/>             &quot;tcl_dir&quot;: &quot;$WORK_TOP/../test_projects/ncore_v3.0_configs/dii_config/256b_narrow_axid&quot;,<br/>              &quot;instance&quot; : &quot;dii0&quot;,<br/>             &quot;compile_args&quot;: &quot;&quot;,<br/>             &quot;<span class="legacy-color-text-default">exclusionsDoFile</span>&quot;: &quot;$WORK_TOP/rtl/dii/exclusions/dii_256b_narrow_axid.do&quot;,<br/>             &quot;<span class="legacy-color-text-red2"><strong>patFile</strong></span>&quot;: &quot;$WORK_TOP/rtl/dii/exclusions/dii_256b_narrow_axid_waiver.json&quot;,<br/>             &quot;label&quot;: [&quot;regr_cov&quot;, &quot;tachl_cover&quot;]<br/>         },</p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-3.0RunFormalCoverCheckTool(2methods):">3.0 Run Formal Cover Check Tool (2 methods):</h3><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-3.1Method1-Using-cxswitchinsiderunsim:">3.1 Method 1 - Using-cx switch inside runsim:</h3><p>runsim has an option -cx (enable covercheck) that has the formal tool to generated unreachables integrated internally. The output file are in the same location as mentioned in section <strong>1.3 HTML report and Ucdb Dump Folder</strong> above.<br/><span class="legacy-color-text-pink1"><strong>Note</strong></span>: When this option -cx is added, it runs on each config for the timeout of 30 minutes (fixed inside the script).</p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-3.2Method2-UsingrunCoverCheck.jsscript:">3.2 Method 2 - Using runCoverCheck.js script:</h3><p>For usage of runCoverCheck.js, refer this document : <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168351/Formal+CoverCheck+exclusions+generation+script+-+runCoverCheck.js" data-linked-resource-id="16168351" data-linked-resource-version="2" data-linked-resource-type="page">Formal CoverCheck exclusions generation script - runCoverCheck.js</a></p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-4.0Nativevcovercommandstomergeucdb&#39;s&amp;generatereportMANUALLY:">4.0 Native vcover commands to merge ucdb's  &amp; generate report MANUALLY :</h3><p><strong>Merge Command</strong>:             <span class="legacy-color-text-blue4">vcover merge ucdb1 ucdb2..…ucdbN -out <span class="legacy-color-text-blue1"><strong>merged.ucdb </strong>(Questa by default happens to do a Union merge. To avoid this please follow the below steps)</span></span></p><p>Need to change src file location for regression_week1 database to match with regression_week2  (assuming both src files are the same)</p><p>Step1:    vsim –c –viewcov /scratch/week1/merged_regression_week1.ucdb</p><p>    &gt; coverage edit –rename –srcfilestring /tmp/reg_week1 /tmp/reg_week2</p><p>    &gt; coverage save merged_reg1_mod.ucdb</p><p>    &gt; quit –f</p><p>Step2: Merge regression_week2 UCDB and regression_week1 [modified src path]</p><p><span class="legacy-color-text-blue4"><span class="legacy-color-text-blue1">    &gt; vcover merge merged_reg1_reg2.ucdb merged_reg1_mod.ucdb  merged_reg2.ucdb</span></span></p><p><br/></p><p><strong>HTML Report Command</strong>: <span class="legacy-color-text-blue4">vcover report -html -annotate -details -assert -cvg -directive -code scef -output ./html <strong><span class="legacy-color-text-blue1">merged.ucdb</span></strong></span></p><p><strong>Text Report Command</strong>:    <span class="legacy-color-text-blue4">vcover report -instance=/tb_top/dut -recursive -code scef -assert -cvg -directive -output coverage_totals.txt <strong><span class="legacy-color-text-blue1">merged.ucdb</span></strong></span></p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-5.0TogenerateRTL_exclusions.dofilemanuallyusingthefind_pat.jsscriptandRTL_exclusions.json"><span class="legacy-color-text-blue4"><strong><span class="legacy-color-text-blue1">5.0 To generate RTL_exclusions.do file manually using the find_pat.js script and RTL_exclusions.json</span></strong></span></h3><p><span class="legacy-color-text-blue4"><span class="legacy-color-text-blue1">node $WORK_TOP/../hw-lib/js/find_pat.js -i $WORK_TOP/regression/2022_01_12_0757/debug/dmi/config4/rtl -p $WORK_TOP/rtl/dmi/exclusions/dmi_config4_waiver.json -o $WORK_TOP/rtl/dmi/exclusions/dmi_config4_waiver.do -tp /tb_top/dut -tb dmi_a</span></span></p><h3 id="Runsim--CodeCoverage,FunctionalCoverage&amp;FormalExclusions-6.0ToruntheFormalexclusionsfollowedbytheRTLexclusionsonthemergedrawucdb"><span class="legacy-color-text-blue4"><span class="legacy-color-text-blue1">6.0 To run the Formal exclusions followed by the RTL exclusions on the merged raw ucdb</span></span></h3><p>vsim -c -viewcov &lt;raw_ucdb_file_name&gt; -do &lt;formal_cover_check_exclusions.do&gt; -do &quot;coverage save merged_ucdb_with_cc_exclusions.ucdb; quit -f&quot; &gt;&amp; ucdb_cc_exclusion.log</p><p>vsim -c -viewcov merged_ucdb_with_cc_exclusions.ucdb -do &lt;RTLexclusions.do&gt; -do &quot;coverage save final_code_cov.ucdb; quit -f&quot; &gt;&amp; ucdb_rtl_exclusion.log</p><p><br/></p><p><br/></p>