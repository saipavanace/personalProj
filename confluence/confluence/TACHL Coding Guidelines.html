<p>Introduction</p><p>This document describes how TACHL code should be written at Arteris. This document uses the terms &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; as described below:</p><ul><li>MUST - This word, or the terms &quot;REQUIRED&quot; or &quot;SHALL&quot;, mean that the definition is an absolute requirement.</li><li>MUST NOT - This phrase, or the phrase &quot;SHALL NOT&quot;, mean that the definition is an absolute prohibition.</li><li>SHOULD - This word, or the adjective &quot;RECOMMENDED<span class="confluence-anchor-link conf-macro output-inline"> </span>&quot;, mean that there may exist valid reasons in particular circumstances to ignore a particular item, but the full implications must be understood and carefully weighed before choosing a different course.</li><li>SHOULD NOT - This phrase, or the phrase &quot;NOT RECOMMENDED&quot; mean that there may exist valid reasons in particular circumstances when the particular behavior is acceptable or even useful, but the full implications should be understood and the case carefully weighed before implementing any behavior described with this label.</li><li>MAY - This word, or the adjective &quot;OPTIONAL&quot;, mean that an item is truly optional.</li></ul><h2 id="TACHLCodingGuidelines-Comments">Comments</h2><h4 id="TACHLCodingGuidelines-Allfilesmustbeginwithafileheaderthatincludesacopyrightnotice,andadescriptionofthemodule&#39;sintent.">All files must begin with a file header that includes a copyright notice, and a description of the module's intent. </h4><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.arteris.com/download/attachments/3080420/worddav30767f321f2aa74ce75dd689fde4f737.png?version=1&amp;modificationDate=1462773092669&amp;api=v2" data-image-src="https://confluence.arteris.com/download/attachments/3080420/worddav30767f321f2aa74ce75dd689fde4f737.png?version=1&amp;modificationDate=1462773092669&amp;api=v2" loading="lazy"></span></p><h4 id="TACHLCodingGuidelines-Majorsectionsofthefilemusthaveasectionheadercommentdelineatingthebeginningofthesection.">Major sections of the file must have a section header comment delineating the beginning of the section.</h4><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.arteris.com/download/attachments/3080420/worddavcb332d097cd69dffa01252f4a9aa9fee.png?version=1&amp;modificationDate=1462773092691&amp;api=v2" data-image-src="https://confluence.arteris.com/download/attachments/3080420/worddavcb332d097cd69dffa01252f4a9aa9fee.png?version=1&amp;modificationDate=1462773092691&amp;api=v2" loading="lazy"></span></p><p>Examples of major sections include:</p><ul><li>File setup section</li><li>Port declarations</li><li>A distinct block of logic such as &quot;Handle SFI Master Responses&quot;, or &quot;Write-side logic&quot;.</li></ul><h4 id="TACHLCodingGuidelines-Smallsubsectionsoffunctionalitymusthaveasubsectionheaderdelineatingthebeginningofthesub-section.Subsectionheadersbeginwithalineoftilde(~)characters.Whennotobviousformthesubsectiontitle,thesubsectionheadershouldincludeadescriptionoffu">Small subsections of functionality must have a subsection header delineating the beginning of the sub-section. Subsection headers begin with a line of tilde (~) characters. When not obvious form the subsection title, the subsection header should include a description of functionality.</h4><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.arteris.com/download/attachments/3080420/worddavcf6b54ab15a196991a8bfe186491ed1b.png?version=1&amp;modificationDate=1462773092737&amp;api=v2" data-image-src="https://confluence.arteris.com/download/attachments/3080420/worddavcf6b54ab15a196991a8bfe186491ed1b.png?version=1&amp;modificationDate=1462773092737&amp;api=v2" loading="lazy"></span></p><h4 id="TACHLCodingGuidelines-Eachlogicalinterfacemusthaveasubsectionheader">Each logical interface must have a subsection header</h4><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.arteris.com/download/attachments/3080420/worddav33c223f1093521b4bd8af362f11cb4a6.png?version=1&amp;modificationDate=1462773092812&amp;api=v2" data-image-src="https://confluence.arteris.com/download/attachments/3080420/worddav33c223f1093521b4bd8af362f11cb4a6.png?version=1&amp;modificationDate=1462773092812&amp;api=v2" loading="lazy"></span></p><h4 id="TACHLCodingGuidelines-Non-obviousbitsofcodeshouldhaveacommentexplainingtheirpurpose.">Non-obvious bits of code should have a comment explaining their purpose.</h4><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.arteris.com/download/attachments/3080420/worddav892c713ee6c0bd74f1d93cbe9023310d.png?version=1&amp;modificationDate=1462773093021&amp;api=v2" data-image-src="https://confluence.arteris.com/download/attachments/3080420/worddav892c713ee6c0bd74f1d93cbe9023310d.png?version=1&amp;modificationDate=1462773093021&amp;api=v2" loading="lazy"></span> </p><h4 id="TACHLCodingGuidelines-Commentsshouldbeusedtoexplainwherein-lineconstantscomefrom.">Comments should be used to explain where in-line constants come from.</h4><p>should not use /* ...... */ for comments as shown in the picture below</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.arteris.com/download/attachments/3080420/worddav76b5286058cf09ce726f70f85496c1ae.png?version=1&amp;modificationDate=1462773093052&amp;api=v2" data-image-src="https://confluence.arteris.com/download/attachments/3080420/worddav76b5286058cf09ce726f70f85496c1ae.png?version=1&amp;modificationDate=1462773093052&amp;api=v2" loading="lazy"></span></p><h4 id="TACHLCodingGuidelines-CommentsstartingwithTODO:mustbeusedtoindicatefuturework,oranythingthatshouldbereviewedbeforeshipping.">Comments starting with TODO: must be used to indicate future work, or anything that should be reviewed before shipping.</h4><h2 id="TACHLCodingGuidelines-Moduledeclaration&amp;Filesetup">Module declaration &amp; File setup</h2><p>The name of the function defining the module must be the same as the filename base. All parameters, ports, signals, and state must be declared.</p><h2 id="TACHLCodingGuidelines-Identifiers">Identifiers</h2><p>Configuration space variables and parameters must be <strong>camelCase</strong>, beginning with a lowercase letter. Configuration space variables and parameters should use the following prefixes to indicate the type of variable.</p><ul><li>&quot;w&quot; – Integer number of bits</li><li>&quot;n&quot; – Integer number (typically a count of items)</li><li>&quot;m&quot; – Integer number (typically a bit mask)</li><li>&quot;sz&quot; – Integer number of bytes</li><li>&quot;id&quot; – Integer identifier or integer index into a vector</li><li>&quot;is&quot; – Boolean that describes a property</li><li>&quot;can&quot; – Boolean that describes a capability</li><li>&quot;use&quot; – Boolean that enables functionality</li><li>&quot;fn&quot; – Enumerated that selects functionality</li><li>&quot;str&quot; – String</li></ul><p>Logic space signal, state, and port names must be <strong>underscore-separated lowercase</strong>, beginning with a letter.</p><p><span class="inline-comment-marker" data-ref="cddbe3c4-29a2-4ad7-a71e-6c68010c7f52">Verilog parameters must be  </span><strong><span class="inline-comment-marker" data-ref="cddbe3c4-29a2-4ad7-a71e-6c68010c7f52">underscore-separated allcaps, </span></strong><span class="inline-comment-marker" data-ref="cddbe3c4-29a2-4ad7-a71e-6c68010c7f52">beginning with a letter.</span></p><h2 id="TACHLCodingGuidelines-Prefix/Postfix"><span class="inline-comment-marker" data-ref="54e08aa5-7b36-4b1b-8e8e-7ce31c5d6275">Prefix / Postfix</span>   </h2><p>All signals must have NnnW or NnnR postfix</p><p>W - Specifies that the signal source is logic cone</p><p>R - Specifies that the signal source is from a flop </p><p>nn - specifies pipe stage of the signal like 0, 1, 2, ...... etc. this can be left as nn for signals that do not have pipe stages</p><p> </p><p><strong>Ports must be groups into logical interfaces, where each element of the interface shares a common prefix followed by an underscore, regardless of port direction.</strong></p><p>In the example below, all ports in the interface share the &quot;sfi_mst_rsp_&quot; prefix, even though the interface includes ports in both directions.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.arteris.com/download/attachments/3080420/worddav7aa16290590009b7a737b7d5eb20f987.png?version=1&amp;modificationDate=1462773093607&amp;api=v2" data-image-src="https://confluence.arteris.com/download/attachments/3080420/worddav7aa16290590009b7a737b7d5eb20f987.png?version=1&amp;modificationDate=1462773093607&amp;api=v2" loading="lazy"></span></p><p> </p><p><strong>Ready/valid ports and semantics should be used wherever possible.</strong></p><p>For example, the FIFO component in the component library has a &quot;push&quot; and a &quot;pop&quot; interface. It thus has signals &quot;push_ready&quot;, &quot;push_valid&quot;, &quot;pop_ready&quot;, and &quot;pop_valid&quot; instead of &quot;full&quot;, &quot;push&quot;, &quot;pop&quot;, and &quot;empty&quot; respectively. This allows a common understanding of interfaces, and allows our components to be easily connected.<br/>Ready/valid signals and semantics should also be used within module logic whenever possible, such as when signaling backpressure and data availability between stages of a pipeline.</p><p><strong><span class="inline-comment-marker" data-ref="ed043961-61ca-4fe2-9793-b447009357ff">Ports or signals in ready/valid interfaces should use the words &quot;ready&quot; and &quot;valid&quot; instead of &quot;rdy&quot; and &quot;vld&quot;, where possible.</span></strong></p><p>The SFI spec uses &quot;rdy&quot; and &quot;vld&quot; differs from the AMBA spec in that it uses the &quot;rdy&quot; &amp; &quot;vld&quot;, so SFI interfaces must use the 3-letter <span class="inline-comment-marker" data-ref="b6b91f87-004f-4976-ae6f-f5d2a6cf55ab">spelloing</span> while all other uses should match the AMBA spec and use the 5-letter spelling.</p><p> </p><h2 id="TACHLCodingGuidelines-Templatedcode">Templated code</h2><h4 id="TACHLCodingGuidelines-Evaluate">Evaluate</h4><p>Javascript code for TACHL to evaluate is written between the phrases &quot;\jsbegin&quot; and &quot;\jsend&quot;. These can be on different lines or on the same line. Evaluated code does not directly print any output, but it is used for control flow, to create variables used in interpolated code, and to pass information back to TACHL.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">\jsbegin
//=========================================================================
// ports
//=========================================================================
obj.lib.port(&#39;input&#39;, &#39;clk&#39;, 1);
obj.lib.port(&#39;input&#39;, &#39;reset_n&#39;, 1);
obj.lib.port(&#39;input&#39;, &#39;in1&#39;, 1);
obj.lib.port(&#39;input&#39;, &#39;in2&#39;, 1);
\jsend</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">\jsbegin obj.lib.port(&#39;output&#39;, &#39;out1_o&#39;, 1, &#39;reg&#39;); \jsend</pre>
</div></div><p> </p><h4 id="TACHLCodingGuidelines-Interpolate">Interpolate</h4><p>Javascript code for TACHL to interpolate is written between the phrases &quot;\=&quot; and &quot;=\&quot;. These can be on different lines or on the same line. Interpolated code prints the value of the enclosed function or expression directly in to the output Verilog. In some cases, TACHL library function are called using interpolate. i.e. when the function needs to give TACHL information and return a specific Verilog string.</p><p><span class="inline-comment-marker" data-ref="05d66b2a-4455-4e58-9085-77a8d9ce9cc3">Example:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module \=obj.lib.getModuleName()=\ (\=obj.lib.getPorts(&#39;\n    &#39;)=\);</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">    \=obj.lib.instance({
        instanceName: &#39;adder&#39;,
        moduleName: &#39;add2&#39;,
        params: {
            width: 1
        },
        verilogParams: {},
        ports: {
            in1: &#39;in1&#39;,
            in2: &#39;in2&#39;,
            out1: &#39;out1&#39;
        },
        portsDelimiter: &#39;\n        &#39;
    })=\</pre>
</div></div><p> </p><h2 id="TACHLCodingGuidelines-BuiltinTACHLfunctions">Built in TACHL functions</h2><h4 id="TACHLCodingGuidelines-getParam">getParam</h4><p>Get a javascript parameter defined by the modules parent. Must be used to access a parameter.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">getParam(&#39;path&#39;, &#39;to&#39;, &#39;param&#39;, ...)</pre>
</div></div><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">\=
...
    params: {
        width: obj.lib.getParam(&#39;width&#39;)
    },
...
=\</pre>
</div></div><p> </p><h4 id="TACHLCodingGuidelines-port">port</h4><p>Declare a port of the module. Type parameter is optional.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">port(direction, name, size, type)</pre>
</div></div><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">\jsbegin
obj.lib.port(&#39;input&#39;, &#39;in1&#39;, 1);
obj.lib.port(&#39;output&#39;, &#39;out1&#39;, 1);
\jsend</pre>
</div></div><p> </p><h4 id="TACHLCodingGuidelines-getPorts">getPorts</h4><p>For use in a interpolate statement to print ports declared.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">getPorts(delimiter)</pre>
</div></div><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module \=obj.lib.getModuleName()=\ (\=obj.lib.getPorts(&#39;\n    &#39;)=\);</pre>
</div></div><p> </p><h4 id="TACHLCodingGuidelines-addConnections">addConnections</h4><p>Add an automatic connection somewhere lower in the hierarchy. Each module that includes a cross connection needs to use the getCrossConnections function below.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">addConnections(connectionArray)
connectionArray: [{
    name: &#39;string&#39;,
    startPoint: [&#39;string&#39;, &#39;string&#39;, ...],
    endPoint: [&#39;string&#39;, &#39;string&#39;, ...],
    width: &#39;int&#39;
}]</pre>
</div></div><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">\jsbegin
obj.lib.addConnections([{
    name: &#39;cross1&#39;,
    startPoint: [&#39;intermediate&#39;, &#39;adder&#39;],
    endPoint: [&#39;intermediate&#39;, &#39;tester&#39;],
    width: 2
}]);
\jsend</pre>
</div></div><p> </p><h4 id="TACHLCodingGuidelines-getCrossConnections">getCrossConnections</h4><p>Used in block that have need to make automatic cross connections. Must be included in a interpolate statement.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">getCrossConnections()</pre>
</div></div><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">\=obj.lib.getCrossConnections()=\</pre>
</div></div><p> </p><h4 id="TACHLCodingGuidelines-getModuleName">getModuleName</h4><p>Get the resolved module name. This is based on the filename, and includes an identifier that is unique for each set of parameters passed to this module in the design. For use in Verilog module statement.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">getModuleName()</pre>
</div></div><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module \=obj.lib.getModuleName()=\ ();</pre>
</div></div><p> </p><h4 id="TACHLCodingGuidelines-instance">instance</h4><p>Creates a instance of the specified module. Returns a Verilog string for this instantiation. Must be used in an interpolate statement. The &quot;portsDelimiter&quot; option is optional and used for output formatting.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">instance(instanceObject)
instanceObject: {
	instanceName: &#39;string&#39;,
	moduleName: &#39;string&#39;,
	params: &#39;object&#39;,
	verilogParams: &#39;object&#39;,
	ports: {
		&#39;modulePortName&#39;: &#39;connectionName&#39;
	},
	portsDelimiter: &#39;string&#39;
}</pre>
</div></div><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">\=obj.lib.instance({
    instanceName: &#39;adder&#39;,
    moduleName: &#39;add2&#39;,
    params: {
        width: 1
    },
    verilogParams: {},
    ports: {
        in1: &#39;in1&#39;,
        in2: &#39;in2&#39;,
        out1: &#39;out1&#39;
    }
})=\</pre>
</div></div><p><br/><br/></p><h2 id="TACHLCodingGuidelines-Sequential/Logiccode">Sequential / Logic code</h2><p>@posedge based always blocks must not be used. DFFRE must be instantiated where ever aflop is required.</p><p>AND OR MUXs must be used where ever possible  </p><p>FSMs must use verilog parameters for state definitions. All states must be encoded with the same encoding (binary , gray onehot etc). do not mix and match.     </p><p> </p><p> </p><p> </p><p> </p>