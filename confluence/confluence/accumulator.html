<h1 id="accumulator-SWVisible:"><strong>SW Visible:</strong></h1><p>no</p><h1 id="accumulator-Parameters:"><strong>Parameters:</strong></h1><h2 id="accumulator-Javascript:"><strong>Javascript:</strong></h2><pre>{</pre><pre>  &quot;width&quot; : integer, // Width of din and dout in bits, 2 or greater. Must be a power to 2.</pre><pre>  &quot;minWriteSize&quot; : integer // Minimum Write Size in bits of din, 1 or greater. Must divide evenly into width. Must be a power of 2.</pre><pre>}</pre><h1 id="accumulator-I/O:"><strong>I/O:</strong></h1><pre><br/></pre><pre>ptr_width = log2ceil(1+width/minWriteSize);<br/>u.port('input', 'clk', 1);<br/>u.port('input', 'reset_n', 1);<br/>u.port('input', 'din_valid', 1);          // Tells the block to load the incoming data into the internal accumulator<br/>u.port('input', 'restart', 1);            // Tells the block to reset internal accumulator ptr to 0. Will make dout = din and valid_ptr = write_size.<br/>u.port('input', 'din_size', ptr_width);   // The number of groups minWriteSize bits to be written into accumulator.<br/>u.port('input', 'din', width);            // Data in<br/>u.port('output', 'dout_valid');           // Says the output is valid. Its an or of din_valid and non-zero internal valid ptr.<br/>u.port('output', 'dout_size', ptr_width); // Points at the last valid minWriteSize bit group on output. It's a sum of internal valid ptr and write_size. <br/>u.port('output', 'dout_size_int', ptr_width); // Points at the stored valid minWriteSize bit group on output. It's the internal valid ptr. <br/>u.port('output', 'dout', width);          // Data out<br/><br/></pre><h1 id="accumulator-ModulesUsed:"><strong>Modules Used:</strong></h1><p>barrel_shifter</p><h1 id="accumulator-Description:"><strong>Description:</strong></h1><p>The block diagram is shown below:</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="https://arterisip.atlassian.net/wiki/download/attachments/16160004/Accumulator.svg?api=v2"></span></p><p>This block accumulates groups of bits and presents them on the outputs. It is transparent. When data has been accumulated in previous cycles, it is presented on the output along with the incoming data shifted left by the number of bits that have been previously accumulated (in_size). Data that is shifted off the left end is written into the accumulator starting on the right and overwrites previous accumulated dated. This happens when the sum of din_size + in_size is greater than the number of groups on the output then the most significant bit plus din_size is inverted when this happens. And inversion is used instead of  a simple 0 to cover the case when there are max groups in the accumulator and max groups coming in.</p><p>Update tells the accumulator to accumulate the incoming data into the internal accumulator registers.</p><p>Restart tells the accumulator to wipe out the previous accumulated data and start from scratch (dout_size  will equal din_size).</p><p>din_size is the number of minWriteSize bit groups being presented on din and is assumed right justified. If minWriteSize is 8, then din_size would be the number of valid bytes.</p><p>dout_size is the number of minWriteSize bit groups being presented in dout and is right justified. If minWriteSize is 8, this would be the number of valid bytes. It is the sum of the internally accumulated groups (in_size) plus the incoming din_size truncated to the width of entire interface. Truncation is not shown in the block diagram.</p><p>dout_size_int is the number of minWriteSize bit groups being presented in dout that are held in the accumulator from previous cycles. If minWriteSize is 8, this would be the number of valid bytes. New bit groups are on to the left and accumulated bit groups are to the right in dout.</p><p>The accumulator converts the in_size into a valid per bit group and uses that vector to select between the output of the barrel shifter and the internal accumulator registers to present on dout and the inversion of that vector to update the internal accumulator registers.  If din_size + in_size is greater than the number of bit groups, then the accumulator writes the output of the barrel shifter into the accumulator registers.</p><p><br/></p>