<p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1759724143437 {padding: 0px;}
div.rbtoc1759724143437 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1759724143437 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1759724143437'>
<ul class='toc-indentation'>
<li><a href='#NCore3Loggingandreporting-SystemCComponentsLogging'>SystemC Components Logging</a></li>
<li><a href='#NCore3Loggingandreporting-Statisticsreporting'>Statistics reporting</a></li>
<li><a href='#NCore3Loggingandreporting-MeetingNotes'>Meeting Notes</a>
<ul class='toc-indentation'>
<li><a href='#NCore3Loggingandreporting-LoggingIssues'>Logging Issues</a></li>
<li><a href='#NCore3Loggingandreporting-ActionPlanforLogging'>Action Plan for Logging</a></li>
</ul>
</li>
</ul>
</div></p><h1 id="NCore3Loggingandreporting-SystemCComponentsLogging">SystemC Components Logging</h1><p>Logging is based on the SystemC reporting infrastructure. The backend of SystemC logging is provided by <a class="external-link" href="https://github.com/gabime/spdlog" rel="nofollow">spdlog</a> which allows asyncronous logging with low impact on simulation speed.</p><p>To ease the use of SystemC reporting the SystemC Components library (SCC) provides a few helper. Basically it defines 7 macros</p><ul><li>SCCFATAL(...)<br/>report a fatal state of and stop the simulation immediately since it cannot continue</li><li>SCCERR(...)<br/>report an error in the simulation. The simulation might continue but will quite likely corrupted</li><li>SCCWARN(...)<br/>report a warning in the simulation. The simulation hit an unexpected state or behavior which might lead to erroneous results. E.g a configuration parameter cannot be applied since it is not yet implemented.</li><li>SCCINFO(...)<br/>print an informational message to console and log file. This should only contain informal messages also of interest to the ordinary user/customer. It should be kept to the bare minimum needed</li><li>SCCDEBUG(...)<br/>print a debug statement helping to analyse what's going on in the simulation</li><li>SCCTRACE(...)<br/>print a trace statement (e.g. function invocation) to give more detailed information for debugging purposes</li><li>SCCTRACEALL(...)<br/>print a even more detailed trace statement (e.g. execution of particular functions and their result)</li></ul><p>All macros allow to provide a message type tag (a string) to classify and later filter the output. For <code>sc_module</code> and <code>sc_object</code> this might be the <code>name()</code> function of <code>sc_object</code> (this can be generalized e.g. as <code>SCCINFO(SCMOD)</code>). In all other cases a finite set of message type tags should be used e.g. the unit type ('DMI', 'DCE',...). The macros can be used as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: cpp; gutter: false; theme: FadeToGrey" data-theme="FadeToGrey">#include &lt;scc/report.h&gt;
...
SCCINFO(SCMOD) &lt;&lt; &quot;This is an informational message&quot;;
SCCWARN(&quot;DCE&quot;) &lt;&lt; &quot;Some misconfiguration detected&quot;;</pre>
</div></div><p>The macros provide an ostream object for convenience. For performance reasons the macros expand into a conditional statement checking the logging level before constructing the stream. There is no need to remove the logging in a release build. Please note: don't use functions with side effects since they might not be executed in certain logging configurations.</p><p>Since SCC comes with <a class="external-link" href="https://github.com/gabime/spdlog" rel="nofollow">spdlog</a> and <a class="external-link" href="https://github.com/fmtlib/fmt" rel="nofollow">fmt</a> it is also possible to use a printf-like style but with a typesafe interface:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: cpp; gutter: false; theme: FadeToGrey" data-theme="FadeToGrey">#include &lt;scc/report.h&gt;
#include &lt;fmt/format.h&gt;
...
SCCINFO(SCMOD) &lt;&lt; fmt::format(&quot;The answer is {:d}&quot;, 42);</pre>
</div></div><p>For more information pls. refer to the wiki pages of <a class="external-link" href="https://fmt.dev/latest/" rel="nofollow">fmt.</a></p><p>The SystemC reporting is been configured using the SCC function <code>init_logging()</code> which exist in 2 variants: a simple one just setting the log level:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: cpp; gutter: false; theme: FadeToGrey" data-theme="FadeToGrey"> scc::init_logging(logging::WARNING);</pre>
</div></div><p>and a more elaborated one allowing to configure details of the output:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: cpp; gutter: false; theme: FadeToGrey" data-theme="FadeToGrey">    /*****************************************************************************/
    // logging setup
    /*****************************************************************************/
    scc::init_logging(scc::LogConfig()
      .logFileName(&quot;simulation.log&quot;)
      .logLevel(logging::DEBUG)
      .coloredOutput(true)
      );</pre>
</div></div><p>In both cases 8 logging levels can be set:</p><ul><li>NONE<br/>This value is used to switch of any log to console or file e.g. for regression runs</li><li>FATAL<br/>corresponds to SCCFATAL(...)</li><li>ERROR<br/>corresponds to SCCERR(...)</li><li>WARNING<br/>corresponds to SCCWARN(...)</li><li>INFO<br/>corresponds to SCCINFO(...)</li><li>DEBUG<br/>corresponds to SCCDEBUG(...)</li><li>TRACE<br/>corresponds to SCCTRACE(...)</li><li>TRACEALL<br/>corresponds to SCCTRACEALL(...)</li></ul><p>The sc_report consists of a message tag and a message text. By using the scc::init_logging a report handler is been installed which formats the output in a decent way. Here is an example:</p><img class="wysiwyg-unknown-macro" src="https://arterisip.atlassian.net/wiki/plugins/servlet/confluence/placeholder/unknown-macro?name=html&amp;locale=en_US&amp;version=2" /><p>The report contains the severity, followed by a timestamp, the message tag (the tag will be padded to a maximum size using ellipsis) and the message text itself. In case of warnings, errors, and fatals the source location and the SystemC process name is added to ease the root cause determination.</p><p>Additionally SC provide an assertion <code>SCC_ASSERT(expr)</code> which checks that expr holds true. This macro is only active in debug builds, in release build this macro is replaced with a null expression. If you want to report failures also in release build use an explicit check and <code>SCCFATAL()</code></p><h1 id="NCore3Loggingandreporting-Statisticsreporting">Statistics reporting</h1><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This is work in progress</p></div></div><p>Statistics reporting should not be done using the SystemC reporting infrastructure. Since in NCore3 the reporting is backed by spdlog the spd loggers should be used directly for statistics output. This way the output is not cluttered with Simulation time and alike.</p><p>Using the statistics logger is easy and straight forward:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: cpp; gutter: false; theme: FadeToGrey" data-theme="FadeToGrey">#include &lt;spdlog/spdlog.h&gt;
...
unsigned stt_count=5;
...
auto logger = spdlog::get(&quot;statistics&quot;);
logger-&gt;info(&quot;remaining stt entries: {}&quot;, stt_count);</pre>
</div></div><p><a class="external-link" href="https://github.com/gabime/spdlog" rel="nofollow">spdlog</a> uses <a class="external-link" href="https://github.com/fmtlib/fmt" rel="nofollow">fmt</a> to do typesafe printf-like debugging, for more information pls. refer to the wiki pages of <a class="external-link" href="https://github.com/gabime/spdlog/wiki/1.-QuickStart" rel="nofollow">spdlog</a> and <a class="external-link" href="https://fmt.dev/latest/" rel="nofollow">fmt</a></p><h1 id="NCore3Loggingandreporting-MeetingNotes">Meeting Notes</h1><h2 id="NCore3Loggingandreporting-LoggingIssues">Logging Issues</h2><ul><li>Every unit has its own logging macro and format</li><li>Want to converge on standard logging for debug with SCCDEBUG, SCCTRACE, SCCTRACEALL</li><li>NCORE3_DEBUG2 has good consistent format with time, unit name, function name, etc.</li></ul><h2 id="NCore3Loggingandreporting-ActionPlanforLogging">Action Plan for Logging</h2><ul><li>Eyck to change NCORE3_DEBUG2 to use SCCDEBUG, and create equivalent NCORE3_TRACE, NCORE3_TRACEALL</li><li>Each unit to move to using NCORE3_DEBUG2 or other, requires creating get_name function to get unit name string with instance number</li><li>Remove direct uses of cout in unit code</li></ul><p> </p><p> </p>