<p>Below is a diagram of the DUT (design under test) for the <em>top_axi_atu_pmon</em> configuration:</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" height="400" src="https://arterisip.atlassian.net/wiki/download/attachments/16171321/image2019-11-14%2015:55:33.png?api=v2"></span></p><p> </p><p>This configuration will be used to demonstrate and verify being able to make the following measurements using PMON blocks:</p><ol><li>Latency (round trip) binning</li><li>Bandwidth utilization</li><li>Number of packets </li><li>Packet count</li></ol><h2 id="id-1x1topologywithPMON-ModulesUsed">Modules Used</h2><p><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16163549/HW-CTF+pmon_probe" data-linked-resource-id="16163549" data-linked-resource-version="43" data-linked-resource-type="page">pmon_probe<br /></a><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16163552/HW-CTF+pmon_stats" data-linked-resource-id="16163552" data-linked-resource-version="39" data-linked-resource-type="page">pmon_stats<br /></a><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16169247/apb_demux" data-linked-resource-id="16169247" data-linked-resource-version="7" data-linked-resource-type="page">apb_demux<br /></a><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16164096/OBSOLETE-DELETE+HW-SYM+atui_axi" data-linked-resource-id="16164096" data-linked-resource-version="47" data-linked-resource-type="page">atui_axi<br /></a><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16164118/HW-CTF+atut_axi" data-linked-resource-id="16164118" data-linked-resource-version="25" data-linked-resource-type="page">HW-CTF atut_axi</a></p><h2 id="id-1x1topologywithPMON-Softwareconfigurations">Software configurations</h2><p>The testbench is expected to program the following registers to perform the above measurements:</p><p><strong>Setting up for latency binning</strong>:</p><p>This configuration is set up for 3 bins. To program the boundaries of the bins, two register fields are provided:</p><ol><li>bin0_ul in PMON_STATS_USER0 for upper limit of BIN0.</li><li>bin1_ul in PMON_STATS_USER1 for upper limit of BIN1.</li></ol><p>The lower limit of BIN 0 is assumed to be 0 and the upper limit of BIN2 is assumed to be the 2**32 - 1 (max value of a 32-bit timer).</p><p>There are two timers reserved to measure the time between the two context allocation and deallocation event pairs from the ATU inititator:</p><ol><li>LAT_TMR0</li><li>LAT_TMR1</li></ol><p>Both timers have a set of registers to control them. Program the following fields in both LAT_TMR0_EN_MODE and LAT_TMR1_EN_MODE to the following values</p><ol><li>en - to 1 to enable timer</li><li>ct - to 1 to enable timer mode</li><li>inc_mode - to 1 to enable freeze mode</li></ol><p>The above timers are set up such that they start when a context allocate event occurs and reset when a context deallocate event occurs.</p><p>Set the GLBL_EN bit and GLBL_Mask register bits.</p><p>Send 20 AXI write requests.</p><p>Disable GLBL_EN and read the following registers after receiving the last write-response:</p><ol><li>BIN0_val</li><li>BIN1_val</li><li>BIN2_val</li></ol><p>Ensure all three binning counters are counting (for verification).</p><p>Software-reset all the Latency-Timers (LAT_TMR*) by writing a 1 to the reset bit (auto-clear bit) in LAT_TMR*_CTRL. Do the same for BIN* counters.</p><p>Repeat from Step 1 to do a second measurement, this time with slightly different values for the bin boundaries (bin0_ul, bin1_ul).</p><p> </p><p><strong>Bandwidth measurement:</strong></p><p>There is a counter and a timer pair associated with BW measurement. The counter is to be programmed to count the number of beats sent across an ATP link (select-able between request or response) while the timer is to be programmed to measure the number of clocks passed during the time interval of measurement. The BW utilization would be the ratio BW / BW_REF.</p><ol><li>First program the BW_EVT_SEL to measure bandwidth on the request link - (0 for request, 1 for response)</li><li>Program the BW_REF to enable timer mode and set enable to 1.</li><li>Program the global enable bit in TMR_GLBL after sending the first write request and before sending the last write request.</li></ol><p>Repeat the same for the response link to determine the BW utilization on response link.</p><p> </p><p> </p><p> </p>