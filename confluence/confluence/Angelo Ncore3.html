<p><style>[data-colorid=t53zwth4rx]{color:#333333} html[data-color-mode=dark] [data-colorid=t53zwth4rx]{color:#cccccc}</style><style type="text/css">/*<![CDATA[*/
div.rbtoc1759723715574 {padding: 0px;}
div.rbtoc1759723715574 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1759723715574 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1759723715574">
<ul class="toc-indentation">
<li><span class="TOCOutline">1</span> <a href="#AngeloNcore3-Repositories">Repositories</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">1.1</span> <a href="#AngeloNcore3-Creatingaworkingcopy(singlestep)">Creating a working copy (single step)</a></li>
<li><span class="TOCOutline">1.2</span> <a href="#AngeloNcore3-Creatingaworkingcopy(stepbystep)">Creating a working copy (step by step)</a></li>
<li><span class="TOCOutline">1.3</span> <a href="#AngeloNcore3-Updatingaworkingcopyakapull">Updating a working copy aka pull</a></li>
</ul>
</li>
<li><span class="TOCOutline">2</span> <a href="#AngeloNcore3-BuildInstructions(incl.runningregressiontest)">Build Instructions (incl. running regression test)</a></li>
<li><span class="TOCOutline">3</span> <a href="#AngeloNcore3-BuildInstructionsforrelease(Note:frommasterbranch)">Build Instructions for release (Note: from master branch)</a></li>
<li><span class="TOCOutline">4</span> <a href="#AngeloNcore3-Purposeofmoduleangelo">Purpose of module angelo</a></li>
<li><span class="TOCOutline">5</span> <a href="#AngeloNcore3-UnitTests">Unit Tests</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">5.1</span> <a href="#AngeloNcore3-Ncore">Ncore</a></li>
<li><span class="TOCOutline">5.2</span> <a href="#AngeloNcore3-Executingcmakedefinedtests">Executing cmake defined tests</a></li>
</ul>
</li>
<li><span class="TOCOutline">6</span> <a href="#AngeloNcore3-Additionalrepositoryandworkingcopyactions">Additional repository and working copy actions</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">6.1</span> <a href="#AngeloNcore3-Handlingchangesinsubmodules">Handling changes in submodules</a></li>
<li><span class="TOCOutline">6.2</span> <a href="#AngeloNcore3-Switchingbranchesinangelo">Switching branches in angelo</a></li>
</ul>
</li>
<li><span class="TOCOutline">7</span> <a href="#AngeloNcore3-Gitaliaseseasingtheworkwithsubmodules">Git aliases easing the work with submodules</a></li>
</ul>
</div><p /><h1 id="AngeloNcore3-Repositories">Repositories</h1><p><a class="external-link" href="http://gitlab.arteris.com/maestro-dev/packages/angelo" rel="nofollow">angelo ncore3</a>&nbsp;is the main repo for Ncore3. It contains repos for tempo, hw-test-projects, hw-sym-tl, and osci-lib as submodules.</p><h2 id="AngeloNcore3-Creatingaworkingcopy(singlestep)">Creating a working copy (single step)</h2><pre>git clone --branch integration --recursive <a class="external-link" href="mailto:git@gitlab.arteris.com" rel="nofollow">git@gitlab.arteris.com</a>:maestro-dev/packages/angelo.git<br />cd angelo</pre><h2 id="AngeloNcore3-Creatingaworkingcopy(stepbystep)">Creating a working copy (step by step)</h2><pre>git clone <a class="external-link" href="mailto:git@gitlab.arteris.com" rel="nofollow">git@gitlab.arteris.com</a>:maestro-dev/packages/angelo.git<br />cd angelo<br />git checkout integration<br />git submodule init<br />git submodule update --recursive --init</pre><h2 id="AngeloNcore3-Updatingaworkingcopyakapull">Updating a working copy aka pull</h2><pre>cd angelo<br />git pull origin integration<br />git submodule sync<br />git submodule update --recursive</pre><pre><br /></pre><h1 id="AngeloNcore3-BuildInstructions(incl.runningregressiontest)">Build Instructions (incl. running regression test)</h1><pre>cd angelo<br />module purge<br />module load dev/angelo<br /><span data-colorid="t53zwth4rx" style="text-decoration: none;">(To apply gcc 6.3 - module load dev/angelo/2.0 )</span><br />mkdir build<br />cd build<br />cmake -DENABLE_DEVEL=ON ..<br />make -j<br />make test</pre><h1 id="AngeloNcore3-BuildInstructionsforrelease(Note:frommasterbranch)">Build Instructions for release (Note: from master branch)</h1><pre>cd angelo<br />module purge<br />module load dev/angelo<br />mkdir build<br />cd build<br />cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=&lt;install dir&gt; -DEN_DEBUG=OFF ..<br />make -j<br />make install</pre><p><br /></p><p><br /></p><p><br /></p><pre><br /></pre><h1 id="AngeloNcore3-Purposeofmoduleangelo">Purpose of module angelo</h1><p>To ensure that each developer has the same environment setup, the environment setup is handled by&nbsp;</p><pre>module load dev/angelo</pre><p>For example, the module currently ensures</p><ul><li>pointing to latest cmake</li><li>pointing to latest gcc 6.3</li><li>setenv SYSTEMC_HOME /engr/dev/tools/systemc/2.3.3/gcc6.3.0-cxx11-rel</li><li>pointing to latest conan, gdb, qstat</li><li>pointing to scviewer</li></ul><h1 id="AngeloNcore3-UnitTests">Unit Tests</h1><p>All unit tests are run automatically at each checkin through&nbsp;</p><pre>make test</pre><p>Status 8/19/19: test_aiu is currently not executed as this unit is still in development and not yet stable.</p><h2 id="AngeloNcore3-Ncore">Ncore</h2><pre>build/bin/test_aiu<br />build/bin/test_dce<br />build/bin/test_dmi<br />build/bin/test_ncb<br />build/bin/test_ncb_noccp<br />build/bin/test_cmux</pre><h2 id="AngeloNcore3-Executingcmakedefinedtests">Executing cmake defined tests</h2><p>To run a single test from the set of tests executed using 'make test' you can use ctest in the build directory. E.g. to run the bring-up test wr32ch use:</p><pre>ctest -R ncore3_bringup_wr32ch</pre><p>The output can be found in Testing/Temporary/LastTest.log</p><h1 id="AngeloNcore3-Additionalrepositoryandworkingcopyactions">Additional repository and working copy actions</h1><h2 id="AngeloNcore3-Handlingchangesinsubmodules">Handling changes in submodules</h2><p>The handling of changes in submodule is the same for all submodules. In general changes in the submodule should be committed and pushed to the central repo. The commit has a distinct hash associated. Since the parent of the submodule references this commit (and hash) explicitly the parent repo needs to be updated as well to reference the new commit. Therefore there are 2 commits needed.</p><p>Assuming something in osci-lib needs to be fixed. To do this you should first tell git which brnach to use (submodules reference commit hashes not branches):</p><pre>cd ocsi-lib<br />git checkout develop</pre><p>Assuming something in osci-lib has now been fixed:</p><pre>cd osci-lib<br />git status<br />git add &lt;list of changed files&gt;<br />git commit<br />git push origin<br />cd ..<br />git add osci-lib<br />git commit<br />git push origin integration</pre><p>Another option is the follwoing which makes sure that submodule commits are pushed as well:</p><pre class="highlight"><br /></pre><pre>cd osci-lib<br />git status<br />git add &lt;list of changed files&gt;<br />git commit<br />cd ..<br />git add osci-lib<br />git commit<br />git push --recurse-submodules=on-demand origin integration</pre><h2 id="AngeloNcore3-Switchingbranchesinangelo">Switching branches in angelo</h2><p>If you switch a branch you need to make sure that the submodules are also updated. To do this propery all changes in angelo as well as in the submodules should be commited, otherwise they might get lost.</p><pre>git checkout ncore3_toplevel<br />git submodule sync<br />git sudmodule update --recursive</pre><p><br /></p><h1 id="AngeloNcore3-Gitaliaseseasingtheworkwithsubmodules">Git aliases easing the work with submodules</h1><pre class="highlight"><code class="language-console">git config alias.sdiff '!'&quot;git diff &amp;&amp; git submodule foreach 'git diff'&quot;
git config alias.spush 'push --recurse-submodules=on-demand'
git config alias.supdate 'submodule update --recursive --init'</code></pre><p>Now its possible to just run</p><pre>git supdate</pre><p>to get all changes at once across all submodules</p>