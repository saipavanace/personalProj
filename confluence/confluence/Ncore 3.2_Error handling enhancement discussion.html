<p><style>[data-colorid=nbkqloyje7]{color:#de350b} html[data-color-mode=dark] [data-colorid=nbkqloyje7]{color:#f44b21}[data-colorid=e6oeggal8g]{color:#de350b} html[data-color-mode=dark] [data-colorid=e6oeggal8g]{color:#f44b21}[data-colorid=v4w5bipznb]{color:#344563} html[data-color-mode=dark] [data-colorid=v4w5bipznb]{color:#9cadcb}[data-colorid=xl7wpvui9i]{color:#de350b} html[data-color-mode=dark] [data-colorid=xl7wpvui9i]{color:#f44b21}[data-colorid=pkvg1ih2pl]{color:#de350b} html[data-color-mode=dark] [data-colorid=pkvg1ih2pl]{color:#f44b21}[data-colorid=v4c8do4s0g]{color:#344563} html[data-color-mode=dark] [data-colorid=v4c8do4s0g]{color:#9cadcb}[data-colorid=h6o23ylwr6]{color:#de350b} html[data-color-mode=dark] [data-colorid=h6o23ylwr6]{color:#f44b21}[data-colorid=is64pwupgl]{color:#344563} html[data-color-mode=dark] [data-colorid=is64pwupgl]{color:#9cadcb}[data-colorid=qxlp2svs41]{color:#344563} html[data-color-mode=dark] [data-colorid=qxlp2svs41]{color:#9cadcb}</style><br /></p><p><br /></p><p><br /></p><p>Based on the latest error architecture spec update from the architects we want to list all the block updates related to this.</p><p><br /></p><p>DII -<span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=erict" rel="nofollow" style="text-decoration: none;" title="Follow link">Eric Taylor</a>&nbsp;can you list all the necessary changes related to error handling in this block?</p><p>DMI -<span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=jasonv" rel="nofollow" style="text-decoration: none;" title="Follow link">Jason Villanueva</a><span>&nbsp;</span>can you list all the necessary changes related to error handling in this block?</p><p>IOAIU -<span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=kjeld" rel="nofollow" style="text-decoration: none;" title="Follow link">Kjeld Svendsen</a>&nbsp;/<a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=erict" rel="nofollow" style="text-decoration: none;" title="Follow link">Eric Taylor</a>&nbsp;can you guys list all the necessary changes related to error handling in this block?</p><p>CHIAIU -<span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=boon" rel="nofollow" style="text-decoration: none;" title="Follow link">Boon Chuan</a><span>&nbsp;</span>&nbsp;can you list all the necessary changes related to error handling in this block?</p><p>DVE -<span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=boon" rel="nofollow" style="text-decoration: none;" title="Follow link">Boon Chuan</a>/<a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=robertp" rel="nofollow" style="text-decoration: none;" title="Follow link">Robert Podnar</a>&nbsp;can you guys list all the necessary changes related to error handling in this block?&nbsp;</p><p>DCE -<span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=boon" rel="nofollow" style="text-decoration: none;" title="Follow link">Boon Chuan</a><span>&nbsp;</span>&nbsp;can you list all the necessary changes related to error handling in this block?</p><p><br /></p><p>Details in&nbsp;

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="CONC-8945">
                <a href="https://arterisip.atlassian.net/browse/CONC-8945?src=confmacro" class="jira-issue-key">CONC-8945</a>
                            </span>
</p><p><br /><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=erict" rel="nofollow" style="text-decoration: none;"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" alt="erict" src="https://arterisip.atlassian.net/secure/useravatar?size=xsmall&amp;ownerId=erict&amp;avatarId=12200" data-image-src="https://arterisip.atlassian.net/secure/useravatar?size=xsmall&amp;ownerId=erict&amp;avatarId=12200" loading="lazy" /></span></span></span>Eric Taylor</a><span>&nbsp;</span>added a comment -<span>&nbsp;</span><span class="commentdate_132500_verbose subText"><span class="date user-tz" title="13/Jan/22 11:46 AM">13/Jan/22 11:46 AM</span></span></p><p>Hey,</p><p>The DII will need to change the SLVERR to map to Data Error and not Target Indicated Error.</p><p>For the IOAIU I think we should be good in terms of whats interpreted from the DII.</p><p>The top bit is set if there is any error, the bottom bit is set in the case of a Decode error. The DII is only changing the SLVERR behavior so it shouldn't effect the IOAIU.</p><p>-ET</p><p><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=boon" rel="nofollow" style="text-decoration: none;">Boon Chuan</a><span>&nbsp;</span>added a comment -<span>&nbsp;</span><span class="commentdate_132532_verbose subText"><span class="date user-tz" title="13/Jan/22 12:29 PM">13/Jan/22 12:29 PM</span></span><span>&nbsp;</span>-<span>&nbsp;</span><span data-colorid="nbkqloyje7" class="redText subText" title="Boon Chuan - 18/Jan/22 5:59 PM">edited</span></p><p>The DVE will need to change the SNPrsp CMstatus aggregation ORing logic for the generation of CMPrsp CMstatus. Because the Error Architecture spec now specifies that ACE snoop response error from ACE is always CMstatus=8'b10000011 (Data Error), while CHI spec defines the DVM snoop response error on CHI RSP channel is always RespErr=Non-Data Error that maps to CMstatus=7'b10000100 (Non-Data Error). As such, ORing DVM snoop response error code from ACE and from CHI would result in illegal CMstatus code=8'b10000111.</p><p><br /></p><p>Khaleel confirmed DVE detects any snoop response error and always captures it as Address Error for CMPrsp CMstatus.</p><p><br /><a class="external-link" href="https://arterisip.atlassian.net/browse/CONC-8945?focusedCommentId=132535&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-132535" rel="nofollow" style="text-decoration: none;" title="Right click and copy link for a permanent link to this comment."><span data-colorid="qxlp2svs41" class="icon-default aui-icon aui-icon-small aui-iconfont-link">Permalink</span></a><span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/secure/EditComment!default.jspa?id=45488&amp;commentId=132535" rel="nofollow" style="text-decoration: none;" title="Edit"><span data-colorid="v4c8do4s0g" class="icon-default aui-icon aui-icon-small aui-iconfont-edit">Edit</span></a><br /><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=boon" rel="nofollow" style="text-decoration: none;">Boon Chuan</a><span>&nbsp;</span>added a comment -<span>&nbsp;</span><span class="commentdate_132535_verbose subText"><span class="date user-tz" title="13/Jan/22 12:53 PM">13/Jan/22 12:53 PM</span></span><span>&nbsp;</span>-<span>&nbsp;</span><span data-colorid="xl7wpvui9i" class="redText subText" title="Boon Chuan - 13/Jan/22 1:20 PM">edited</span></p><p>The Error Architecture needs to specify the CMPrsp CMstatus for DVM snoop response:</p><p>CMPrsp CMstatus=8'b10000011 (Data Error) or 8'b10000100 (Address Error) or both allowed?</p><p><br /></p><p>CHI-spec Table 9-8 &quot;DVM transaction packets legal RespErr field values&quot; indicate Comp response packet can have RespErr=DataError, Non-DataError.</p><p><br /><a class="external-link" href="https://arterisip.atlassian.net/browse/CONC-8945?focusedCommentId=132536&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-132536" rel="nofollow" style="text-decoration: none;" title="Right click and copy link for a permanent link to this comment."><span data-colorid="v4w5bipznb" class="icon-default aui-icon aui-icon-small aui-iconfont-link">Permalink</span></a><span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/secure/EditComment!default.jspa?id=45488&amp;commentId=132536" rel="nofollow" style="text-decoration: none;" title="Edit"><span data-colorid="is64pwupgl" class="icon-default aui-icon aui-icon-small aui-iconfont-edit">Edit</span></a><br /><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=kjeld" rel="nofollow" style="text-decoration: none;">Kjeld Svendsen</a><span>&nbsp;</span>added a comment -<span>&nbsp;</span><span class="commentdate_132536_verbose subText"><span class="date user-tz" title="13/Jan/22 1:03 PM">13/Jan/22 1:03 PM</span></span></p><p><br />IOAIU with cache. UC tag error on CCP access will flag interrupt only, and thus provide no error response.</p><p><br /><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=boon" rel="nofollow" style="text-decoration: none;">Boon Chuan</a><span>&nbsp;</span>added a comment -<span>&nbsp;</span><span class="commentdate_132537_verbose subText"><span class="date user-tz" title="13/Jan/22 1:23 PM">13/Jan/22 1:23 PM</span></span><span>&nbsp;</span>-<span>&nbsp;</span><span data-colorid="h6o23ylwr6" class="redText subText" title="Boon Chuan - 18/Jan/22 4:00 PM">edited</span></p><p>(1)</p><p>CHI-AIU receives CMPrsp from DVE as a response for the DVMOp request.</p><p>The CMPrsp from DVE can be Data Error (from ACE AIU DVM agent's snoop response) or Address Error (from CHI AIU DVM Agent snoop response).</p><p>If CHI processor expects any DVM snoop response to be reflected on CHI RSP channel as RespErr=2'b11=Non-Data Error, then CHI-AIU must convert Data Error from SNPrsp Cmstatus to CHI RSP Channel RespErr=2b11.</p><p>NOTE: CHI spec indicates that the DVM Snoop Response error on CHI RSP channel must be Non-Data Error.&nbsp;</p><p>(2)</p><p>CHI spec<br />========<br />Table 9-2 Read transaction packets legal RespErr field values<br />Table 9-3 Dataless transaction packets legal RespErr field values<br />Table 9-4 Write transaction response packets legal RespErr field values<br />Table 9-5 Write transaction data packets legal RespErr field values<br />Table 9-6 Atomic transaction response packets legal RespErr field values<br />Table 9-7 Atomic transaction data packets legal RespErr field values<br />Table 9-8 DVM transaction packets legal RespErr field values<br />Table 9-9 Snoop request response packets legal RespErr field values</p><p><br /></p><p>shows these special cases need to be handled by CHI-AIU:</p><p><strong>From CHI-AIU: The legal error for response packet for Evict is NDERR.</strong></p><p>From CHI Processor: The legal error for data packets for WriteNoSnp,WriteUnique,WriteBack,WriteClean,WriteEvictFull is DERR.</p><p>From CHI Processor: The legal error for response packets WriteData for AtomicStore,AtomicLoad,AtomicSwap,AtomicCompare is DERR.</p><p>From CHI-AIU: The legal error for DBIDResp for DVMOp is OK</p><p>From CHI Processor: The legal error for NCBWrData for DVMOp is DERR</p><p>From CHI Processor: The legal error for SnpResp packet is NDERR.</p><p>From CHI Processor: The legal error for SnpRespData is DERR.</p><p>NOTE: DERR means RespErr=2'b10=Data Error<br />NOTE: NDERR means RespErr=2'b11=Non-Data Error<br />NOTE: For DVM transaction Comp packet, the legal error is DERR, NDERR.</p><p><br /><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=boon" rel="nofollow" style="text-decoration: none;">Boon Chuan</a><span>&nbsp;</span>added a comment -<span>&nbsp;</span><span class="commentdate_132538_verbose subText"><span class="date user-tz" title="13/Jan/22 1:29 PM">13/Jan/22 1:29 PM</span></span><span>&nbsp;</span>-<span>&nbsp;</span><span data-colorid="pkvg1ih2pl" class="redText subText" title="Boon Chuan - 18/Jan/22 12:08 PM">edited</span></p><p><del>The DCE will need to change the SNPrsp CMstatus aggregation ORing logic for the generation of STRreq CMstatus. Because the snoop response error from ACE is always 8'b10000011 (Data Error), but the snoop response error from CHI can be 8'b10000011 (Data Error), 8'b10000100 (Non-Data Error). ORing these could result in illegal CMstatus 8'b10000111.</del></p><p><del>The Error Architecture spec needs to define the aggregation results of Data Error and Address Error.</del></p><p>Khaleel said that the SNPrsp CMstatus error aggregation logic for the generation of STRreq CMstatus, currently implemented in DCE, is simply capturing an arriving snoop response response. That means the aggregation results is the last received snoop response error. If no snoop response error is received, then the aggregation results is 0.</p><p><br /></p><p><br /></p><p><br /><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=boon" rel="nofollow" style="text-decoration: none;">Boon Chuan</a><span>&nbsp;</span>added a comment -<span>&nbsp;</span><span class="commentdate_132539_verbose subText"><span class="date user-tz" title="13/Jan/22 1:34 PM">13/Jan/22 1:34 PM</span></span><span>&nbsp;</span>-<span>&nbsp;</span><span data-colorid="e6oeggal8g" class="redText subText" title="Boon Chuan - 13/Jan/22 2:31 PM">edited</span></p><p>The DCE will also need to change the support the newly updated requirements in this paragraph in the Error Architecture spec.</p><p><strong>New Spec</strong><span>&nbsp;</span>(in Error Architecture doc):</p><p>&quot;&quot;&quot;&quot;<br />When DCE gets any snoop response error<br />&bull; If any snooped AIU is providing the data, the protocol is completed by the DTRReq.<br />&bull; If no snooped AIU is providing the data, DCE issues STRReq with propagated error CMStatus.<br />&bull; If the original snoop was an invalidating snoop type (i.e the snooped agent is required to go to invalid state)then the snoop filter is updated to invalidate that agent, for all other snoop types, snoop filter status is not updated for that agent. (In general, it is expected that the agent that responded with an error went to an invalid state, but Ncore takes a more conservative approach due to ambiguity in ARM specs and only invalidates the snoop filter for cases where the snoop type required an invalidation)</p><p><br /></p><p>CMStatus error is propagated only on following responses<br />&bull; SnpRsp coming into DCE, only if no other related SnpRsp issued a DTR. this is propagated on to StrReq</p><p>&quot;&quot;&quot;</p><p><br /></p><p>The DCE also need to change to remove things that are not carried over from old spec to new spec:</p><p>See<span>&nbsp;</span><a class="external-link" href="https://arterisip.atlassian.net/browse/CONC-8920" rel="nofollow" style="text-decoration: none;" title="DCE snoop response error handling spec changes"><del>CONC-8920</del></a><span>&nbsp;</span>for the now-stale recently-implemented requirements:</p><p><strong>Old Spec:</strong></p><p>&quot;&quot;&quot;&quot;</p><p>1.For writes stashes and write unique</p><p>After getting all SnpRsp if DCE determines that a DtwReq was not issued by any snooped AIU then it forwards the error on to StrReq and cleans up the Rbr by issuing RbrRelease; if DCE determines that a DTW was issued by a snooped AIU then it does not forward the error on to the StrReq.</p><p><strong>2.For read stash</strong></p><p>a. case where the error happens after the target snoop<br />DCE needs to be updated to make sure it issues the Mrd and does not pass the error on to the StrReq</p><p>b. case where the error happens in the target snoop</p><p>DCE needs to be updated to treat it as a Read Stash Decline and does not pass the error on to the StrReq. DCE also does not issue any RBRreq messages and MRD message.</p><p><br /></p><p>3.</p><p>We should update the Snoop filter to say that the errored agent went to Invalid state</p><p>&quot;&quot;&quot;&quot;&nbsp;</p><p><br /></p><p><br /><a class="external-link" href="https://arterisip.atlassian.net/secure/ViewProfile.jspa?name=jasonv" rel="nofollow" style="text-decoration: none;">Jason Villanueva</a><span>&nbsp;</span>added a comment -<span>&nbsp;</span><span class="commentdate_132561_verbose subText"><span class="date user-tz" title="13/Jan/22 4:50 PM">13/Jan/22 4:50 PM</span></span></p><p>Regarding any change within the DMI. There is only one identified and simple.&nbsp;</p><p>The DMI will need to change the SLVERR to map to Data Error and not Target Error.</p>