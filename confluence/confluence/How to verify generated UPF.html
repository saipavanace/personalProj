<p>top.upf file is one of the collaterals generated by gen_collateral Maestro command in output/upf directory</p><p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1759723272673 {padding: 0px;}
div.rbtoc1759723272673 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1759723272673 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1759723272673'>
<ul class='toc-indentation'>
<li><a href='#HowtoverifygeneratedUPF-ToverifythatRTLverilogissyntacticallylegal'>To verify that RTL verilog is syntactically legal</a></li>
<li><a href='#HowtoverifygeneratedUPF-Toverifythatit&#39;ssyntacticallylegalforQuestasimulation'>To verify that it&#39;s syntactically legal for Questa simulation</a></li>
<li><a href='#HowtoverifygeneratedUPF-StaticanalysisoftheDUTwithQuesta'>Static analysis of the DUT with Questa</a></li>
<li><a href='#HowtoverifygeneratedUPF-TorunQuestasimulation'>To run Questa simulation</a></li>
<li><a href='#HowtoverifygeneratedUPF-ToverifythatupfislegalforSynopsysDesignCompiler'>To verify that upf is legal for Synopsys Design Compiler</a></li>
</ul>
</div></p><h3 id="HowtoverifygeneratedUPF-ToverifythatRTLverilogissyntacticallylegal">To verify that RTL verilog is syntactically legal</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">verilator --lint-only --error-limit 0 -Wall -Wno-UNUSED -Werror-UNDRIVEN -Ioutput/rtl/design output/rtl/design/gen_wrapper.v</pre>
</div></div><p><br/></p><h3 id="HowtoverifygeneratedUPF-Toverifythatit&#39;ssyntacticallylegalforQuestasimulation">To verify that it's syntactically legal for Questa simulation</h3><p>1. Setup an environment pointing to stable $REPO_PATH</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module purge
source /usr/share/Modules/init/bash
module load node/lts
module load symphony/tools/v1.1.0
setup_maestro
export WORK_TOP=${REPO_PATH}/hw-sym/dv
export PROJECT=sym
export PATH=$PATH:${REPO_PATH}/hw-scripts:${REPO_PATH}/hw-sym/dv/scripts
alias runsim=&#39;node ${REPO_PATH}/hw-scripts/runsim.js&#39;
alias runformal=&#39;node $WORK_TOP/scripts/runformal.js&#39;</pre>
</div></div><p>2. Compile verilog</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">cd output/
vlog ./rtl/design/*.v </pre>
</div></div><p class="auto-cursor-target">3. Determine the name of the top design, then r<span class="legacy-color-text-blue3">un vopt and examine the log file</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">export top_design=`grep -w _top rtl/design/hierarchy.json | cut -d\&quot; -f4`
vopt $top_design -pa_upf ./synthesis/upf/dut.upf -o gen_wrapper_opt | tee vopt.log </pre>
</div></div><h3 class="auto-cursor-target" id="HowtoverifygeneratedUPF-StaticanalysisoftheDUTwithQuesta">Static analysis of the DUT with Questa </h3><p>1. Run vopt with all checks and generate static database</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">vopt $top_design -pa_upf ./synthesis/upf/dut.upf -pa_staticdebug -debug +designfile -pa_checks=s  | tee vopt.log</pre>
</div></div><p>Report is in pa_reports/report.static.txt</p><p>2. Load vopt results to visualizer</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">visualizer +designfile</pre>
</div></div><p>Then select View =&gt; Power Aware and select one of the rubrics</p><h3 class="auto-cursor-target" id="HowtoverifygeneratedUPF-TorunQuestasimulation">To run Questa simulation </h3><p class="auto-cursor-target">*courtesy of Rama - thanks!</p><p class="auto-cursor-target">1. Create and cd to a new directory, which can be used for verification of multiple configs, ex:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">mkdir upf_test
cd upf_test</pre>
</div></div><p class="auto-cursor-target">2. Checkout  git repos, setup environment and move to hw-sym/dv</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">/engr/dev/tools/script/setup_sym
source SOURCEME
cd hw-sym/dv</pre>
</div></div><p class="auto-cursor-target">3. Define env var pointing to a directory where you've run maestro with collateral generation</p><pre class="auto-cursor-target">export RUN_DIR=/scratch/bennyw/upf/sym_4x4</pre><p class="auto-cursor-target">4.Modify 2 sections in testlist/top_axi_axi.json file</p><p>a. Under &quot;testlist&quot; section create</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&quot;upf_sanity_test&quot;: {
      &quot;name&quot;: &quot;top_rand_test&quot;,
      &quot;purpose&quot;: &quot;&quot;,
      &quot;config&quot;: [
        &quot;upf_test_config&quot;
      ],
      &quot;iter&quot;: &quot;&quot;,
      &quot;plusargs&quot;: {
        &quot;+awsize&quot;: &quot;2&quot;,
        &quot;+arsize&quot;: &quot;2&quot;,
        &quot;+awburst&quot;: &quot;1&quot;,
        &quot;+arburst&quot;: &quot;1&quot;,
        &quot;+NUM_TRANS&quot;: &quot;10&quot;,
        &quot;+seq&quot;: &quot;main-0-axi4_sequence_0-0,main-0-qchannel_assert_sequence-0,main-0-qchannel_assert_sequence-1,main-1-axi4_sequence_0-0&quot;
      },
      &quot;label&quot;: [
        &quot;upf&quot;
      ]
    }</pre>
</div></div><p>b. Under &quot;configlist&quot; section create ufp_test_config record with pointers to files generated by Maestro gen_collateral</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&quot;upf_test_config&quot;: {
   &quot;path&quot;: &quot;$RUN_DIR/output/debug/top.level.sym.dv.json&quot;,
   &quot;path_rtl&quot;: &quot;$RUN_DIR/output/debug/top.level.rtl.gw.csr.json&quot;,
   &quot;cprOptions&quot;: &quot;$RUN_DIR/output/debug/hack&quot;,
   &quot;upfTop&quot;: &quot;$RUN_DIR/output/synthesis/upf/dut.upf&quot;,
   &quot;label&quot;: [
      &quot;upf&quot;
    ]
}</pre>
</div></div><p>5. Modify design top name the top upf as it's uniquified with '_a' suffix</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">set_design_top gen_wrapper_a</pre>
</div></div><p>6. Launch runsim with the following options</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">runsim -t upf_sanity_test -w -v UVM_HIGH -tdbg -upf -so &quot;+en_sym_upf_tb&quot; -vo &quot;\-pa_genrpt=u+c \-pa_checks=i+ul+s+p \-pa_disable=lowerboundary \-pa_enable=highlight+debug \-pa_tclfile $RUN_DIR/output/synthesis/upf/tb.upf&quot; -so &quot;\-pa_highlight&quot; -i 0 | tee runsim.log </pre>
</div></div><p>The report will appear in file <strong>debug/top_axi_axi/upf_test_config/exe/pa_reports/report.static.txt</strong></p><p>To launch a full run including simulation, remove <strong>-i 0 </strong>(compile only)  from the command line and add <strong>-to 1000000000</strong> (timeout 1M ps = 1ms)<br/>Then at the end of the run a prompt how to run visualizer will appear, ex:</p><p>visualizer /scratch/bennyw/upf/my_sym_dv/hw-sym/dv/debug/top_axi_axi/upf_test_config/exe/design.bin /scratch/bennyw/upf/my_sym_dv/hw-sym/dv/debug/top_axi_axi/upf_test_config/run/upf_test_0/qwave.db</p><h3 class="auto-cursor-target" id="HowtoverifygeneratedUPF-ToverifythatupfislegalforSynopsysDesignCompiler">To verify that upf is legal for Synopsys Design Compiler</h3><p class="auto-cursor-target">1. ssh to fast machine like cinnabar</p><p class="auto-cursor-target">2. Setup synthesis environment</p><pre class="auto-cursor-target">module load snps/eng</pre><p class="auto-cursor-target">3. Go to run directory</p><pre class="auto-cursor-target">cd output/synthesis/synopsys/top</pre><p class="auto-cursor-target">4. Set these 2 params to 1 in ../scripts/dc_config.json</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&quot;checkOnly&quot;: 1,
&quot;keepInteractiveSession&quot;: 1,</pre>
</div></div><pre class="auto-cursor-target">5. Launch dc_shell<br/>/engr/dev/tools/synopsys/syn_vP-2019.03-SP5/syn/P-2019.03-SP5/bin/dc_shell -f ../scripts/dc.tcl</pre><p class="auto-cursor-target">It will read verilog, elaborate it and stop at interactive prompt</p><p class="auto-cursor-target">6. Load upf </p><pre class="auto-cursor-target">source ../../upf/load_upf.tcl</pre><p>*This automatically generated script contains load_upf command</p><p class="auto-cursor-target">7. Run MV checker command</p><pre class="auto-cursor-target">check_mv_design</pre><p class="auto-cursor-target">8. Report power domains</p><pre class="auto-cursor-target">report_power_domain -nosplit</pre><p class="auto-cursor-target">9. To remove all UPF information:</p><pre class="auto-cursor-target">remove_upf  </pre>