<p>This page describes a simplified scheme where we can place our entire system in a single switchable clock/power domain. Only the external clock gating style and Qchannel will be supported in 3.0</p><p>In Maestro we define a single pwr region=&gt;pwr domain structure and then single clk region=&gt;clk domain =&gt; clk subdomain. Clk domain gets bound to power domain - we will be able to define multiple clock domains per one power domain, but one clock domain must always be confined to one power domain. All network elements are bound to the only clock subdomain.</p><p>Here is an excerpt from Maestro tcl script related to creation of power/clock structures and their binding to network elements. Notice that this section must be sourced before running map_design command  </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: perl; gutter: false; theme: Confluence" data-theme="Confluence"># Create power region and switchable domain in it
set pwrregion_x [create_power_region -name pwr_reg_x -parent $chip]
set pwrdomain_x_0 [create_power_domain -name pwr_dom_x_0 -parent $pwrregion_x -gating dynamic]

# Create clock region and define clock frequency 
set clkregion_a [create_clock_region -name clk_a -parent $chip -frequency 1.6GHz]

# Create externally gated clock domain and bind it to a power domain $pwrdomain_x_0
set clkdomain_a_0 [create_clock_domain -name 0 -parent $clkregion_a -gating external -power_domain $pwrdomain_x_0]

# Create default (no divider) clock subdomain 
set clksubdomain_a_0_0 [create_clock_subdomain -name 0 -parent $clkdomain_a_0] 

# Associate all leaf blocks with clksubdomain a_0_0
foreach cell [get_cells] {
  update_object -name $cell -bind $clksubdomain_a_0_0
}</pre>
</div></div><p>   </p><p>When RTL json is generated by run_maestro its structure may look like this: </p><p><br/></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="900" src="https://arterisip.atlassian.net/wiki/download/attachments/16164631/image2020-6-2_11-46-46.png?api=v2"></span></p><p>Since there are no domain crossings in this setup, adapters are required neither in legato nor in presto transport. Subsequently in generated genwrapper json we should end up with a single PMA master unit which is connected through <a class="external-link" href="http://gitlab.arteris.com/hardware/hw-lib/blob/master/cpr/interface/InterfacePQChannel.interface.cpr" rel="nofollow">InterfacePQChannel</a> with all Ncore units. Each of these units will include PMA slave block. In contrast Presto ATUs are controlled through PMA slave, which can also be hooked up to a single PMA master, thus we end up with only one PQChannel interface to the outside world.    </p><p><br/></p><p>Here is the project development sequence (we may add more details as they become clear)</p><ul class="inline-task-list" data-inline-tasks-content-id="16164631"><li class="checked" data-inline-task-id="1">Propose TCL syntax for capturing the intent (Benny)</li><li class="checked" data-inline-task-id="16">Implement tcl wrapper commands to improve usability (Benny)</li><li class="checked" data-inline-task-id="15">Introduce concept of optional interface controlled by _<em>skip_  </em>parameter (Allan) </li><li class="checked" data-inline-task-id="14">PMA Object  to be introduced in Maestro ADM (Federico)</li><li class="checked" data-inline-task-id="2">TCL syntax to be supported by Maestro, in particular binding between clk and power domains (Ken)</li><li class="checked" data-inline-task-id="3">Genwrapper generator upgrades (Dan, Allan) <ul class="inline-task-list" data-inline-tasks-content-id="16164631"><li class="checked" data-inline-task-id="4">Ncore units inside gate clock domain to be passed &quot;UsePMA&quot; parameter</li><li class="checked" data-inline-task-id="5">PMA master unit instantiated for each switchable clock domain will have as many PQchannel master interfaces as there are Ncore units it controls  (i.e all Ncore units in that gated clock domain)</li><li class="checked" data-inline-task-id="6">Each Ncore unit in gated clock domain will have slave PQChannel interface for connection with PMA master block, for that purpose we'll pass parameter value _skip_=false to those interface<br/>By default Ncore unit in always-on domain will get UsePMA=false and its PQchannel interface will be _skip_=true</li><li class="checked" data-inline-task-id="7">Each PQchannel interface on Ncore unit is to be connected with correspondent interface on PMA master through a wire interface </li></ul></li><li class="checked" data-inline-task-id="17">Add ADM models for PMA slaves, muxes; create one of each per domain upon mapping (Federico)</li><li data-inline-task-id="25">Implement Presto configuration structure (Dan)<ul class="inline-task-list" data-inline-tasks-content-id="16164631"><li class="checked" data-inline-task-id="18">Create one PMA slave and one PMA mux with as many PMA control interfaces are there are ATUs</li><li data-inline-task-id="19">Connect all PMA control masters of the PMA mux to ATUs</li><li data-inline-task-id="20">Hook PMA MUX to PMA slave and the further to PMA master </li></ul></li><li data-inline-task-id="8"><a class="external-link" href="https://confluence.arteris.com/display/ENGR/InterfaceCLK" rel="nofollow">InterfaceCLK </a><ul class="inline-task-list" data-inline-tasks-content-id="16164631"><li class="checked" data-inline-task-id="9">definition to be expanded with enable signals (John)</li><li data-inline-task-id="10">define tcl commands in Maestro for passing down parameters for InterfaceCLK which will determine which signals are going to be exposed and which suppressed  (Benny)</li><li data-inline-task-id="11">pass parameter values to InterfaceCLK instances in generated json (Dan, Allan)</li></ul></li><li data-inline-task-id="12">Testing<ul class="inline-task-list" data-inline-tasks-content-id="16164631"><li class="checked" data-inline-task-id="21">First trial on dryrun - Ncore part only (Benny)</li><li class="checked" data-inline-task-id="22">Create a variant of hw_config_two with switchable power domain using new tcl command syntax (Bhavia)</li><li data-inline-task-id="23">Verify connectivity of generated GW json (Benny) </li><li data-inline-task-id="24"> Verify parametrization of generated GW json (Benny). </li></ul></li><li data-inline-task-id="13">Pass setup to DV - no need in UPF as this point  </li></ul><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p>