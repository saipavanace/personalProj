<p><strong>Detecting Deadlocks</strong><br/>When maestro runs deadlock checks, it builds a dependency graph where each node is a packet port and each edge shows that one port must finish before another can start.<br/>After the graph is complete, the checker looks for any loops by finding strongly connected components.<br/>If a cycle exists, that means there’s a deadlock.</p><p>Originally, dependencies came only from packet routes.<br/>For each route, which goes from a source port, through several intermediates, to a target port, we made one node per port.<br/>Then, for every port except the first, we added an edge from its predecessor port to itself.</p><p>Starting in 3.8, we also include links across chiplet instances.<br/>For each gateway link, we identify its two gateways and then NcoreGIUs.<br/>In each GIU we list all packetizers and depacketizers, gather their packet ports, and group the ports by network.<br/>Within each network group (e.g. ndn1), we add edges from every depacketizer port on one GIU to every packetizer port on the other GIU.</p><p /><p><strong>Error Reporting and Bypass</strong><br/>If a deadlock is found, you shall see an error message like this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">Error: [CHK-1021] Found deadlock in ChipletAssembly assembly1.
*** The current check is experimental. To by-pass error, please use:
  set_temporary_config -name IGNORE_ASSEMBLY_DEADLOCK -value true
***</pre>
</div></div><p /><p>Details of the deadlock appear in subsequent CHK‑1020 and CHK‑1025 messages.<br/>The CHK‑1025 entries list exactly which packet ports form each cycle and in which network they occur.<br/>In the GUI, clicking a CHK‑1025 error will highlight those deadlocked ports in each network view.<br/>A table of all involved ports is also shown to help you trace the loop.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">Error: [CHK-1020] &lt;dn/giu0_O3_sw @ chipletA::A1I0, dn/giu0_O3_sw @ chipletA::A1I1, dn/giu0_dpkt3 @ chipletA::A1I0, dn/giu0_dpkt3 @ chipletA::A1I1, dn/giu1_O3_sw @ chipletA::A1I0, dn/giu1_O3_sw @ chipletA::A1I1, dn/giu1_pkt3 @ chipletA::A1I0, dn/giu1_pkt3 @ chipletA::A1I1, giu0_O3_sw_giu0_O3_sw_O0__giu0_dpkt3_I0 @ chipletA::A1I0, giu0_O3_sw_giu0_O3_sw_O0__giu0_dpkt3_I0 @ chipletA::A1I1, giu1_O3_sw_giu1_O3_sw_O7__giu0_O3_sw_giu0_O3_sw_I2 @ chipletA::A1I0, giu1_O3_sw_giu1_O3_sw_O7__giu0_O3_sw_giu0_O3_sw_I2 @ chipletA::A1I1, giu1_pkt3_Z0__giu1_O3_sw_giu1_O3_sw_I0 @ chipletA::A1I0, giu1_pkt3_Z0__giu1_O3_sw_giu1_O3_sw_I0 @ chipletA::A1I1&gt; Deadlock #6 - A deadlock (dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I0 -&gt; dn/giu0_dpkt3/I0 @ chipletA::A1I0 -&gt; dn/giu1_pkt3/Z0 @ chipletA::A1I1 -&gt; dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I1 -&gt; dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I1 -&gt; dn/giu0_dpkt3/I0 @ chipletA::A1I1 -&gt; dn/giu1_pkt3/Z0 @ chipletA::A1I0 -&gt; dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I0 -&gt; dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I0) is detected in Network(s) { dn @ chipletA::A1I0 dn @ chipletA::A1I1 }. Please see involved PacketRoutes in the following.
Error: [CHK-1025] &lt;cni_sys_dii_O3_sw_cni_sys_dii_O3_sw_O4__lnk_cni_sys_dii_O3_sw_giu0_O3_sw_wdtAd_I0 @ chipletA::A1I0, dn/cni_sys_dii_O3_sw @ chipletA::A1I0, dn/giu0_O3_sw @ chipletA::A1I0, dn/giu0_dpkt3 @ chipletA::A1I0, dn/giu1_O3_sw @ chipletA::A1I0, dn/giu1_pkt3 @ chipletA::A1I0, dn/lnk_cni_sys_dii_O3_sw_giu0_O3_sw_wdtAd @ chipletA::A1I0, dn/s1_pkt3 @ chipletA::A1I0, dn/s1_sk_0_O3_sw @ chipletA::A1I0, dn/s2_pkt3 @ chipletA::A1I0, dn/s2_sk_0_O3_sw @ chipletA::A1I0, dn/s3_pkt4 @ chipletA::A1I0, dn/s3_sk_0_O4_sw @ chipletA::A1I0, dn/s4_pkt4 @ chipletA::A1I0, dn/s4_sk_0_O4_sw @ chipletA::A1I0, dn/sys_dii_pkt3 @ chipletA::A1I0, giu0_O3_sw_giu0_O3_sw_O0__giu0_dpkt3_I0 @ chipletA::A1I0, giu1_O3_sw_giu1_O3_sw_O7__giu0_O3_sw_giu0_O3_sw_I2 @ chipletA::A1I0, giu1_pkt3_Z0__giu1_O3_sw_giu1_O3_sw_I0 @ chipletA::A1I0, lnk_cni_sys_dii_O3_sw_giu0_O3_sw_wdtAd_Z0__giu0_O3_sw_giu0_O3_sw_I1 @ chipletA::A1I0, s1_pkt3_Z0__s1_sk_0_O3_sw_s1_sk_0_O3_sw_I0 @ chipletA::A1I0, s1_sk_0_O3_sw_s1_sk_0_O3_sw_O6__giu0_O3_sw_giu0_O3_sw_I3 @ chipletA::A1I0, s2_pkt3_Z0__s2_sk_0_O3_sw_s2_sk_0_O3_sw_I0 @ chipletA::A1I0, s2_sk_0_O3_sw_s2_sk_0_O3_sw_O6__giu0_O3_sw_giu0_O3_sw_I4 @ chipletA::A1I0, s3_pkt4_Z0__s3_sk_0_O4_sw_s3_sk_0_O4_sw_I0 @ chipletA::A1I0, s3_sk_0_O4_sw_s3_sk_0_O4_sw_O4__giu0_O3_sw_giu0_O3_sw_I5 @ chipletA::A1I0, s4_pkt4_Z0__s4_sk_0_O4_sw_s4_sk_0_O4_sw_I0 @ chipletA::A1I0, s4_sk_0_O4_sw_s4_sk_0_O4_sw_O4__giu0_O3_sw_giu0_O3_sw_I6 @ chipletA::A1I0, sys_dii_pkt3_Z0__cni_sys_dii_O3_sw_cni_sys_dii_O3_sw_I0 @ chipletA::A1I0&gt; Deadlock #6 - Found PacketRoute(s) deadlocked at turn dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I0 -&gt; dn/giu0_dpkt3/I0 @ chipletA::A1I0
Error: [CHK-1025] &lt;dn/giu0_O3_sw @ chipletA::A1I1, dn/giu0_dpkt3 @ chipletA::A1I1, dn/giu1_O3_sw @ chipletA::A1I1, dn/giu1_pkt3 @ chipletA::A1I1, giu0_O3_sw_giu0_O3_sw_O0__giu0_dpkt3_I0 @ chipletA::A1I1, giu1_O3_sw_giu1_O3_sw_O7__giu0_O3_sw_giu0_O3_sw_I2 @ chipletA::A1I1, giu1_pkt3_Z0__giu1_O3_sw_giu1_O3_sw_I0 @ chipletA::A1I1&gt; Deadlock #6 - Found PacketRoute(s) deadlocked at turn dn/giu1_pkt3/Z0 @ chipletA::A1I1 -&gt; dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I1
Error: [CHK-1025] &lt;dn/giu0_O3_sw @ chipletA::A1I1, dn/giu0_dpkt3 @ chipletA::A1I1, dn/giu1_O3_sw @ chipletA::A1I1, dn/giu1_pkt3 @ chipletA::A1I1, giu0_O3_sw_giu0_O3_sw_O0__giu0_dpkt3_I0 @ chipletA::A1I1, giu1_O3_sw_giu1_O3_sw_O7__giu0_O3_sw_giu0_O3_sw_I2 @ chipletA::A1I1, giu1_pkt3_Z0__giu1_O3_sw_giu1_O3_sw_I0 @ chipletA::A1I1&gt; Deadlock #6 - Found PacketRoute(s) deadlocked at turn dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I1 -&gt; dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I1
Error: [CHK-1025] &lt;cni_sys_dii_O3_sw_cni_sys_dii_O3_sw_O4__lnk_cni_sys_dii_O3_sw_giu0_O3_sw_wdtAd_I0 @ chipletA::A1I1, dn/cni_sys_dii_O3_sw @ chipletA::A1I1, dn/giu0_O3_sw @ chipletA::A1I1, dn/giu0_dpkt3 @ chipletA::A1I1, dn/giu1_O3_sw @ chipletA::A1I1, dn/giu1_pkt3 @ chipletA::A1I1, dn/lnk_cni_sys_dii_O3_sw_giu0_O3_sw_wdtAd @ chipletA::A1I1, dn/s1_pkt3 @ chipletA::A1I1, dn/s1_sk_0_O3_sw @ chipletA::A1I1, dn/s2_pkt3 @ chipletA::A1I1, dn/s2_sk_0_O3_sw @ chipletA::A1I1, dn/s3_pkt4 @ chipletA::A1I1, dn/s3_sk_0_O4_sw @ chipletA::A1I1, dn/s4_pkt4 @ chipletA::A1I1, dn/s4_sk_0_O4_sw @ chipletA::A1I1, dn/sys_dii_pkt3 @ chipletA::A1I1, giu0_O3_sw_giu0_O3_sw_O0__giu0_dpkt3_I0 @ chipletA::A1I1, giu1_O3_sw_giu1_O3_sw_O7__giu0_O3_sw_giu0_O3_sw_I2 @ chipletA::A1I1, giu1_pkt3_Z0__giu1_O3_sw_giu1_O3_sw_I0 @ chipletA::A1I1, lnk_cni_sys_dii_O3_sw_giu0_O3_sw_wdtAd_Z0__giu0_O3_sw_giu0_O3_sw_I1 @ chipletA::A1I1, s1_pkt3_Z0__s1_sk_0_O3_sw_s1_sk_0_O3_sw_I0 @ chipletA::A1I1, s1_sk_0_O3_sw_s1_sk_0_O3_sw_O6__giu0_O3_sw_giu0_O3_sw_I3 @ chipletA::A1I1, s2_pkt3_Z0__s2_sk_0_O3_sw_s2_sk_0_O3_sw_I0 @ chipletA::A1I1, s2_sk_0_O3_sw_s2_sk_0_O3_sw_O6__giu0_O3_sw_giu0_O3_sw_I4 @ chipletA::A1I1, s3_pkt4_Z0__s3_sk_0_O4_sw_s3_sk_0_O4_sw_I0 @ chipletA::A1I1, s3_sk_0_O4_sw_s3_sk_0_O4_sw_O4__giu0_O3_sw_giu0_O3_sw_I5 @ chipletA::A1I1, s4_pkt4_Z0__s4_sk_0_O4_sw_s4_sk_0_O4_sw_I0 @ chipletA::A1I1, s4_sk_0_O4_sw_s4_sk_0_O4_sw_O4__giu0_O3_sw_giu0_O3_sw_I6 @ chipletA::A1I1, sys_dii_pkt3_Z0__cni_sys_dii_O3_sw_cni_sys_dii_O3_sw_I0 @ chipletA::A1I1&gt; Deadlock #6 - Found PacketRoute(s) deadlocked at turn dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I1 -&gt; dn/giu0_dpkt3/I0 @ chipletA::A1I1
Error: [CHK-1025] &lt;dn/giu0_O3_sw @ chipletA::A1I0, dn/giu0_dpkt3 @ chipletA::A1I0, dn/giu1_O3_sw @ chipletA::A1I0, dn/giu1_pkt3 @ chipletA::A1I0, giu0_O3_sw_giu0_O3_sw_O0__giu0_dpkt3_I0 @ chipletA::A1I0, giu1_O3_sw_giu1_O3_sw_O7__giu0_O3_sw_giu0_O3_sw_I2 @ chipletA::A1I0, giu1_pkt3_Z0__giu1_O3_sw_giu1_O3_sw_I0 @ chipletA::A1I0&gt; Deadlock #6 - Found PacketRoute(s) deadlocked at turn dn/giu1_pkt3/Z0 @ chipletA::A1I0 -&gt; dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I0
Error: [CHK-1025] &lt;dn/giu0_O3_sw @ chipletA::A1I0, dn/giu0_dpkt3 @ chipletA::A1I0, dn/giu1_O3_sw @ chipletA::A1I0, dn/giu1_pkt3 @ chipletA::A1I0, giu0_O3_sw_giu0_O3_sw_O0__giu0_dpkt3_I0 @ chipletA::A1I0, giu1_O3_sw_giu1_O3_sw_O7__giu0_O3_sw_giu0_O3_sw_I2 @ chipletA::A1I0, giu1_pkt3_Z0__giu1_O3_sw_giu1_O3_sw_I0 @ chipletA::A1I0&gt; Deadlock #6 - Found PacketRoute(s) deadlocked at turn dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I0 -&gt; dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I0
Info: [CHK-1012] Involved PacketRoutes over the above deadlock:
+----------------------------------------------+----------------------------------------------+----------------------------------+
|               From PacketPort                |                To PacketPort                 |    Containing PacketRoute(s)     |
+==============================================+==============================================+==================================+
| dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I0 |            dn/giu0_dpkt3/I0 @ chipletA::A1I0 | dn_sys_dii_pkt3_Z0_giu0_dpkt3_I0 |
|                                              |                                              |    dn_giu1_pkt3_Z0_giu0_dpkt3_I0 |
|                                              |                                              |      dn_s1_pkt3_Z0_giu0_dpkt3_I0 |
|                                              |                                              |      dn_s2_pkt3_Z0_giu0_dpkt3_I0 |
|                                              |                                              |      dn_s3_pkt4_Z0_giu0_dpkt3_I0 |
|                                              |                                              |      dn_s4_pkt4_Z0_giu0_dpkt3_I0 |
| .                                            |                                            . |                                . |
| dn/giu0_dpkt3/I0 @ chipletA::A1I0            |             dn/giu1_pkt3/Z0 @ chipletA::A1I1 |                           *none* |
| dn/giu1_pkt3/Z0 @ chipletA::A1I1             | dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I1 |    dn_giu1_pkt3_Z0_giu0_dpkt3_I0 |
| .                                            |                                            . |                                . |
| dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I1 | dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I1 |    dn_giu1_pkt3_Z0_giu0_dpkt3_I0 |
| .                                            |                                            . |                                . |
| dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I1 |            dn/giu0_dpkt3/I0 @ chipletA::A1I1 | dn_sys_dii_pkt3_Z0_giu0_dpkt3_I0 |
|                                              |                                              |    dn_giu1_pkt3_Z0_giu0_dpkt3_I0 |
|                                              |                                              |      dn_s1_pkt3_Z0_giu0_dpkt3_I0 |
|                                              |                                              |      dn_s2_pkt3_Z0_giu0_dpkt3_I0 |
|                                              |                                              |      dn_s3_pkt4_Z0_giu0_dpkt3_I0 |
|                                              |                                              |      dn_s4_pkt4_Z0_giu0_dpkt3_I0 |
| .                                            |                                            . |                                . |
| dn/giu0_dpkt3/I0 @ chipletA::A1I1            |             dn/giu1_pkt3/Z0 @ chipletA::A1I0 |                           *none* |
| dn/giu1_pkt3/Z0 @ chipletA::A1I0             | dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I0 |    dn_giu1_pkt3_Z0_giu0_dpkt3_I0 |
| .                                            |                                            . |                                . |
| dn/giu1_O3_sw/giu1_O3_sw_O7 @ chipletA::A1I0 | dn/giu0_O3_sw/giu0_O3_sw_O0 @ chipletA::A1I0 |    dn_giu1_pkt3_Z0_giu0_dpkt3_I0 |
| .                                            |                                            . |                                . |
+----------------------------------------------+----------------------------------------------+----------------------------------+
</pre>
</div></div><p /><p><strong>Visualizing with .dot and .svg files</strong><br/>To get a graphic view, run <code>export-deadlock</code> on the JSON dump that maestro creates when a deadlock is detected (noted by CHK‑900).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">Info: [CHK-900] Graph has been written to deadlock_assembly1_1.json that 
can be visualized using the command line utility `export-deadlock`.</pre>
</div></div><p>This utility reads the full graph JSON and writes out .dot and .svg files.</p><p><strong>export-deadlock Usage</strong></p><ul><li><p><code>-i &lt;file&gt;</code>: specify the input JSON file.</p></li><li><p><code>-p</code>: prune out nodes not reachable from any node in any deadlock.</p></li><li><p><code>-g</code>: include only GIU nodes and GIU‑to‑GIU edges.</p></li><li><p><code>-n &lt;network&gt;</code>: show just the nodes and edges for one network (e.g. ndn1, ndn2, ndn3, ndn4, or dn).</p></li></ul><p>example commands:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">export-deadlock -i deadlock_assembly3_1.json -n ndn1
export-deadlock -p -i deadlock_assembly3_1.json
export-deadlock -i deadlock_assembly3_1.json
export-deadlock -i deadlock_assembly3_1.json -g</pre>
</div></div><p>Below are some sample .svg files generated using export-deadlock. Note that edges in different networks are in different colors. also, edges that are part of a deadlock are in bold line while the rest are in dotted line.</p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="deadlock_assembly3_1.dot.svg" width="250" src="https://arterisip.atlassian.net/wiki/download/attachments/1466400955/deadlock_assembly3_1.dot.svg?api=v2"></span><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="deadlock_assembly3_1_prune.dot.svg" width="250" src="https://arterisip.atlassian.net/wiki/download/attachments/1466400955/deadlock_assembly3_1_prune.dot.svg?api=v2"></span><p /><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="deadlock_assembly3_1_giu2giu.dot.svg" width="250" src="https://arterisip.atlassian.net/wiki/download/attachments/1466400955/deadlock_assembly3_1_giu2giu.dot.svg?api=v2"></span><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="deadlock_assembly3_1_ndn1.dot.svg" width="250" src="https://arterisip.atlassian.net/wiki/download/attachments/1466400955/deadlock_assembly3_1_ndn1.dot.svg?api=v2"></span><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="deadlock_assembly3_1_giu2giu_ndn1.dot.svg" width="250" src="https://arterisip.atlassian.net/wiki/download/attachments/1466400955/deadlock_assembly3_1_giu2giu_ndn1.dot.svg?api=v2"></span><p />