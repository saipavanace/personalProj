<h3 id="AXINXMsingle-switchwithstandardPMONconfiguration-BlockDiagram">Block Diagram</h3><p>Below is a diagram of the DUT (design under test) for the axi_pmon_nxm_<em>single_switch</em> configuration:</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" height="400" src="https://arterisip.atlassian.net/wiki/download/attachments/16171559/image2020-7-10_14-2-17.png?api=v2"></span></p><p>                                                                                                                                         Block diagram for AXI NXM Single-switch configuration with PMON</p><h3 id="AXINXMsingle-switchwithstandardPMONconfiguration-Stepstogeneratethedesign">Steps to generate the design</h3><ol><li>Create a Symphony work-area using steps mentioned here: <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168786/How+to+run+Symphony+simulations" data-linked-resource-id="16168786" data-linked-resource-version="24" data-linked-resource-type="page">How to run Symphony simulations:</a></li><li>cd $WORK_TOP/tb/top/pmon</li><li>./create_axi_pmon_single_switch.js -c config_2x3_axi_pmon.json (or any config file of choice. This creates all the design JSONs in the current directory. axi_pmon_2x3_top_rtl.json is the DUT (gen_wrapper) JSON.)</li><li>./axi_pmon_nxm_build  (This runs the tachl command to generate RTL in a folder called 'rtl')</li><li>cd rtl</li><li>verilator --lint-only ./gen_wrapper.v -I. --error-limit 0 -Wall -Wno-UNUSED -Werror-UNDRIVEN (Run verilator checks)</li><li>cd $WORK_TOP/tb/top/pmon</li></ol><h3 id="AXINXMsingle-switchwithstandardPMONconfiguration-Designdetails">Design details</h3><p>The design can be configured through a set of high level parameters that can be mentioned in a <strong>configuration file</strong> that the script reads.</p><p>You can create other configuration files using <em>config_2x3_axi_pmon.json</em> as a template. Here are some of the important parameters that can be used to control the design generation:</p><ol><li><em>name</em>: This string is attached as a prefix to all the JSON files created.</li><li><em>pktStyle</em>: This controls the ATP packet style. It can take one of the following three values: 'serial', 'parallel', fixed'.</li><li><em>numInits</em>: This sets the number of initiators (N) in the design.</li><li><em>numTargs</em>: This sets the number of targets (M) in the design.</li><li><em>maxOutRd</em>: This sets the number of entries in the context for read requests. maxOutRd+maxOutWr = number of allocation events = number of deallocation events = number of latency timers in the Stats block.</li><li><em>maxOutWr</em>: This sets the number of entries in the context for write requests. maxOutRd+maxOutWr = number of allocation events = number of deallocation events = number of latency timers in the Stats block.</li><li><em>nBins</em>: This determines the number of bins for roundtrip-latency binning setup in the Stats block. It creates nBins-1 registers for programming bin boundaries.Lowest and highest bin boundaries are assumed to be 0 and infinity.</li><li><em>pmonConfig</em>: This is a string that can take the following values: &quot;Extra&quot;, &quot;Std&quot;. &quot;Extra&quot; picks the <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16172032/HW-SYM+class+PmonStatsExtraConfig" data-linked-resource-id="16172032" data-linked-resource-version="8" data-linked-resource-type="page">HW-SYM class PmonStatsExtraConfig</a> for configuring all Stats blocks, <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16172029/HW-SYM+class+PmonProbeExtraConfig" data-linked-resource-id="16172029" data-linked-resource-version="14" data-linked-resource-type="page">HW-SYM class PmonProbeExtraConfig</a> for all request probes, and <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16171972/HW-SYM+class+PmonProbeStdConfig+PMON+Probe+Standard+Configuration" data-linked-resource-id="16171972" data-linked-resource-version="19" data-linked-resource-type="page">HW-SYM class PmonProbeStdConfig (PMON Probe Standard Configuration)</a> for all response probes. &quot;Std&quot; picks <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16171972/HW-SYM+class+PmonProbeStdConfig+PMON+Probe+Standard+Configuration" data-linked-resource-id="16171972" data-linked-resource-version="19" data-linked-resource-type="page">HW-SYM class PmonProbeStdConfig (PMON Probe Standard Configuration)</a> for probes and <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16171969/HW-SYM+class+PmonStatsStdConfig+PMON+Stats+Standard+Configuration" data-linked-resource-id="16171969" data-linked-resource-version="25" data-linked-resource-type="page">HW-SYM class PmonStatsStdConfig (PMON Stats Standard Configuration)</a> for all the Stats block in the design.</li></ol><p>The number of switches per network (request or response) is one.</p><h4 id="AXINXMsingle-switchwithstandardPMONconfiguration-ConfigurationSpaceAccess">Configuration Space Access</h4><p>There is only one port (top APB interface) that has access to configuration-space registers which has an APB interface (show in green in the block diagram). The apb_demux module allows access to multiple APB slave ports on various blocks in the design from a single top APB interface.</p><p>A single CSR JSON (<em>name</em>+&quot;_top.csr&quot;) for the configuration space registers are generated during Step 3 of &quot;Steps to generate the design&quot;. Hence the JSON is generated before TACHL compile which happens in Step4. There is only one port that can access the configuration space in this design and that is the APB port.</p><p>The CSR JSON is created by merging spaceblocks of individual CSRs of all top-level blocks that have an APB slave port (except apb_demux). The order in which they are merged is ensured to be the same order in which the apb Interfaces of all blocks are connected to apb_demux.</p><h4 id="AXINXMsingle-switchwithstandardPMONconfiguration-PMONsetup">PMON setup</h4><p>Every initiator is associated with two probes and a stats block as shown in the diagram. And the Stats blocks and Probe block are configured to support a standard set of features as defined in <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16172029/HW-SYM+class+PmonProbeExtraConfig" data-linked-resource-id="16172029" data-linked-resource-version="14" data-linked-resource-type="page">HW-SYM class PmonProbeExtraConfig</a>, <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16171969/HW-SYM+class+PmonStatsStdConfig+PMON+Stats+Standard+Configuration" data-linked-resource-id="16171969" data-linked-resource-version="25" data-linked-resource-type="page">HW-SYM class PmonStatsStdConfig (PMON Stats Standard Configuration)</a>, and <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16172032/HW-SYM+class+PmonStatsExtraConfig" data-linked-resource-id="16172032" data-linked-resource-version="8" data-linked-resource-type="page">HW-SYM class PmonStatsExtraConfig</a>. Which classes are picked for which blocks depends on the <em>pmonConfig</em> parameter. Refer it's description under the list of parameters above.</p><h4 id="AXINXMsingle-switchwithstandardPMONconfiguration-Interrupts">Interrupts</h4><p>All blocks that can generate an interrupt will have exactly one interrupt output port coming out of the block. See <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16172029/HW-SYM+class+PmonProbeExtraConfig" data-linked-resource-id="16172029" data-linked-resource-version="14" data-linked-resource-type="page">HW-SYM class PmonProbeExtraConfig</a> and <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16172032/HW-SYM+class+PmonStatsExtraConfig" data-linked-resource-id="16172032" data-linked-resource-version="8" data-linked-resource-type="page">HW-SYM class PmonStatsExtraConfig</a> for details of what interrupts are generated by this configuration for PMON.</p><p>Verification will have to rely on register descriptions in IPXACT XML to determine which bits are mapped to which interrupts. The format for specifying this mapping is described in <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16166990/OBSOLETE-DELETE+HW-SYM+Symphony+Block+Common+Characteristics" data-linked-resource-id="16166990" data-linked-resource-version="47" data-linked-resource-type="page">OBSOLETE-DELETE HW-SYM Symphony Block Common Characteristics</a>.  The page also explains how to discover which interrupts occurred and how to clear them.</p><p><br/></p><p><br/></p><p><br/></p>