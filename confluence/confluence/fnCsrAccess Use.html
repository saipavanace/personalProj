<div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>References:</p><p><a data-card-appearance="inline" href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16160456/Arch+Ncore+3.4+Docs?preview=/16160456/64749601/Ncore%20CSR%20access%20update%20Architecture%20Specification.pdf" rel="nofollow">https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16160456/Arch+Ncore+3.4+Docs?preview=/16160456/64749601/Ncore%20CSR%20access%20update%20Architecture%20Specification.pdf</a> </p><p>

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="MAES-6008" >
                <a href="https://arterisip.atlassian.net/browse/MAES-6008?src=confmacro" class="jira-issue-key">MAES-6008</a>
                            </span>
 </p><p>

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="MAES-5340" >
                <a href="https://arterisip.atlassian.net/browse/MAES-5340?src=confmacro" class="jira-issue-key">MAES-5340</a>
                            </span>
 </p><p>

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="MAES-5774" >
                <a href="https://arterisip.atlassian.net/browse/MAES-5774?src=confmacro" class="jira-issue-key">MAES-5774</a>
                            </span>
 </p><p>

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="MAES-5862" >
                <a href="https://arterisip.atlassian.net/browse/MAES-5862?src=confmacro" class="jira-issue-key">MAES-5862</a>
                            </span>
 </p><p>

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="MAES-5829" >
                <a href="https://arterisip.atlassian.net/browse/MAES-5829?src=confmacro" class="jira-issue-key">MAES-5829</a>
                            </span>
 </p><p>

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="MAES-5841" >
                <a href="https://arterisip.atlassian.net/browse/MAES-5841?src=confmacro" class="jira-issue-key">MAES-5841</a>
                            </span>
 </p></div></div><h2 id="fnCsrAccessUse-ProblemStatement">Problem Statement</h2><p /><p>The above-linked requirements are partially conflicting and were partially misunderstood, which led to an imperfect implementation in Ncore 3.4.</p><p /><p>In Ncore 3.4, the <code>fnCsrAccess</code> parameter is associated by Maestro to initiator Sockets, and from there it is propagated to the corresponding AIUs. Maestro treats this parameter as a complete on/off control to generate connectivity from said AIU towards the configuration DII; if the parameter is true, the connectivity is present (and therefore CSR access is possible), if false, then connectivity is completely absent (and therefore CSR access is physically impossible.) Note that this a simplification from the original intent of the 3.4 architectural spec, which intended <code>fnCsrAccess</code> to control the NRS bit (i.e. giving such AIUs “administrative” rights to CSR access), but also implicitly intended that all other AIUs would also be given the physical resources to access the CSR network.</p><p>Additionally, in Ncore 3.4, Maestro requires the creation of a debug APB Socket, which is also a CSR master. This interface is mandatory.</p><p>If no AIU is given <code>fnCsrAccess</code> high, Maestro for Ncore 3.4 will initially throw just a warning:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">Warning: [ADM-1575] &lt;project/default_chip/default_system/default_subsystem&gt; Only the EXTERNAL_DEBUG Socket will have CSR access at boot time, and will thus be the only way to bootstrap the system. Set fnCsrAccess to true on an INITIATOR Socket to allow booting from an internal Socket.</pre>
</div></div><p>However, if the user continues, Maestro will ultimately just error out, because the configuration DII is not connected to anything. Maestro detects this correctly, but is unable to resolve the issue because the existence of the configuration DII is not optional.</p><p>This leaves a few loose threads:</p><ul><li><p>The above-mentioned Warning really needs to be an Error, as the user will ultimately be unable to proceed.</p></li><li><p>The intent of <code>fnCsrAccess</code> is not clear. Also, Maestro provides inconsistent GUI to declare DII access: <code>fnCsrAccess</code> (basically, a checkbox) controls access from AIUs to the configuration DII, while a graphical widget controls access from AIUs to the other DIIs.</p></li><li><p>There is an apparent limitation because at least two initiators (an AIU and the external debug Socket) need to have CSR access rights, which runs counter to some safety requirements mandating that the user should be able to restrict this to only one.</p></li></ul><p /><h2 id="fnCsrAccessUse-DirectionsforNcore3.6">Directions for Ncore 3.6</h2><p /><p>During a meeting on July 14th, 2023, with the following attendees: <a class="confluence-userlink user-mention" data-account-id="624b36daed4d6b0070161eea" href="https://arterisip.atlassian.net/wiki/people/624b36daed4d6b0070161eea?ref=confluence" target="_blank" data-linked-resource-id="754406" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://arterisip.atlassian.net/wiki">Federico Angiolini</a> , <a class="confluence-userlink user-mention" data-account-id="624b374545ece00069cca858" href="https://arterisip.atlassian.net/wiki/people/624b374545ece00069cca858?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Ben Chen (Deactivated)</a> , <a class="confluence-userlink user-mention" data-account-id="624b37684fe01d006ba96e15" href="https://arterisip.atlassian.net/wiki/people/624b37684fe01d006ba96e15?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Michael Frank (Deactivated)</a> , <a class="confluence-userlink user-mention" data-account-id="624b37de258562006fa692da" href="https://arterisip.atlassian.net/wiki/people/624b37de258562006fa692da?ref=confluence" target="_blank" data-linked-resource-id="789965" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://arterisip.atlassian.net/wiki">Jason Villanueva</a> , <a class="confluence-userlink user-mention" data-account-id="5ed63c82037d930c16bd8c73" href="https://arterisip.atlassian.net/wiki/people/5ed63c82037d930c16bd8c73?ref=confluence" target="_blank" data-linked-resource-id="327834" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://arterisip.atlassian.net/wiki">Saad Zahid</a> , <a class="confluence-userlink user-mention" data-account-id="6137c753e2a0d60069b8eff7" href="https://arterisip.atlassian.net/wiki/people/6137c753e2a0d60069b8eff7?ref=confluence" target="_blank" data-linked-resource-id="327726" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://arterisip.atlassian.net/wiki">JeanPhilippe Loison</a> , <a class="confluence-userlink user-mention" data-account-id="624b377df6a26900695fd12b" href="https://arterisip.atlassian.net/wiki/people/624b377df6a26900695fd12b?ref=confluence" target="_blank" data-linked-resource-id="788741" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://arterisip.atlassian.net/wiki">Eric Howard</a> , the following was decided:</p><ul class="decision-list"><li>No changes will be made to the external APB Socket and the fact that its existence is mandatory.</li><li><code>fnCsrAccess</code> will maintain the current on/off behaviour in terms of controlling CSR access.</li><li><strong>ACTION ITEM </strong>Maestro shall enforce at least one initiator Socket to have <code>fnCsrAccess</code> set, i.e. the current Warning becomes an Error. This means that the configuration DII is always present and we do not need major SW/HW/DV rework. (

    

            



<style>
    .jira-issue {
        padding: 0 0 0 2px;
        line-height: 20px;
    }

    .jira-issue img {
        padding-right: 5px;
    }
    .jira-issue .aui-lozenge {
        line-height: 18px;
        vertical-align: top;
    }

    .jira-issue .icon {
        background-position: left center;
        background-repeat: no-repeat;
        display: inline-block;
        font-size: 0;
        max-height: 16px;
        text-align: left;
        text-indent: -9999em;
        vertical-align: text-bottom;
    }
</style>

    <span class="confluence-jim-macro jira-issue" data-jira-key="MAES-6394" >
                <a href="https://arterisip.atlassian.net/browse/MAES-6394?src=confmacro" class="jira-issue-key">MAES-6394</a>
                            </span>
 )</li><li>Maestro will enforce no upper limits on the number of AIUs having CSR access.</li><li>For customers needing the safety feature of only one CSR initiator, they will be able to do so by either externally disabling the debug APB interface (then the only CSR master can be a single AIU), or by using the NRS bit to disable the AIUs (then the only CSR master is the debug APB interface.)</li><li><strong>ACTION ITEM </strong>A HW change will be needed in the control of the NRS bit. Currently, initiators with <code>fnCsrAccess</code> set have this bit not only high, but also read-only to prevent the access being removed. An exception will need to be made for write accesses coming from the debug APB interface. <a class="confluence-userlink user-mention" data-account-id="624b37de258562006fa692da" href="https://arterisip.atlassian.net/wiki/people/624b37de258562006fa692da?ref=confluence" target="_blank" data-linked-resource-id="789965" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://arterisip.atlassian.net/wiki">Jason Villanueva</a>  proposes using the protection bits of that interface as an entry point.</li><li><strong>ACTION ITEM </strong>The Ncore 3.4 spec on CSR access, linked above, shall be updated for 3.6 with these decisions.</li></ul>