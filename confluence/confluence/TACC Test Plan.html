<h2 id="TACCTestPlan-Versions">Versions</h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Version</th><th class="confluenceTh">Date</th><th class="confluenceTh">Author</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">0.1</td><td class="confluenceTd">12-Jul-2021</td><td class="confluenceTd"><div class="content-wrapper"><a class="confluence-userlink user-mention" data-account-id="624b36d6f4079800705922a6" href="https://arterisip.atlassian.net/wiki/people/624b36d6f4079800705922a6?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Andrew Brock (Deactivated)</a></div></td><td class="confluenceTd">Initial version</td></tr><tr><td class="confluenceTd">1.2</td><td class="confluenceTd">20-Aug-2021</td><td class="confluenceTd"><div class="content-wrapper"><p><a class="confluence-userlink user-mention" data-account-id="624b36d6f4079800705922a6" href="https://arterisip.atlassian.net/wiki/people/624b36d6f4079800705922a6?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Andrew Brock (Deactivated)</a></p></div></td><td class="confluenceTd">Add caveats section, trace loss section</td></tr><tr><td class="confluenceTd">1.3</td><td class="confluenceTd">02-Sep-2021</td><td class="confluenceTd"><div class="content-wrapper"><p><a class="confluence-userlink user-mention" data-account-id="624b36d6f4079800705922a6" href="https://arterisip.atlassian.net/wiki/people/624b36d6f4079800705922a6?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Andrew Brock (Deactivated)</a></p></div></td><td class="confluenceTd">Add table of features tested</td></tr><tr><td colspan="1" class="confluenceTd">1.4</td><td colspan="1" class="confluenceTd">16-Sep-2021</td><td colspan="1" class="confluenceTd"><div class="content-wrapper"><p><a class="confluence-userlink user-mention" data-account-id="624b36d6f4079800705922a6" href="https://arterisip.atlassian.net/wiki/people/624b36d6f4079800705922a6?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Andrew Brock (Deactivated)</a></p></div></td><td colspan="1" class="confluenceTd">additions for 3.2</td></tr><tr><td colspan="1" class="confluenceTd">1.5</td><td colspan="1" class="confluenceTd">16-Dec-2021</td><td colspan="1" class="confluenceTd"><div class="content-wrapper"><p><a class="confluence-userlink user-mention" data-account-id="624b36d6f4079800705922a6" href="https://arterisip.atlassian.net/wiki/people/624b36d6f4079800705922a6?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Andrew Brock (Deactivated)</a></p></div></td><td colspan="1" class="confluenceTd">add functional coverage</td></tr></tbody></table></div><h2 id="TACCTestPlan-TableofContents">Table of Contents</h2><p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1759723632114 {padding: 0px;}
div.rbtoc1759723632114 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1759723632114 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1759723632114'>
<ul class='toc-indentation'>
<li><a href='#TACCTestPlan-Versions'>Versions</a></li>
<li><a href='#TACCTestPlan-TableofContents'>Table of Contents</a></li>
<li><a href='#TACCTestPlan-TestbenchStructure'>Testbench Structure</a></li>
<li><a href='#TACCTestPlan-'></a></li>
<li><a href='#TACCTestPlan-Phases'>Phases</a>
<ul class='toc-indentation'>
<li><a href='#TACCTestPlan-Phase0'>Phase 0</a></li>
<li><a href='#TACCTestPlan-Phase1'>Phase 1</a></li>
<li><a href='#TACCTestPlan-TraceLoss'>Trace Loss</a></li>
<li><a href='#TACCTestPlan-DataNetwork(DROPPED)'>Data Network (DROPPED)</a></li>
<li><a href='#TACCTestPlan-ECCErrorInjection'>ECC Error Injection</a></li>
</ul>
</li>
<li><a href='#TACCTestPlan-Configs'>Configs</a></li>
<li><a href='#TACCTestPlan-TestCases'>Test Cases</a></li>
<li><a href='#TACCTestPlan-FunctionalCoverage'>Functional Coverage</a></li>
<li><a href='#TACCTestPlan-Limitations'>Limitations</a></li>
</ul>
</div></p><h2 id="TACCTestPlan-TestbenchStructure">Testbench Structure</h2><p>(Image from <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16777248/DVE+v3.0+TestPlan" data-linked-resource-id="16777248" data-linked-resource-version="89" data-linked-resource-type="page">DVE v3.0 TestPlan</a>)</p><h2 id="TACCTestPlan-"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="https://arterisip.atlassian.net/wiki/download/attachments/16777248/image2019-3-29%2010:57:33.png?api=v2"></span></h2><p>The TACC test code will be integrated into the existing DVE scoreboard. since it already has the SMI monitors and CSR access hooks that we need.</p><h2 id="TACCTestPlan-Phases">Phases</h2><h3 id="TACCTestPlan-Phase0">Phase 0</h3><ol><li>read/write APB registers</li><li>read xTADHR with DVETASCR[CircularBuffer] cleared<ol><li>test will be kept short enough to avoid an overflow</li><li>this lets us run at end-of-test, if necessary</li><li>this requires driving the transfer state machine: you have to initiate a copy and wait for it to complete to see even one window at a time</li></ol></li><li>Write stimulus that includes locally-generated DTWreqs</li><li>manual inspection of header/data<br/><ol><li>read-out contents get checked against SMI activity and against AIU bench output</li></ol></li></ol><h3 id="TACCTestPlan-Phase1">Phase 1</h3><ol><li>Automate header/data checking</li><li>extend test lengths<ol><li>this will require any checks that were previously end-of-test to run during the test</li><li>test circular overflow, non-circular overflow, and manual DVETASCR[ClearBuffer]</li></ol></li><li>timestamp checking: confirm that timestamp correction in DtwDbgRsps matches the correction that should have been sent</li></ol><h3 id="TACCTestPlan-TraceLoss">Trace Loss</h3><p>Trace loss testing uses the BufferIsFull register to determine when we are currently dropping packets. We will then see packet loss either immediately (in the case of a circular buffer) or one buffer length later (in the case of a linear buffer). However, due to timing differences we cannot know exactly how many packets were dropped during each window. Instead, we will check RTL's drop count in the performance counters to compare it to DV's own idea of how many packets were dropped.</p><p>This uses the plusarg <code>+dve_dtw_dbg_loss</code> to cause the testbench to delay starting to read until the buffer fills up, to force trace loss to occur. A random offset will be added to this to test trace loss at times when the read/write pointer are not at the boundaries of the buffer memory.</p><p>Trace loss needs to be tested both with and without <code>+dve_dtw_dbg_circular</code>. Whether the buffer is circular or not only affects behavior in a trace loss condition.</p><h3 id="TACCTestPlan-DataNetwork(DROPPED)">Data Network (DROPPED)</h3><p>Existing FSYS benches don't observe the information we need to guarantee that DTW packets cross the network correctly. The data network is a Legato SMI network, so the existing Legato testbench will give the best guarantees of data integrity and no packet loss with minimal scoreboard development. However, integrating this testbench into the NCore build system is nontrivial, since it was written for a symphony environment.</p><p>A separate FSYS scoreboard for trace could also be written, connecting the capture testbenches to the accumulator testbench. This would require a scoreboard to be developed.</p><h3 id="TACCTestPlan-ECCErrorInjection">ECC Error Injection</h3><p>The ECC error injection mechanism injects errors using the SRAM built-in <code>inject_single_error, inject_double_error, and inject_addr_error</code> functions. These correctible and uncorrectible errors are also observed by tapping the event signals within the RTL: the counts must match. We cannot necessarily detect that an uncorrectible error has occurred by observing the uncorrected error in the data bits read out, if both injected error bits are in the address or ECC bits, and in the event of an address error the data bits read out will be unrelated to the expected data bits, so we simply disable data correctness checking for error test cases and only use the error test cases to make sure the injected/seen counts match.</p><h2 id="TACCTestPlan-Configs">Configs</h2><p>We don't need any special configs: the length of the buffer appears to be the only parameter, and as long as it is possible to overflow it, we can get all the coverage we need.</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Config</th><th class="confluenceTh">New?</th><th class="confluenceTh"><p>Purpose</p></th></tr><tr><td colspan="1" class="confluenceTd">hw_cfg_7</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">general</td></tr><tr><td colspan="1" class="confluenceTd">hw_config_9</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">general</td></tr><tr><td colspan="1" class="confluenceTd">hw_config_7_long_tacc</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">build longest buffer (len=1024)</td></tr><tr><td colspan="1" class="confluenceTd">hw_config_7_short_tacc</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">build shortest buffer (len=32)</td></tr></tbody></table></div><h2 id="TACCTestPlan-TestCases">Test Cases</h2><p>All test cases are run on hw_cfg_7 and hw_config_9.</p><p>Circular test cases use a circular buffer. Others use a linear buffer.</p><p>Drop test cases wait for the buffer to fill before beginning read-out.</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 75.2036%;"><colgroup><col style="width: 25.2217%;"/><col style="width: 14.7783%;"/><col style="width: 7.03777%;"/><col style="width: 7.63219%;"/><col style="width: 5.91626%;"/><col style="width: 24.2365%;"/><col style="width: 9.7537%;"/><col style="width: 5.42693%;"/></colgroup><tbody><tr><th class="confluenceTh">Name</th><th class="confluenceTh">Sequence</th><th class="confluenceTh">#pkt</th><th class="confluenceTh">Circular?</th><th colspan="1" class="confluenceTh">Drop?</th><th colspan="1" class="confluenceTh">Purpose</th><th colspan="1" class="confluenceTh">Completed?</th><th colspan="1" class="confluenceTh">Pass?</th></tr><tr><td class="confluenceTd">trace_accumulate</td><td class="confluenceTd">dve_bringup_test</td><td class="confluenceTd">63</td><td class="confluenceTd">no</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">general non-drop test (read FSM function, src ID, data, timestamp checking)</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td></tr><tr><td class="confluenceTd">trace_accumulate_loss_linear</td><td class="confluenceTd">dve_bringup_test</td><td class="confluenceTd">100</td><td class="confluenceTd">no</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">linear drop/recover from drop test</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td></tr><tr><td class="confluenceTd">trace_accumulate_loss_circular</td><td class="confluenceTd">dve_bringup_test</td><td class="confluenceTd">100</td><td class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">circular drop/recover from drop test</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td></tr><tr><td class="confluenceTd">trace_accumulate_buffer_clear_linear</td><td class="confluenceTd">dve_buffer_clear_test</td><td class="confluenceTd">directed</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">test exact timings of BufferEmpty, operation of BufferClear</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td></tr><tr><td class="confluenceTd">trace_accumulate_buffer_clear_circular</td><td class="confluenceTd">dve_buffer_clear_test</td><td class="confluenceTd">directed</td><td class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">test exact timings of BufferEmpty, operation of BufferClear</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td></tr><tr><td class="confluenceTd">trace_accumulate_drop_k_linear</td><td class="confluenceTd">dve_drop_k_test</td><td class="confluenceTd">directed</td><td class="confluenceTd">no</td><td class="confluenceTd">yes</td><td class="confluenceTd">test exact timings of BufferFull and exact numbers of dropped packets</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td></tr><tr><td class="confluenceTd">trace_accumulate_drop_k_circular</td><td class="confluenceTd">dve_drop_k_test</td><td class="confluenceTd">directed</td><td class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">test exact timings of BufferFull and exact numbers of dropped packets</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">yes</td></tr><tr><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">ECC error checking</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">APB and SMI delays</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">timestamp rollover test</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div><h2 id="TACCTestPlan-FunctionalCoverage">Functional Coverage</h2><p>The FIFO status bits are read by the <code>dve_dtwdbg_reader</code>  out of the DVETASCR register over APB, then logged in the scoreboard. The timestamp information is read out of the DtwDbgRsp by the SMI monitor, then logged in the scoreboard.</p><p>The ECC info will be caught by reading the events out of the internal signals and relaying it from <code>dve_tb_top</code> to <code>dve_sb</code> with an event. Drop events are also checked by an event tapping <code>dve_tb_top</code> . It is expected that perfmon's counter implementation is checked as part of perfmon verification.</p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 71.7066%;"><colgroup><col style="width: 9.92686%;"/><col style="width: 19.0421%;"/><col style="width: 10.2403%;"/><col style="width: 19.117%;"/><col style="width: 9.61163%;"/><col style="width: 32.0655%;"/></colgroup><tbody><tr><th class="confluenceTh">Coverpoint</th><th colspan="1" class="confluenceTh">Source</th><th class="confluenceTh">Completion</th><th colspan="1" class="confluenceTh">Bins</th><th colspan="1" class="confluenceTh">Cross Bins</th><th class="confluenceTh">Description</th></tr><tr><td colspan="1" class="confluenceTd">CIRC</td><td colspan="1" class="confluenceTd">DVETASCR.BufferIsCircular</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">circular, linear</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">buffer mode</td></tr><tr><td class="confluenceTd">RFULL</td><td colspan="1" class="confluenceTd">DVETASCR.BufferIsFull</td><td class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">N/A</td><td colspan="1" class="confluenceTd">CIRC</td><td class="confluenceTd">buffer reaches full</td></tr><tr><td class="confluenceTd">LFULL</td><td colspan="1" class="confluenceTd">DVETASCR.BufferIsFull</td><td class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">N/A</td><td colspan="1" class="confluenceTd">CIRC</td><td class="confluenceTd">buffer leaves full</td></tr><tr><td class="confluenceTd">REMPTY</td><td class="confluenceTd">DVETASCR.BufferIsEmpty</td><td class="confluenceTd"><br/></td><td class="confluenceTd">N/A</td><td colspan="1" class="confluenceTd">CIRC</td><td class="confluenceTd"><p>buffer reaches empty</p></td></tr><tr><td class="confluenceTd">DROP</td><td colspan="1" class="confluenceTd">drop events</td><td class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">N/A</td><td colspan="1" class="confluenceTd">CIRC</td><td class="confluenceTd">drop</td></tr><tr><td colspan="1" class="confluenceTd">BUF_CLEAR</td><td colspan="1" class="confluenceTd">testbench action</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">N/A</td><td colspan="1" class="confluenceTd">CIRC</td><td colspan="1" class="confluenceTd"><p>buffer cleared</p></td></tr><tr><td colspan="1" class="confluenceTd">TS_ROLL</td><td colspan="1" class="confluenceTd">DVETADTSR</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">timestamp rollover</td></tr><tr><td colspan="1" class="confluenceTd">TS_CORR</td><td colspan="1" class="confluenceTd">DtwDbgRsp</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">positive, positive saturated, negative saturated, negative, zero</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">timestamp correction</td></tr><tr><td colspan="1" class="confluenceTd">ECC_SING</td><td colspan="1" class="confluenceTd">ECC events</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">N/A</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">single error seen</td></tr><tr><td colspan="1" class="confluenceTd">ECC_DOUB</td><td colspan="1" class="confluenceTd">ECC events</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">N/A</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">double error seen</td></tr></tbody></table></div><h2 id="TACCTestPlan-Limitations">Limitations</h2><ol><li>BufferClear has no reliable external effects. In theory it should affect BufferEmpty but if we have DtwDbgReqs coming in during clearing this isn't reliable.</li><li>CircularBuffer could theoretically be modified in mid-trace in ways that affect trace loss (e.g. by switching from a circular buffer to a linear buffer). It's difficult to model what this would look like from outside, so we don't attempt to stimulate this.</li><li>Our timestamp stimulus doesn't reflect the way an actual TCAP would react, so at unit level we won't see any of the systemic problems that could exist. <a class="confluence-userlink user-mention" data-account-id="624b36d6f4079800705922a6" href="https://arterisip.atlassian.net/wiki/people/624b36d6f4079800705922a6?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Andrew Brock (Deactivated)</a> is considering developing a formal system model if FSYS coverage isn't adequate. This would also help with showing on what scales monotonicity is possible.</li><li>The data network verification plan got dropped: we are not doing anything end-to-end.</li></ol>