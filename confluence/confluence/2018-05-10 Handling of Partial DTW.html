<h2 id="id-2018-05-10HandlingofPartialDTW-Date">Date</h2><p><time datetime="2018-05-10" class="date-past">10 May 2018</time></p><h2 id="id-2018-05-10HandlingofPartialDTW-Attendees">Attendees</h2><ul><li><p><a class="confluence-userlink user-mention" data-account-id="624674b5f40798007056fc6f" href="https://arterisip.atlassian.net/wiki/people/624674b5f40798007056fc6f?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Steve Kromer (Deactivated)</a></p></li><li><p><a class="confluence-userlink user-mention" data-account-id="624b3757258562006fa69287" href="https://arterisip.atlassian.net/wiki/people/624b3757258562006fa69287?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Sanjay Deshpande (Deactivated)</a></p></li></ul><h2 id="id-2018-05-10HandlingofPartialDTW-Goals">Goals</h2><ul><li>Clarifying Partial Writes Size and how to handle</li><li>Led to deeper discussion of handshaking required in partial writes and corner case not yet handled</li></ul><h2 id="id-2018-05-10HandlingofPartialDTW-Discussionitems">Discussion items</h2><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Time</th><th class="confluenceTh">Item</th><th class="confluenceTh">Who</th><th class="confluenceTh">Notes</th></tr><tr><td class="confluenceTd"> </td><td class="confluenceTd">Partial Write Size</td><td class="confluenceTd"> </td><td class="confluenceTd"><ul><li>Requesting size field in RBReq (and NCCMDw?) for Partial Writes, in the same way that Size is given in NCCMD for reads.<br/>It's possible to determine size by counting DTW beats, but in coherent writes and both coherent and noncoherent reads the size is known as soon as the address is known</li></ul></td></tr><tr><td class="confluenceTd"> </td><td class="confluenceTd"><p>Write Handshaking</p></td><td class="confluenceTd"> </td><td class="confluenceTd"><p>Two basic cases already covered</p><ul><li>RBreq to DMI but DMI doesn't know that no DTW will be sent<ul><li>DCE will send RBreq release to DMI</li></ul></li><li>RBreq to DMI, but DCE doesn't know when DMI is finished with RBid<ul><li>DMI will send RBUsed to DCE when finished with RBid</li></ul></li></ul><p>New concern is Write Partial such as WriteUniquePtl where an RBID is used for more than 1 DTW.</p><ul><li>RBReq to DMI. Primary DTW will go to DMI.</li><li>There may or may not be a Secondary DTW to DMI. DCE knows that this is possible, but doesn't know for sure there exists a secondary DTW until later and would not want to hold up DMI until this is known.</li><li>How to handle the handshake for reserving an RBID and neither DMI or DCE knows when finished with RBID in this case?</li></ul></td></tr><tr><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">Merging</td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"><ul><li>DMI must process 2 DTWs so that if byte enables are set in both, then the Primary one wins. Result is as if the Secondary DTW was done first, then the Primary DTW.</li><li>Secondary DTW may arrive at DMI before or after Primary DTW.</li><li>A simple implementation would be to use RAM to merge the writes, but the RAM size would worst case have to be as big as the RBIDs, which goes against the initial reason (area savings) for splitting address and data in separate transactions. Alternative is to do DTW in the order they arrive and manage the merge by adjusting byte masks.</li><li><span>Currently there's no way to distinguish Primary and Secondary.</span></li></ul></td></tr><tr><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">Assumptions</td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"><ul><li>Address and Size for DTW is assumed to be full cacheline with first data beat at base of cacheline.</li><li>Partials are the only case with more than 1 DTW possible. In Partials, there can never be more than 2 DTWs.</li></ul></td></tr></tbody></table></div><h2 id="id-2018-05-10HandlingofPartialDTW-Actionitems">Action items</h2><ul class="inline-task-list" data-inline-tasks-content-id="16169610"><li data-inline-task-id="1"><a class="confluence-userlink user-mention" data-account-id="624b3757258562006fa69287" href="https://arterisip.atlassian.net/wiki/people/624b3757258562006fa69287?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Sanjay Deshpande (Deactivated)</a> Add Size to DTW_Ptl or spell out that it's inferred by data beats.</li><li data-inline-task-id="26"><a class="confluence-userlink user-mention" data-account-id="624b3757258562006fa69287" href="https://arterisip.atlassian.net/wiki/people/624b3757258562006fa69287?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Sanjay Deshpande (Deactivated)</a> Add primary/secondary info in messages. Sort out  DCE/DMI handshaking for DTW_Ptl case. Describe handshaking to <a class="confluence-userlink user-mention" data-account-id="624b37ffad6b7e006aa7d897" href="https://arterisip.atlassian.net/wiki/people/624b37ffad6b7e006aa7d897?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Mohammed Khaleeluddin (Deactivated)</a>.  </li><li data-inline-task-id="27"><a class="confluence-userlink user-mention" data-account-id="624674b5f40798007056fc6f" href="https://arterisip.atlassian.net/wiki/people/624674b5f40798007056fc6f?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Steve Kromer (Deactivated)</a> Think through byte mask merging in RTL</li><li data-inline-task-id="28"><a class="confluence-userlink user-mention" data-account-id="624b3757258562006fa69287" href="https://arterisip.atlassian.net/wiki/people/624b3757258562006fa69287?ref=confluence" target="_blank" data-base-url="https://arterisip.atlassian.net/wiki">Sanjay Deshpande (Deactivated)</a> Confirm assumptions<br/><br/></li></ul>