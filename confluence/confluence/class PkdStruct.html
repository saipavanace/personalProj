<p><span class="legacy-color-text-blue3">This is a JS class that can be found in the following path and file:</span><br/><strong>hw-lib/js/lib_utils.js</strong></p><h2 id="classPkdStruct-BaseClass">Base Class</h2><p>None</p><h2 id="classPkdStruct-Composition">Composition</h2><p><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16155846/class+Slice" data-linked-resource-id="16155846" data-linked-resource-version="7" data-linked-resource-type="page">class Slice</a><br/>Map (<a class="external-link" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map</a>)</p><h2 id="classPkdStruct-Description">Description</h2><p><span class="legacy-color-text-blue3">The class implements the proposal for a packed struct implementation mentioned here: <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16155799/Support+for+packed+data-structures+in+TACHL" data-linked-resource-id="16155799" data-linked-resource-version="22" data-linked-resource-type="page">Support for packed data-structures in TACHL</a>. The class provides a way to access a set of fields of potentially unequal width, packed onto a bus to fetch, by name, information such as the field's position, width, associated values etc. The class also supports hierarchical access of packed fields (struct of structs or struct of arrays). </span></p><p><span class="legacy-color-text-blue3">The class itself is initialized with a packed data-structure representation (array of objects with name and width) to create an instance of packed struct. The packed struct can also be created as an empty container whose fields and optional values associated could be set dynamically.</span></p><h2 id="classPkdStruct-Implementation"><span class="legacy-color-text-blue3">Implementation</span></h2><p><span class="legacy-color-text-blue3">The class is implemented simply as a wrapper over an in-built data-structure called Map ( ordered Map) in JavaScript. This allows accessing fields by name in sub-linear time ( better than O(n) ). The class also has-a <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16155846/class+Slice" data-linked-resource-id="16155846" data-linked-resource-version="7" data-linked-resource-type="page">class Slice</a> instance to represent the position and width of the whole struct. Internally the class computes offsets for fields based on their widths and order in which they appear or are set. The offsets are then stored in the Map data-structure. All internal offsets are done in little endian format and only modified according to the endianness set when a method needs to return.</span></p><p><span class="legacy-color-text-blue3">To further improve performance, the last entry retrieved from the Map inside is cached. Hence repeated accesses to the same field, but possibly different attributes (slice, value, packType, width), will only cost O(1) except for the first access which costs O( log(n) ).    </span></p><h2 id="classPkdStruct-Properties"><span class="legacy-color-text-blue3">Properties</span></h2><p><span class="legacy-color-text-blue3">The class provides the following properties:</span></p><ol><li><em>start</em> : Position of the most-significant bit of the packed struct instance</li><li><em>end</em> : Position of the least-significant bit of the packed struct instance</li><li><em>width</em> : Width of the packed struct</li><li><em>length</em> : Number of fields at the top-level struct. Hierarchical fields are not counted.</li></ol><h2 id="classPkdStruct-Interface(Methods)">Interface (Methods)</h2><p>All class methods described below are non-mutating (except the constructor). The class provides the following interface:</p><h5 id="classPkdStruct-constructor(struct,options)"><em>constructor ( struct, options )</em></h5><p>Creates an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156641/class+PkdStruct">class PkdStruct</a>.<span> Both parameters are optional. When no parameters are specified, an empty packed struct container is created. The parameter <em>struct</em> is expected to be an array of objects representing a packed struct. Each object represents a struct member and is expected to have the following fields:</span></p><ol><li><em>name.</em> String. This becomes the name of the struct member or field. This must exist.</li><li><em>width</em>. A positive integer. This specifies the width of the field. If <em>packType</em> = &quot;struct&quot; or &quot;array&quot;, this field is optional and can be computed internally. Otherwise this field must exist.</li><li><em>value</em>. This specifies an associated value stored with each struct member. If <em>packType</em> = &quot;struct&quot; or &quot;array&quot; and <em>unpack</em> = true, the value is interpreted as another packed structure allowing hierarchical access into its fields. If <em>packType</em> is undefined or empty, this field is optional and can be of any type.</li><li><em>packType</em>. String. This specifies the type of value stored in a field. It can take one of the following values: &quot;struct&quot; or &quot;array&quot;. This field is optional. If undefined, the stored <em>value</em> is assumed to be of non-packed value.</li></ol><p>The parameter <em>options</em> is expected to be an object with the following properties:</p><ol><li><em>endian</em>: String. Supported values = &quot;little&quot;, &quot;big&quot;. This specifies the order in which the fields appear on a bus from LSB to MSB. If endian = &quot;little&quot;, the first field in the struct array occupies the least significant bits. Otherwise the first field in the struct occupies the most significant bits. Default: &quot;big&quot;.</li><li><em>unpack</em>: Boolean. When <em>true</em>, fields with <em>packType</em> = &quot;struct&quot;, the value is replaced by an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156641/class+PkdStruct">class PkdStruct</a> initialized with the same <em>value</em>, and fields with <em>packType</em> = &quot;array&quot;, the value is replaced by an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156285/class+PkdArray" data-linked-resource-id="16156285" data-linked-resource-version="3" data-linked-resource-type="page">class PkdArray</a> initialized with the same <em>value</em>. If false, the value is not interpreted as a packed data-structure. Default: true.</li><li><em>start.</em> A positive integer or zero. Sets the position of the most-significant bit of the packed struct. Default: end + width-of-struct -1.</li><li><em>end</em>. A positive integer or zero. Sets the position of the least-significant bit of the packed struct. Default: 0 if start is undefined. start - width-of-struct + 1 otherwise.</li></ol><p><br/></p><h5 id="classPkdStruct-get(name)"><em>get ( name )</em></h5><p>Returns the associated <em>value</em> stored with a field or member with the matching <em>name</em> if <em>unpack</em> = false or <em>packType</em> = undefined or empty. If <em>unpack</em> = true, and <em>packType</em> = &quot;struct&quot;, then the value returned is an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156641/class+PkdStruct">class PkdStruct</a>. If <em>unpack</em> = false, and <em>packType</em> = &quot;array&quot;, then the value returned is an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156285/class+PkdArray" data-linked-resource-id="16156285" data-linked-resource-version="3" data-linked-resource-type="page">class PkdArray</a>.</p><p><br/></p><h5 id="classPkdStruct-slice(name)"><em>slice ( name )</em></h5><p>Returns an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16155846/class+Slice" data-linked-resource-id="16155846" data-linked-resource-version="7" data-linked-resource-type="page">class Slice</a> that represents the position and width of the field with the matching name in the packed struct.</p><p><br/></p><h5 id="classPkdStruct-values(name)"><em>values ( name )</em></h5><p>Returns an iterator that iterates over values stored in the same order as their fields appear in the struct</p><p><br/></p><h5 id="classPkdStruct-slices(name)"><em>slices ( name )</em></h5><p>Returns an iterator that iterates over slice of fields in the same order as their fields appear in the struct.</p><p><br/></p><h5 id="classPkdStruct-valueWidth(name)"><em>valueWidth ( name )</em></h5><p>Returns the width of the field or it's value with the matching name.  If <em>packType = &quot;struct&quot;</em> or &quot;<em>array</em>&quot;, and the width is not defined, then the width is computed by recursively adding widths of all fields and sub-fields in the packed structure.</p><p><br/></p><h5 id="classPkdStruct-setWidth(name,width,value)"><em>setWidth ( name, width, value )</em></h5><p>Creates / sets a new field or struct member with the input <em>name</em>, <em>width</em>, and optional <em>value</em>. <em>packType</em> is set to empty string. </p><p><br/></p><h5 id="classPkdStruct-setStruct(name,value)"><em>setStruct ( name, value )</em></h5><p>Creates / sets a new field or struct member with the input <em>name</em> and <em>value</em>. <em>packType</em> for this field is set to &quot;struct&quot;. If <em>unpack </em>= true, the value is replaced by an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156641/class+PkdStruct">class PkdStruct</a>.</p><p><br/></p><h5 id="classPkdStruct-setArray(name,value)"><em>setArray ( name, value )</em></h5><p>Creates / sets a new field or struct member with the input <em>name</em> and <em>value</em>. <em>packType</em> for this field is set to &quot;array&quot;. If <em>unpack</em> = true, the value is replaced by an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156285/class+PkdArray" data-linked-resource-id="16156285" data-linked-resource-version="3" data-linked-resource-type="page">class PkdArray</a>.</p><p><br/></p><h4 id="classPkdStruct-Defaultiterator">Default iterator </h4><p>When an instance of <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16156641/class+PkdStruct">class PkdStruct</a> is used in the context of for-of loop, it returns a default iterator that fetches an array with following values in each iteration:</p><p>[ name, value, slice ]</p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p>