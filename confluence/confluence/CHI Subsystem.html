<style type='text/css'>/*<![CDATA[*/
div.rbtoc1759725134565 {padding: 0px;}
div.rbtoc1759725134565 ul {list-style: disc;margin-left: 0px;padding-left: ;}
div.rbtoc1759725134565 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1759725134565'>
<ul class='toc-indentation'>
<li><a href='#CHISubsystem-Configurations'>Configurations</a></li>
<li><a href='#CHISubsystem-Environment'>Environment</a>
<ul class='toc-indentation'>
<li><a href='#CHISubsystem-DirectoryStructure'>Directory Structure</a></li>
<li><a href='#CHISubsystem-Tests'>Tests</a></li>
<li><a href='#CHISubsystem-Sequences'>Sequences</a></li>
<li><a href='#CHISubsystem-VirtualSequences'>Virtual Sequences</a></li>
<li><a href='#CHISubsystem-SequenceItems'>Sequence Items</a></li>
<li><a href='#CHISubsystem-VIPConfigurationObject'>VIP Configuration Object</a></li>
</ul>
</li>
<li><a href='#CHISubsystem-SequencesUsed'>Sequences Used</a></li>
<li><a href='#CHISubsystem-CreatingaTestcase'>Creating a Testcase</a></li>
<li><a href='#CHISubsystem-Regression'>Regression</a></li>
<li><a href='#CHISubsystem-FunctionalCoverage'>Functional Coverage</a></li>
<li><a href='#CHISubsystem-PendingWork'>Pending Work</a></li>
<li><a href='#CHISubsystem-Limitations'>Limitations</a></li>
</ul>
</div><h1 id="CHISubsystem-Configurations">Configurations</h1><p> </p><div class="table-wrap"><table data-layout="default" data-local-id="f6fe10da-6f40-4ffe-af94-8061ef64c815" class="confluenceTable"><colgroup><col style="width: 99.0px;"/><col style="width: 61.0px;"/><col style="width: 61.0px;"/><col style="width: 91.0px;"/><col style="width: 82.0px;"/><col style="width: 61.0px;"/><col style="width: 61.0px;"/><col style="width: 61.0px;"/><col style="width: 61.0px;"/><col style="width: 61.0px;"/><col style="width: 61.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p style="text-align: center;"><strong>config</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>CHI-B/CHI-E</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>ACE</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>AXI4 with/without proxy</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>ACE-Lite-E/ACE-lite</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>DCE</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>DII</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>DMI</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>nbr clock domain</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>width data</strong></p></th><th class="confluenceTh"><p style="text-align: center;"><strong>fnEnableQos</strong></p></th></tr><tr><td class="confluenceTd"><p style="text-align: center;">hw_cfg_42</p></td><td class="confluenceTd"><p style="text-align: center;">2/0</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">0</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">0</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">0</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">1</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">1</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">1</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">1</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">128</p></td><td data-highlight-colour="#ffffff" class="confluenceTd"><p style="text-align: center;">0</p></td></tr><tr><td class="confluenceTd"><p style="text-align: center;">hw_cfg_42_e</p></td><td class="confluenceTd"><p style="text-align: center;">0/2</p></td><td class="confluenceTd"><p style="text-align: center;">0</p></td><td class="confluenceTd"><p style="text-align: center;">0</p></td><td class="confluenceTd"><p style="text-align: center;">0</p></td><td class="confluenceTd"><p style="text-align: center;">1</p></td><td class="confluenceTd"><p style="text-align: center;">1</p></td><td class="confluenceTd"><p style="text-align: center;">1</p></td><td class="confluenceTd"><p style="text-align: center;">1</p></td><td class="confluenceTd"><p style="text-align: center;">128</p></td><td class="confluenceTd"><p style="text-align: center;">0</p></td></tr></tbody></table></div><h1 id="CHISubsystem-Environment">Environment</h1><h2 id="CHISubsystem-DirectoryStructure">Directory Structure</h2><p>dv/chi_aiu</p><p style="margin-left: 30.0px;">|_______ sub_sys</p><p style="margin-left: 60.0px;">|_______ runsim_testlist.json</p><p style="margin-left: 60.0px;">|_______ seq/</p><p style="margin-left: 60.0px;">|_______ vseq/</p><p style="margin-left: 60.0px;">|_______ tests/</p><h2 id="CHISubsystem-Tests">Tests</h2><ul><li><p><strong>chi_subsys_base_test </strong>is the fundamental test for all CHI subsystem stimulus.</p></li><li><p>This extends from <strong>concerto_base_test</strong></p></li><li><p>Does all the fundamental functionality required for the functioning of CHI, like booting, running link sequences etc</p></li><li><p>This also implements a virtual task called <strong>start_sequence </strong>which is responsible to inject the actual stimulus specific to the testcase and so any child sequences can overwrite this task to inject their own stimulus</p></li><li><p>Here is an example of <strong>chi_subsys_owo_test:</strong></p></li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">class chi_subsys_owo_test extends chi_subsys_base_test;
    `uvm_component_utils(chi_subsys_owo_test)

    function new(string name = &quot;chi_subsys_owo_test&quot;, uvm_component parent = null);
        super.new(name, parent);
    endfunction: new

    function void build_phase(uvm_phase phase);
        super.build_phase(phase);
    endfunction: build_phase

    task start_sequence();
        &lt;%for(let idx = 0; idx &lt; obj.nCHIs; idx++) { %&gt;
            chi_subsys_pkg::chi_subsys_owo_writes_seq      m_owo_seq&lt;%=idx%&gt;;
        &lt;%}%&gt;
        m_svt_chi_item.print();
        fork
            &lt;%for(let idx = 0; idx &lt; obj.nCHIs; idx++) { %&gt;
                begin
                    m_owo_seq&lt;%=idx%&gt; = chi_subsys_pkg::chi_subsys_owo_writes_seq::type_id::create(&quot;m_owo_seq&lt;%=idx%&gt;&quot;);
                    `uvm_info(get_name(), &quot;Starting m_owo_seq on RN&lt;%=idx%&gt;&quot;, UVM_NONE)
                    m_owo_seq&lt;%=idx%&gt;.start(concerto_svt_env.amba_system_env.chi_system[0].rn[&lt;%=idx%&gt;].rn_xact_seqr);
                    `uvm_info(get_name(), &quot;Done m_owo_seq on RN&lt;%=idx%&gt;&quot;, UVM_NONE)
                end
            &lt;%}%&gt;
        join
    endtask: start_sequence

    task run_phase(uvm_phase phase);
        super.run_phase(phase);
    endtask: run_phase

endclass: chi_subsys_owo_test</pre>
</div></div><h2 id="CHISubsystem-Sequences">Sequences</h2><ul><li><p>All sequences extend from the “<strong>svt_chi_rn_coherent_transaction_base_sequence</strong>“ which is coming from the Synopsys VIP</p></li><li><p>In the body of each sequence, we control the weights and other provided parameters from the sequence to generate stimulus that we are interested in.</p></li><li><p>The sequences start on the Virtual sequencer provided by the VIP: <strong>concerto_svt_env.amba_system_env.chi_system[0].rn[0].rn_xact_seqr</strong></p></li><li><p>Here is an example sequence used by OWO test:<br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">class chi_subsys_owo_writes_seq extends svt_chi_rn_coherent_transaction_base_sequence;
    `svt_xvm_object_utils(chi_subsys_owo_writes_seq)
    `svt_xvm_declare_p_sequencer(svt_chi_rn_transaction_sequencer)

    function new(string name = &quot;chi_subsys_owo_writes_seq&quot;);
        super.new(name);
        use_directed_addr = 0;
        use_directed_mem_attr = 0;
        use_directed_snp_attr = 0;
        use_directed_allocate_in_cache = 0;
        use_directed_data_size = 0;
        use_seq_order_type = 2;
    endfunction: new

    virtual task body();
        disable_all_weights();
        writeuniqueptl_wt                           = 1;
        writeuniquefull_wt                          = 1;
        writeuniquezero_wt                          = 1;
        writenosnpzero_wt                           = 1;
        super.body();
    endtask: body

endclass: chi_subsys_owo_writes_seq</pre>
</div></div></li></ul><h2 id="CHISubsystem-VirtualSequences">Virtual Sequences</h2><ul><li><p>We can start the above mentioned sequences directly in the testcase or if we want a more interesting scenario, like generating Streaming Writes along with a normal writes, we can combine those sequences in a virtual sequence and start the virtual sequence in the test instead.</p></li></ul><h2 id="CHISubsystem-SequenceItems">Sequence Items</h2><ul><li><p>The CHI Subsystem uses <strong>chi_subsys_item</strong> which extends from <strong>svt_chi_rn_transaction </strong>which is provided by the VIP.</p></li><li><p>The <strong>svt_chi_rn_transaction </strong>is the common transaction item that is used by all Synopsys Sequences and we extend from it to add any constraints that are not supported by Ncore</p></li><li><p>Example, the CHI spec allows the endianess to be both “Little“ and “Big“, so the VIP generates both of them. However, our Ncore only supports little endian format and thus this needs to be constrained. This can be added in the chi_subsys_item like so:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">constraint c_endianess_is_little {
    endian == svt_chi_rn_transaction::LITTLE_ENDIAN;
}</pre>
</div></div></li><li><p>It is important not to overwrite (or over constraint) any constraints that are coming by default from the Synopsys VIP unless they are absolutely necessary.</p></li></ul><h2 id="CHISubsystem-VIPConfigurationObject">VIP Configuration Object</h2><p>Uses cust_svt_amba_system_configuration file which is common across all testbenches/environments. This extends the svt_amba_system_configuration, provided by the VIP and we do few important configurations in this file, notably:</p><ul><li><p>Specify the number of RNs</p></li><li><p>Enable/Disable different types of transactions</p></li><li><p>Program the address region so that the VIP is aware of our address space, etc.<br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">cust_svt_amba_system_configuration extends svt_amba_system_configuration</pre>
</div></div></li></ul><h1 id="CHISubsystem-SequencesUsed">Sequences Used</h1><ul><li><p>svt_chi_rn_coherent_transaction_base_sequence</p><ul><li><p>This is the main sequence which drives all the required traffic on CHI</p></li><li><p>This has various attributes and weights on every transaction to make this sequence completely random or directed</p></li><li><p>This can also be used to send a directed address or let the VIP randomize the address based on the address regions we programmed in the configuration file</p></li></ul></li><li><p>Other sequences used:</p><ul><li><p>svt_chi_rn_transaction_random_sequence</p></li><li><p>svt_chi_link_service_activate_sequence</p></li><li><p>svt_chi_link_service_deactivate_sequence</p></li><li><p>chi_subsys_coherency_entry_seq </p></li></ul></li></ul><h1 id="CHISubsystem-CreatingaTestcase">Creating a Testcase</h1><ul><li><p>All tests have 3 parts</p><ul><li><p>Testcase - itself extending from chi_subsys_base_test</p></li><li><p>Virtual Sequence - that the test starts on a virtual sequencer from the VIP</p></li><li><p>Sequence - One or more sequences are wrapped inside the virtual sequence to create an interesting scenario that we are looking for.</p></li></ul></li><li><p>Since it is a hassle to add all the files to the respective dvPkg.json, sequence library, vseq library, fsys dvPkg.json for the testcase and also fsys testlist, a script is available to generate all the files with empty shells along with their additions to required file lists</p></li></ul><h1 id="CHISubsystem-Regression">Regression</h1><ul><li><p>&lt;Pending&gt; Regression will be run on various directed/random testcases that are added to the runsim_testlist.json</p></li></ul><h1 id="CHISubsystem-FunctionalCoverage">Functional Coverage</h1><ul><li><p>Functional coverage model from Synopsys is already enabled and once we start the regressions we can get the report and analyze the functional coverage</p></li></ul><h1 id="CHISubsystem-PendingWork">Pending Work</h1><ul><li><p>We need to properly configure the VIP using “create_sub_sys“ config to specify the number of HNs and SNs</p></li><li><p>Once we configure the VIP, we should enable various protocol checks that are currently disabled</p></li><li><p>See if we can reuse subsys infrastructure at fsys level - Need to brainstorm</p></li></ul><h1 id="CHISubsystem-Limitations">Limitations</h1><ul><li><p /></li></ul>