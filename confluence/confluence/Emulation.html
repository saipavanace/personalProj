<p><u><strong>Procedure to reproduce new chi_v2 for hw_cfg_23 on Questa/Veloce env:</strong></u></p><ol><li>Be on groc-6: ssh groc-6</li><li>Set up proper environment: <ol><li>source /engr/dev/tools/mentor/VeloceVirtuaLAB_v20.2/VirtuaLAB_v20.2/env.csh</li><li>(Older chi: deprecated) <s>source /engr/dev/tools/mentor/VeloceVirtuaLAB_v4.9.0/VirtuaLAB_v4.9.0/env.csh</s></li></ol></li><li>Copy Tony's working directory:<ol><li>cp -pr /scratch/ttran/Ncore3/hw_cfg_23/2020-07-20 &lt;your_working_directory&gt;</li><li>cd  &lt;your_working_directory&gt;</li></ol></li><li>To run simulation and dump waveform:<ol><li>make myall</li></ol></li><li>To view dumped waveform:<ol><li>make myvis</li></ol></li></ol><p><u><strong>TBX files of interest in working directory:</strong></u></p><ol><li>Testbench.sv</li><li>my_chi_traffic.sv</li><li>rnf_sequence.svh</li></ol><p><u><span class="legacy-color-text-blue1"><strong>Change path to RTL in the above procedure:</strong></span></u></p><p style="margin-left: 30.0px;">Ncore3 RTLs are pulled in via DUT_HOME = /scratch/ttran/Ncore3/hw_cfg_23/concerto2/output, a parameter in the working directory's Makefile.</p><p style="margin-left: 30.0px;">One can change this path to your own set of Ncore3's snapshot, if desired.</p><p><u><strong>Other notes of interest regarding Mentor's chi_v2 release:</strong></u></p><ol><li>Complete new chi_v2 API document: <a rel="nofollow">file:///engr/dev/tools/mentor/Veloce_Transactors_Library_v4.9.0.0/chi_v2/docs/sv_html/index.html</a></li><li>Mentor provides some basic chi_v2 examples under ${VELOCE_XACTOR_HOME} =/engr/dev/tools/mentor/Veloce_Transactors_Library_v4.9.0.0.<br/>For example, ${VELOCE_XACTOR_HOME}/chi_v2/examples/sysvlog/chi_read_write_transactions_512b</li></ol><p><br/></p><p>/* ----- * ----- * ----- */</p><p>(Tony: Legacy note. Keep it here for reference. Use latest Veloce's env* setup at the top of this page instead)</p><p>Veloce2 allows using the same environment to Simulate and Emulate a design.</p><p>The environment is setup sourcing the next script:</p><ul><li>For bash: /engr/dev/tools/mentor/VeloceVirtuaLAB/VirtuaLAB_v4.7.0/env.bash</li><li>For tcsh: /engr/dev/tools/mentor/VeloceVirtuaLAB/VirtuaLAB_v4.7.0/env.csh</li></ul><p>Note: This script reads the file env_v4.7.0.txt (maintained by IT).</p><p><br/></p><p>For Emulation mode, it <strong>HAS to be done from &quot;groc-6&quot;.</strong></p><p>Steps to Run Hello world:</p><ol><li>Connect in groc-6<ol><li>ssh groc-6</li></ol></li><li>Set the environment:<ol><li>source /engr/dev/tools/mentor/VeloceVirtuaLAB/VirtuaLAB_v4.7.0/env.bash</li></ol></li><li>Make a local copy of the &quot;hello_world&quot; example provided by Mentor:<ol><li>cp /engr/dev/tools/mentor/veloce-19.0.2/Veloce_v19.0.2/examples/hello_world &lt;your_working_directory&gt;</li></ol></li><li>Update the veloce.config file, by default the target platform is Strato.<br/><ol><li>Change line 2 of veloce.config file:<ol><li>it is Strato<br/>comp -platform Strato</li><li>it should be D2 (which means Veloce2)<br/>comp -platform D2</li></ol></li></ol></li><li>Type make all in your console<ol><li>make all</li></ol></li></ol><p><br/></p><p><span class="legacy-color-text-blue1">Steps to Run Ncore3 Config7 (sources attached to this Confluence page ncore3_CC_Emulation.tar.gz):</span></p><p style="margin-left: 30.0px;">1. Go to directory: /home/dbotero/workspace/VELOCE/20200219_ncore3_config7</p><p style="margin-left: 30.0px;">2. make all</p><p style="margin-left: 30.0px;">3. make myvis (Will launch visualizer, from here you can use a .do file such as <a class="external-link" href="http://wave_all_interfaces_2020.do/" rel="nofollow">Wave_all_interfaces_2020.do</a>)</p><p style="margin-left: 30.0px;">sources are in /home/dbotero/workspace/VELOCE/20200219_ncore3_config7</p><p style="margin-left: 30.0px;">The DUT was generated using the script &quot;run_maestro&quot; for config7, and it is located in DUT_HOME=/home/dbotero/workspace/NCORE3/ncore_config7_20200115/output</p><ul><li>ace_axi_v2.make: used for setting ACE and AXI VTLs.</li><li>chi.make: used for setting CHI VTL</li><li>From the makefile, comment/uncomment line 33 to run either in Simulation or Emulation mode</li></ul><p style="margin-left: 30.0px;"><a class="external-link" href="http://Testbench.sv" rel="nofollow">Testbench.sv</a>: HVL -</p><p style="margin-left: 60.0px;">Definintion and binding of all the interfaces. For CHI 8 virtual interfaces are defined (chi_master_vif[ID]). When using this vif, the different APIs can be called in a more compact way (chi_master_vif[chi_id].put_req_packet(_comms_semantic,0,req_pkt)).</p><p style="margin-left: 60.0px;">Definition of Tasks to access the ACE-lite and AXI ATUs./rnf</p><p style="margin-left: 90.0px;">84 `include &quot;rnf_sequence.svh&quot;<br/>85 `include &quot;<a class="external-link" href="http://my_chi_traffic.sv" rel="nofollow">my_chi_traffic.sv</a>&quot;</p><p style="margin-left: 90.0px;">153 acelite_master_read_thread();<br/>154 acelite_master_write_thread();<br/>155 axi_master_read_thread();<br/>156 <br/>157 chi_boot_from_tempo();<br/>158 chi_test_dmi_dii();<br/>159 chi_test_smc_hit();<br/>160 chi_test_snoop();</p><p style="margin-left: 30.0px;">hdl_top.sv: HDL -</p><p style="margin-left: 60.0px;">This file reuses interfaces defined by Ncore3 dv team. Instantiation of the DUT is done here (it is a copy paste of DV system testbench).</p><p style="margin-left: 60.0px;">As well here all the VTLs are instantiated and connected to the Ncore3 DUT by using the interfaces.</p><p style="margin-left: 60.0px;">For the Memories downstream, a synthetizable model of the memories is used. In the future the downstream memories should be replaced by AmbaAxiSoftMems provided by Mentor using FlexMem technology (VeloceAMBAAXISlaveMemorysoftmodel_ug.pdf).</p><p style="margin-left: 30.0px;">rnf_sequence.svh:</p><p style="margin-left: 60.0px;">Definition of tasks to drive the different CHI channels.</p><p style="margin-left: 60.0px;">These tasks use the VTL APIs defined in vtl_user_guide.pdf, such as put_req_packet ,put_data_packet, get_data_packet, get_snp_req_packet, get_rsp_packet, wait_for_CHI_CLK, activate_wr_txn, activate_rd_txn.</p><p style="margin-left: 60.0px;"><br/></p><p style="margin-left: 60.0px;">Two different kind of tasks are defined: Task driving Flit by Flit (which gives more Flexibility), and Tasks driving a full Write/Read or Read Requests.</p><p style="margin-left: 90.0px;">task chi_req_tempo: Drive request from CHI VTL to Ncore (Request Flit)</p><p style="margin-left: 120.0px;">(integer timestamp,bit [5:0] cmd,bit [43:0] addr,bit [2:0] Size,bit ExCompAck,bit Excl,bit [2:0] LPID,bit [1:0] SnpAttr,bit Device,bit EWA,bit Cacheable,bit Allocate,bit [1:0] PCrdType,bit [1:0] Order,bit Retry,bit LikelyShared,bit [1:0] NS,bit [2:0] ReturnTxnID,bit StashNIDValid,bit ReturnNID,bit [7:0] TxnID,bit [6:0] SrcID,bit [6:0] TgtID,bit [3:0] QoS);</p><p style="margin-left: 90.0px;">task chi_srsp_tempo: Drive response from CHI VTL to Ncore (Snoop Flit)</p><p style="margin-left: 120.0px;">(integer timestamp,bit [5:0] cmd,bit [2:0] rsp,bit [1:0] rsperr, bit [7:0] TxnID,bit [6:0] SrcID,bit [6:0] TgtID,bit [3:0] QoS, bit [1:0] ccid, bit [1:0] dataid);</p><p style="margin-left: 90.0px;">task chi_wdat_tempo: Drive Data Flit from CHI VTL to Ncore (Data Flit)</p><p style="margin-left: 120.0px;">(integer timestamp,bit [2:0] cmd, bit [3:0] rspname,bit [1:0] rsperr,bit [127:0] data,bit [15:0] BE,bit [7:0] DBID,bit [1:0] DataID,bit [7:0] TxnIDorg,bit [7:0] TxnID,bit [6:0] SrcID,bit [6:0] TgtID,bit [3:0] QoS);</p><p style="margin-left: 90.0px;">task chi_snp_tempo: Gets the Snoop response from Ncore.</p><p style="margin-left: 120.0px;">(integer timestamp,bit [5:0] cmd,bit [43:0] addr,bit NS,bit Unit,bit [7:0] FwdTxnID,bit [7:0] FwdNID,bit RetToSrc,bit DoNotGoToSD,bit [7:0] TxnID,bit [6:0] SrcID,bit [3:0] QoS);</p><p style="margin-left: 90.0px;"> task chi_rdat_tempo: Gets the Data response from Ncore.</p><p style="margin-left: 120.0px;">(integer timestamp,bit [2:0] cmd, bit [3:0] rspname,bit [1:0] rsperr,bit [127:0] data,bit [15:0] BE,bit [7:0] DBID,bit [1:0] DataID,bit [7:0] TxnID,bit [6:0] SrcID,bit [6:0] TgtID,bit [3:0] QoS, bit exp_crsp=1);</p><p style="margin-left: 90.0px;"><br/></p><p style="margin-left: 90.0px;">task chi_write_add_data: Task doing a complete Write using WriteNoSnoop</p><p style="margin-left: 120.0px;">(input bit [43:0] address, input bit [32:0] data_in);</p><p style="margin-left: 90.0px;">task chi_read: Task doing a complete Read using a ReadNoSnoop</p><p style="margin-left: 120.0px;">(input bit [43:0] address);</p><p style="margin-left: 30.0px;"><a class="external-link" href="http://my_chi_traffic.sv" rel="nofollow">my_chi_traffic.sv</a>:</p><p style="margin-left: 60.0px;">Task for Boot and other test cases</p><p style="margin-left: 90.0px;">chi_boot_from_tempo: Boot sequence generated with Tempo.</p><p style="margin-left: 90.0px;">chi_test_smc_hit: Test HIT on the SMC. Reads from two different CHI interfaces the same address.</p><p style="margin-left: 90.0px;">chi_test_snoop: Reads from two different CHI interfaces the same address. Second Read is returned in the Snoop Channel.</p><p style="margin-left: 90.0px;">chi_test_dmi_dii: From a CHI interface, access to all the Targets for the two defined memory regions.</p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p>