<p>ARL – Architectural Relaxed Limits</p><h1 id="NcoreARLSpecification-_Toc452733473RevisionHistory"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733473"><span class="confluence-anchor-link" id="_Toc452733473"></span></span>Revision History</h1><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><strong><em>Date</em></strong></p></td><td class="confluenceTd"><p><strong><em>Version</em></strong></p></td><td class="confluenceTd"><p><strong><em>Author</em></strong></p></td><td class="confluenceTd"><p><strong><em>Description</em></strong></p></td></tr><tr><td class="confluenceTd"><p>6/03/2016</p></td><td class="confluenceTd"><p>0.1</p></td><td class="confluenceTd"><p>SPotter</p></td><td class="confluenceTd"><p>Created.</p></td></tr><tr><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr></tbody></table></div><p> </p><h1 id="NcoreARLSpecification-_Toc452733474TableofContents"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733474"><span class="confluence-anchor-link" id="_Toc452733474"></span></span>Table of Contents</h1><p><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733473">Revision History </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733474">Table of Contents </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733475">References </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733476">1.0 Introduction </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733477">1.1 Current State </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733478">1.2 Proposed Changes </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733479">1.3 Nomenclature </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733480">2.0 User Experience </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733481">2.1 User Interface &amp; Design Flow </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733482">2.2 Validation </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733483">2.3 Scripting API </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733484">2.4 FlexNoC Interoperability </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733485">2.5 Hardware/Simulation/Performance Features </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733486">2.6 Output files / customer collateral </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733487">2.7 Backwards Compatibility / Migration </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733488">2.8 Customer Documentation Requirements </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733489">2.9 Exclusions </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733490">3.0 Implementation </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733491">3.1 Internal API Definition </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733492">3.2 Schema Changes </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733493">3.3 Implementation Phases </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733494">3.3.1 Phase 1: Debug Build and Schema Changes </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733495">3.3.2 Phase 2: Change Validation Routines </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733496">3.3.3 Phase 3: Find and Fix Hardwired Limits </a><br/> <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168551/Ncore+ARL+Specification#NcoreARLSpecification-_Toc452733497">4.0 Future Directions </a></p><h1 id="NcoreARLSpecification-_Toc452733475References"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733475"><span class="confluence-anchor-link" id="_Toc452733475"></span></span>References</h1><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><strong><em>#</em></strong></p></td><td class="confluenceTd"><p><strong><em>Description</em></strong></p></td></tr><tr><td class="confluenceTd"><p>1</p></td><td class="confluenceTd"><p>Concerto System Parameter Specification Release 1.5, Version 0.6</p></td></tr><tr><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr></tbody></table></div><h1 id="NcoreARLSpecification-_Toc4527334761.0Introduction"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733476"><span class="confluence-anchor-link" id="_Toc452733476"></span></span>1.0 Introduction</h1><h2 id="NcoreARLSpecification-_Toc4527334771.1CurrentState"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733477"><span class="confluence-anchor-link" id="_Toc452733477"></span></span>1.1 Current State</h2><p>The Ncore system has a number of parameters that are limited to a minimum and/or maximum value. In order to do experiments and validate whether we can safely relax some of those limits, there is currently a special build that conditionally resets some of the limits and has a mechanism in which RTL generation can be done even with all limits violated. The limit checking still happens and all limit violations are reported, but the limit violations are not blocking. Much of the limit checking is done using hard-coded values instead of using the values given in the schema description.</p><h2 id="NcoreARLSpecification-_Toc4527334781.2ProposedChanges"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733478"><span class="confluence-anchor-link" id="_Toc452733478"></span></span>1.2 Proposed Changes</h2><p>The ARL relaxed limits will be available only in the debug build, and only when a valid FlexLM <em>tappDev</em> license can be acquired. It may be enabled with a command-line option.If the command-line option is off, all limit validation will be done using the regular schema min/max values. If the command-line option is on, the schema min/max values will be updated with any applicable ARL overrides before validation. Any violation of the ARL limits will be reported.</p><h2 id="NcoreARLSpecification-_Toc4527334791.3Nomenclature"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733479"><span class="confluence-anchor-link" id="_Toc452733479"></span></span>1.3 Nomenclature</h2><p>Because this facility is to be available only in internal debug builds, everything in this specification that refers to 'User' or 'Customer' will mean the internal user of the debug build. There are no end-user visible changes from this project.<br/> All references to 'minimum' or 'maximum' also apply to 'minItems' and 'maxItems' for array schema entries.</p><h1 id="NcoreARLSpecification-_Toc4527334802.0UserExperience"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733480"><span class="confluence-anchor-link" id="_Toc452733480"></span></span>2.0 User Experience</h1><p>The user experience will change slightly. Instead of using a special 'dev' build, they will use the regular debug build with a command-line option specifying whether the ARL override values should be used or not. When using the ARL override values, they will no longer get the misleading warning/error messages for values that are outside the regular limits but within the ARL limits.</p><h2 id="NcoreARLSpecification-_Toc4527334812.1UserInterface&amp;DesignFlow"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733481"><span class="confluence-anchor-link" id="_Toc452733481"></span></span>2.1 User Interface &amp; Design Flow</h2><p>A single command-line option will select the set of limits to enforce.</p><h2 id="NcoreARLSpecification-_Toc4527334822.2Validation"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733482"><span class="confluence-anchor-link" id="_Toc452733482"></span></span>2.2 Validation</h2><p>Validation will use the same rules as normal, optionally with more relaxed limits.</p><h2 id="NcoreARLSpecification-_Toc4527334832.3ScriptingAPI"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733483"><span class="confluence-anchor-link" id="_Toc452733483"></span></span>2.3 Scripting API</h2><p>No special scripting considerations.</p><h2 id="NcoreARLSpecification-_Toc4527334842.4FlexNoCInteroperability"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733484"><span class="confluence-anchor-link" id="_Toc452733484"></span></span>2.4 FlexNoC Interoperability</h2><p>No special FlexNoC interoperability concerns.</p><h2 id="NcoreARLSpecification-_Toc4527334852.5Hardware/Simulation/PerformanceFeatures"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733485"><span class="confluence-anchor-link" id="_Toc452733485"></span></span>2.5 Hardware/Simulation/Performance Features</h2><p>If the design makes use of the increased limits, there may be consequences on the accuracy, stability, or performance of the system. That's exactly what we're trying to test with the relaxed limits.</p><h2 id="NcoreARLSpecification-_Toc4527334862.6Outputfiles/customercollateral"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733486"><span class="confluence-anchor-link" id="_Toc452733486"></span></span>2.6 Output files / customer collateral</h2><p>No new output files or collateral.</p><h2 id="NcoreARLSpecification-_Toc4527334872.7BackwardsCompatibility/Migration"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733487"><span class="confluence-anchor-link" id="_Toc452733487"></span></span>2.7 Backwards Compatibility / Migration</h2><p>No backwards compatibility or migration concerns.</p><h2 id="NcoreARLSpecification-_Toc4527334882.8CustomerDocumentationRequirements"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733488"><span class="confluence-anchor-link" id="_Toc452733488"></span></span>2.8 Customer Documentation Requirements</h2><p>The 'help' output will list the ARL command-line flag when output for the debug build.</p><h2 id="NcoreARLSpecification-_Toc4527334892.9Exclusions"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733489"><span class="confluence-anchor-link" id="_Toc452733489"></span></span>2.9 Exclusions</h2><p>This project will make available relaxed limits for values that are currently contained in the schema JavaScript files. There are a number of values that are currently hardwired constants spread throughout the code, but not present in the schema. Although those will need to be fixed, they are not part of the current project.<br/> For example, the CSPS (Ref #1) specifies that the Architectural Limit for wCacheLineOffset is min 6 / max 11. The current code sets a hardwired value of '6' for wCacheLineOffset in over 80 code locations.<br/> Jira issue <a class="external-link" href="https://arterisip.atlassian.net/browse/CONC-2168?filter=-2" rel="nofollow">CONC-2168</a> has been filed requesting the hardwired limits to be moved into the schema.<span class="confluence-anchor-link" id="NcoreARLSpecification-_GoBack"><span class="confluence-anchor-link" id="_GoBack"></span></span></p><h1 id="NcoreARLSpecification-_Toc4527334903.0Implementation"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733490"><span class="confluence-anchor-link" id="_Toc452733490"></span></span>3.0 Implementation</h1><h2 id="NcoreARLSpecification-_Toc4527334913.1InternalAPIDefinition"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733491"><span class="confluence-anchor-link" id="_Toc452733491"></span></span>3.1 Internal API Definition</h2><p>A single new routine will be added to the schema package. That routine will go through the 'conductor' schema and copy any ARL overrides found (see the next section) up to replace the regular settings.</p><h2 id="NcoreARLSpecification-_Toc4527334923.2SchemaChanges"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733492"><span class="confluence-anchor-link" id="_Toc452733492"></span></span>3.2 Schema Changes</h2><p>Each schema entry that has an ARL override will have an 'arl' attribute. The attribute will be an object describing the overrides to apply when ARL limits are selected. For example, the description of the <em>nProcs</em> parameter in the userSchema/ace.js file is as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">nProcs: {
    type: &#39;integer&#39;,
    title: &#39;Cores&#39;,
    minimum: 1,
    maximum: 8,
    enum: [1, 2, 3, 4, 5, 6, 7, 8],
    description: &#39;Number of cores&#39;
}, </pre>
</div></div><p><br class="atl-forced-newline"/> The description of <em>nProcs</em> would change to:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">nProcs: {
    type: &#39;integer&#39;,
    title: &#39;Cores&#39;,
    minimum: 1,
    maximum: 8,
    enum: [1, 2, 3, 4, 5, 6, 7, 8],
    description: &#39;Number of cores&#39;
    arl: {
        maximum: 16,
        enum: [1, 2, 3, 4, 5, 6, 7, 8, 16]
    }
},</pre>
</div></div><p><br class="atl-forced-newline"/> When conductor is run in ARL mode, validation would act as if the schema had said:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">nProcs: {
    type: &#39;integer&#39;,
    title: &#39;Cores&#39;,
    minimum: 1,
    maximum: 16,
    enum: [1, 2, 3, 4, 5, 6, 7, 8, 16],
    description: &#39;Number of cores&#39;
},</pre>
</div></div><h2 id="NcoreARLSpecification-_Toc4527334933.3ImplementationPhases"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733493"><span class="confluence-anchor-link" id="_Toc452733493"></span></span>3.3 Implementation Phases</h2><h3 id="NcoreARLSpecification-_Toc4527334943.3.1Phase1:DebugBuildandSchemaChanges"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733494"><span class="confluence-anchor-link" id="_Toc452733494"></span></span>3.3.1 Phase 1: Debug Build and Schema Changes</h3><p>The first part of this project is to</p><ol><li>Change the debug build to have a <em>--arl</em> flag.</li><li>Add ARL entries as appropriate to the existing schemas.</li><li>Add code to swap in the ARL values if the <em>--arl</em> flag is set.</li></ol><p>All of the above changes can be done with little risk of breaking anything. The <em>--arl</em> flag and conditional schema modification will be available only in a debug build. The <em>jsonschema</em> specification requires all implementations to ignore any attributes they do not recognize, so the extra 'arl' attribute will have no effect on the regular runs.<br/> There are 296 jsonschema entries that have minimum and/or maximum values set. Those entries will be matched up with the architectural specification and ARL attributes will be added where appropriate.<br/> Some of the existing schema values are inconsistent. For example, the <em>ace</em> schema values for <em>nAius</em> differ depending on whether you're using the values in <strong><em>user</em></strong><em>Schema/ace.js</em>, <strong><em>arch</em></strong><em>Schema/ace.js</em>, or <strong><em>achl</em></strong><em>Schema/ace.js</em>. Any <em>archSchema</em> or <em>achlSchema</em> entries for values that are fed forward from the corresponding values in the <em>userSchema</em> will be rewritten to make use of a common entry, so that there is no further opportunity for creating inconsistent limits.</p><h3 id="NcoreARLSpecification-_Toc4527334953.3.2Phase2:ChangeValidationRoutines"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733495"><span class="confluence-anchor-link" id="_Toc452733495"></span></span>3.3.2 Phase 2: Change Validation Routines</h3><p>All of the validation routines (e.g. the <em>customValidation.js</em> files) will be modified to use available schema provided values rather than their own copies of those values.</p><h3 id="NcoreARLSpecification-_Toc4527334963.3.3Phase3:FindandFixHardwiredLimits"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733496"><span class="confluence-anchor-link" id="_Toc452733496"></span></span>3.3.3 Phase 3: Find and Fix Hardwired Limits</h3><p>There are other places in the code doing limit checks against hardwired limits. For example, the <em>hw/rtl/top/src/top_params.js</em> file does not make use of the schema provided limit values. Those places will be either eliminated or modified to use the schema limits.</p><h1 id="NcoreARLSpecification-_Toc4527334974.0FutureDirections"><span class="confluence-anchor-link" id="NcoreARLSpecification-_Toc452733497"><span class="confluence-anchor-link" id="_Toc452733497"></span></span>4.0 Future Directions</h1><p>There is a project to eliminate the <em>archParams</em> step, so any changes to validation of <em>archParams</em> will go away. That project may also change the names of many of the schema parameters.</p><h2 id="NcoreARLSpecification-5.0UsageofARLmode">5.0 Usage of ARL mode</h2><p>Running in ARL mode requires:</p><ol><li>A development build of ncore (everything is preprocessed out for production builds).</li><li>The ‘dev’ feature license (our license server has this feature, but the customers won’t).</li><li>The environment ARTERIS_ARL_MODE must be set (to anything).</li></ol><p>Running in ARL mode should allow you to create designs up to the architectural limits described in the v1.5 CSPS, without warnings or errors (for valid designs).</p><p>Caveats:</p><p>A non-ARL run of conductor will refuse to read a design saved in ARL mode.</p><p>Migrations are not defined for ARL mode, so an ARL mode run will give an error message and exit if a migration is needed.  If you want to start with an old design, migrate it and save in non-ARL mode first.</p><p> </p>