<p><strong>References:</strong></p><p><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16160456/Arch+Ncore+3.4+Docs" data-linked-resource-id="16160456" data-linked-resource-version="110" data-linked-resource-type="page">Arch Ncore 3.4 Docs - Engineering - Confluence (atlassian.net)</a> Ncore SkidBuffer Architecture Specification revision 0.58</p><p /><p>The credit control registers in AIUs have power-on-reset values of 0 for CreditLimit, and therefore must be programmed appropriately in order for the AIUs to be able to send CMDreq messages to DCEs, DMIs, DIIs.</p><p>Similarly, the credit control registers in DCEs have power-on-reset values of 0 for CreditLimit, and therefore must be programmed appropriately in order for the DCEs to be able to send MRDreq messages to DMIs.</p><p /><p>Each DCE has a CMDreq Skid Buffer, and it is shared by all AIUs connected to the DCE.</p><p>Each DMI has a non-coherent CMDreq Skid Buffer, and it is shared by all AIUs connected to the DMI.</p><p>Each DII has a non-coherent CMDreq Skid Buffer, and it is shared by all AIUs connected to the DII.</p><p>Each DMI has a MRDreq Skid Buffer, and it is shared by all DCEs connected to the DMI.</p><p>Therefore it’s critical to know the size of a Skid Buffer, and to know all the sharers of the Skid Buffer, so that the Skid Buffer can be partitioned appropriately for all the sharers of the Skid Buffer. In other words, the sum of all the credit limits programmed in the Credit Control Registers in all the sharers of the Skid Buffer must be equal or less than the size of the Skid Buffer.</p><p /><p>NOTE: The Credit Limit for the credit control registers in AIUs have a special case for the power-on-reset value. The special case is when a Boot Region has been configured at an initiator. For this special case, the Credit Limit has a power-on-reset value of 2.</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/227704873/image-20230510-182122.png?api=v2"></span><p /><p><strong>Step 1</strong>: Read the GRBUNRRUCR register in the Global Register Block (GRB) to find out</p><p>the number of AIUs</p><p>the number of DCEs</p><p>the number of DMIs</p><p>the number of DIIs</p><p /><p><strong>Step 2</strong>: Read all the CCR registers in all the AIUs.</p><p>There are multiple CCR registers in each AIU:  CCR0 to CCR&lt;N-1&gt; where N=max( nDCEs, nDMIs, nDIIs ).</p><p>CCR0 contains the credit counter state and the credit limit for DII0, DMI0, DCE0.</p><p>CCR&lt;N-1&gt; contains the credit counter state and the credit limit for DII&lt;N-1&gt;, DMI&lt;N-1&gt;, DCE&lt;N-1&gt;</p><p>For an AIU[x]:</p><p>    AIU[x].CCR[0]=</p><p> {0xE0, DII0_{CounterState,CreditLimit}, DMI0_{CounterState,CreditLimit}, DCE0_{CounterState,CreditLimit};</p><p>    AIU[x].CCR[1]=</p><p> {0xE0, DII1_{CounterState,CreditLimit}, DMI1_{CounterState,CreditLimit}, DCE1_{CounterState,CreditLimit};</p><p>    …</p><p><strong>The 3-bit CounterState has the following encodings:</strong></p><p><strong>  3’b000 (Normal Operation)</strong></p><p><strong>  3’b001 (Empty)</strong></p><p><strong>  3’b010 (Negative)</strong></p><p><strong>  3’b100 (Full)</strong></p><p><strong>  3’b111 (No connection).</strong></p><p>If DII&lt;n&gt;_CounterState=3’b111 (No connection), that means that DII&lt;n&gt; is not connected to the AIU.</p><p>If DMI&lt;n&gt;_CounterState=3’b111 (No connection), that means that DMI&lt;n&gt; is not connected to the AIU.</p><p>If DCE&lt;n&gt;_CounterState=3’b111 (No connection), that means that DCE&lt;n&gt; is not connected to the AIU.</p><p /><p><strong>Step 3</strong>: Read the Command Skid Buffer Size Info Register (SBSIR) in every DCE, DMI, and DII.</p><p><strong>Step 4</strong>: Program the DCE/DMI/DII Credit Limit fields, that correspond to the DCE/DMI/DII CounterState fields equal 3’b001 (Empty) or 3’b001 (Normal Operation), in the CCR registers in every AIU such that:</p><p>-the DCE&lt;n&gt; Skid Buffer Size is partitioned evenly for all AIUs connected to DCE&lt;n&gt;.</p><p>-the DMI&lt;n&gt; Skid Buffer Size is partitioned evenly for all AIUs connected to DMI&lt;n&gt;.</p><p>-the DII&lt;n&gt; Skid Buffer Size is partitioned evenly for all AIUs connected to DII&lt;n&gt;.</p><p /><p /><p><strong>Step 5</strong>: Read all the CCR registers in all the DCEs.</p><p>There are multiple CCR registers in each DCE:  CCR0 to CCR&lt;N-1&gt; where N=max( nDMIs ).</p><p>CCR0 contains the credit counter state and the credit limit for DMI0.</p><p>CCR&lt;N-1&gt; contains the credit counter state and the credit limit for DMI&lt;N-1&gt;</p><p>DCE[x].CCR[0]={24’h0, DMI0_{CounterState,CreditLimit};</p><p>DCE[x].CCR[1]={24’h0, DMI1_{CounterState,CreditLimit};</p><p>…</p><p>The 3-bit CounterState has the same encoding as specified above.</p><p>If DMI&lt;n&gt;_CounterState=3’b111 (No connection), that means that DMI&lt;n&gt; is not connected to the DCE.</p><p /><p><strong>Step 6</strong>: Read the MRD Skid Buffer Size Info Register (MRDSBSIR) in every DCE.</p><p><strong>Step 7</strong>: Program the DMI CreditLimit fields, that correspond to the DMI CounterState fields equal 3’b001 (Empty) or 3’b001 (Normal Operation), in the CCR registers in every DCE such that:</p><p>-the DMI&lt;n&gt; MRD Skid Buffer Size is partitioned evenly for all DCEs that are connected to the DMI&lt;n&gt;.</p><p> </p><p /><p /><p /><p /><p /><p />