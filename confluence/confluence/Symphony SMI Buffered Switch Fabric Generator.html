<div class="wiki-content"><h1 id="SymphonySMIBufferedSwitchFabricGenerator-Instructions:">Instructions:</h1><p style="margin-left: 30.0px;">One for All Simulation - Regression Tool - &quot;runsim&quot;</p><p>Cd to the area to run the generator</p><pre>[jcodd@mondavi regress]$ cd hw/dv/tb/top/Sym_smi_fabric</pre><p>Run the script called create_fabric.js. If there's a error in it's command line options it gives directions:</p><pre>[jcodd@mondavi Sym_smi_fabric]$ ./create_fabric.js<br/>ERROR - /home/jcodd/work/regress/hw/dv/tb/top/Sym_smi_fabric/create_fabric.js:<br/>          Missing required options.<br/>          Missing required smiFile.<br/>          Missing required idFile.<br/>          Missing required packetSize.<br/>          Missing required wData.<br/>          Missing required pktStyle.<br/>          Missing required name.</pre><pre>/home/jcodd/work/regress/hw/dv/tb/top/Sym_smi_fabric/create_fabric.js Usage -smi smiFile_path -id idFile_path -ps packetSize -wd wData -p pktStyle &lt;-b0 b0 -b1 b1 -b2 b2 -np numPri -at arbType -lv lckOnVld&gt; -n name &lt;-h&gt;<br/>     smiFile_path: Required. Path to InterfaceSMI JSON parameters file.<br/>     idFile_path:  Required. Path to IDs array JSON parameters file.<br/>     packetSize:   Required. Packet size in bytes.<br/>     wData:        Required. Data width in bytes.<br/>     pktStyle:     Required. Packet Style of ATP link: parallel, serial or fixed.<br/>     b0:           Default 2. Depth of bufLayer0. Must be 1 or greater.<br/>     b1:           Default 0. Depth of bufLayer1. Must be 0 or greater.<br/>     b2:           Default 0. Depth of bufLayer2. Must be 0 or greater.<br/>     numPri:       Default 1. Number of Priority Levels<br/>     arbType:      Default arb_rr1. ArbType of all arbiters in switch<br/>     lckOnVld:     Default false. Lock on valid in switch<br/>     name:         Required. Name to prefix on all created stuff<br/>     -h:           Optional. Prints out this message<br/> <br/>     IDs array JSON format:<br/>         {<br/>           &quot;idWidth&quot;:    int // width of ID in bits<br/>           &quot;idSubWidth&quot;: int // width of ID subchannel in bits<br/>           &quot;idArray&quot;: [array of ints]  // Array of IDs to be used<br/>         }</pre><p> </p><div><span>There are example files for both </span>smiFile_path and idFile_path:</div><div style="margin-left: 30.0px;">example_smi.json<br/>example_id.json</div><p> </p><div>So a full run with all the bells and whistles:</div><pre>[jcodd@mondavi Sym_smi_fabric]$ ./create_fabric.js -smi example_smi.json -id example_id.json -ps 256 -wd 16 -p parallel -n fabric -lv false<br/>Route Width: 4<br/>Number of VCs: 4<br/>Bus width:               358<br/>max_beats:               16<br/>header_width:            205<br/>max_header_field_width:  136<br/>data_beat_multiplier:    8<br/>data_beat_width:         153<br/>min_data_beat_width_F:   19<br/>min_data_beat_width_C:   1<br/>min_data_width:          16<br/>number_data_beats:       16<br/>null bits to total bits: 0.536836592178771<br/>data bits to beat bits:  0.4273743016759777 </pre><p>This creates a bunch of JSON files all prepended with yellow_ and it creates a link packet def whose object name is yellow and sticks that in director cpr:</p><pre>[jcodd@mondavi Sym_smi_fabric]$ ls fabric_*<br/>fabric_0_0_smipkt.json  fabric_0_3_smipkt.json  fabric_1_2_smipkt.json  fabric_2_1_smipkt.json  fabric_atp.json      fabric_smidepkt.json<br/>fabric_0_1_smipkt.json  fabric_1_0_smipkt.json  fabric_1_3_smipkt.json  fabric_2_2_smipkt.json  fabric_basePkt.json  fabric_smi.json<br/>fabric_0_2_smipkt.json  fabric_1_1_smipkt.json  fabric_2_0_smipkt.json  fabric_2_3_smipkt.json  fabric_fabric.json   fabric_sw.json<br/>[jcodd@mondavi Sym_smi_fabric]$ ls cpr<br/>fabric.packet.cpr<br/> </pre><p>There's a sh script called run_fabric.sh that will do a TACHL compile:</p><pre>./run_fabric $1 $2 $3<br/>  $1 = JSON file to build<br/>  $2 = top TACHL file for $1<br/>  $3 = output directory to dump verilog into</pre><pre>[jcodd@mondavi Sym_smi_fabric]$ ./run_fabric fabric_fabric.json gen_wrapper.tachl fabric</pre><p><span>Go into the fabric directory and run verilator on it to make sure things are good to try:</span></p><pre>[jcodd@mondavi Sym_smi_fabric]$ cd fabric<br/>[jcodd@mondavi fabric]$ verilator --lint-only gen_wrapper.v -I. --error-limit 0 -Wall -Wno-UNUSED -Werror-UNDRIVEN                                                                           </pre></div>