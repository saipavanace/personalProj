<h2 id="HW-CTFcreateConfigAddressMap-Path">Path</h2><p>hw-lib/js/lib_utils.js</p><h2 id="HW-CTFcreateConfigAddressMap-Description">Description</h2><p>This is a factory function that allows creation of an address map by specifying the individual sizes of each region in the map. An address-map specifies which address ranges in an address-space are mapped to which blocks or address-regions and the function returns an abstract representation of the same. Every block in an address space is identified by a block ID - which can be either a string or a number. </p><p>An address map can be created by specifying just two parameters:</p><ol><li><em>fullSize</em>: Total size of the address-space as a power of 2. In other words, the number of address bits required to address the entire address-space.</li><li><em>sizes</em>: Array of positive integers. Array of address region sizes in powers of 2.</li></ol><p>In addition, optional parameters can be specified, through a third optional parameter, <em>options</em> which is expected to be an object with one or more of the following fields:</p><ol><li><em>offsets</em>: Array of numbers that are either zero or positive. If not specified, these are computed internally by accumulating sizes such that all address-ranges are as closely packed as possible.</li><li><em>blockIds</em>: Array of IDs (number or string) for each block in the address map. if not specified, this parameter defaults to range of numbers from 1 to numBlock-1, where numBlocks = sizes.length.</li></ol><h2 id="HW-CTFcreateConfigAddressMap-Usage">Usage</h2><p>const addrMapInst = createConfigAddressMap ( <em>fullSize</em>, <em>sizes</em>, <em>options</em> );</p><h4 id="HW-CTFcreateConfigAddressMap-ReturnValue">Return Value</h4><p>An object with following properties:</p><h5 id="HW-CTFcreateConfigAddressMap-Data">Data</h5><ol><li>fullSize: Same definition as the argument, <em>fullSize</em>.</li></ol><h5 id="HW-CTFcreateConfigAddressMap-Behavior/Functions">Behavior / Functions</h5><h6 id="HW-CTFcreateConfigAddressMap-baseAddresses(width=12,radix=16)ReturnsanarrayofbaseAddressesofeveryblockintheaddress-spaceinthesameorderasreturnvalueofblockIds().ThebaseAddressesarestringscontainingVerilogconstantliterals.Theoptionalparamswidthandradixsetth"><strong>baseAddresses ( width=12, radix=16 )</strong><br/>Returns an array of baseAddresses of every block in the address-space in the same order as return value of blockIds( ). The baseAddresses are strings containing Verilog constant literals. The optional params width and radix set the width and radix of the Verilog constants.</h6><p><br/></p><h6 id="HW-CTFcreateConfigAddressMap-baseMasks(width=12,radix=16)ReturnsanarrayofbaseMasksofeveryblockintheaddress-spaceinthesameorderasreturnvalueofblockIds().ThebaseMasksarestringscontainingVerilogconstantliterals.Theoptionalparamswidthandradixsetthewidthandrad"><strong>baseMasks ( width=12, radix=16 )</strong><br/>Returns an array of baseMasks of every block in the address-space in the same order as return value of blockIds( ). The baseMasks are strings containing Verilog constant literals. The optional  params width and radix set the width and radix of the Verilog constants.</h6><p><br/></p><h6 id="HW-CTFcreateConfigAddressMap-size(id)Returnssize(asapowerof2)fortheblockwithspecifiedID.Type:number."><strong>size ( id )</strong><br/>Returns size (as a power of 2) for the block with specified ID. Type: number.</h6><p><br/></p><h6 id="HW-CTFcreateConfigAddressMap-blockIds()ReturnsanarrayofIDsforeveryblockintheaddressmap.TheycanbeeitherstringsornumbersdependingonwhatwassetthroughtheblockIdsparameterwhencallingthecreateConfigAddressMap()function."><strong>blockIds ( )</strong><br/>Returns an array of IDs for every block in the address map. They can be either strings or numbers depending on what was set through the blockIds parameter when calling the createConfigAddressMap( ) function.</h6><p><br/></p><h6 id="HW-CTFcreateConfigAddressMap-sizes()Returnsanarrayofsizes(asapowerof2)inthesameorderasthereturnvalueofblockIds().Type:arrayofnumbers."><strong>sizes ( )</strong><br/>Returns an array of sizes (as a power of 2) in the same order as the return value of blockIds( ). Type: array of numbers.</h6><p><br/></p><h6 id="HW-CTFcreateConfigAddressMap-mergeCSR(csrMap)ReturnsasingleCSRobjectstitchedtogetherfromalltheindividualobjectsinthecsrMapparameter.StitchingheremeanstheaddressblocksofindividualCSRsareconcatenatedinthesamespaceBlockarray.ThecsrMapisanassociativearrayorob"><strong>mergeCSR (  csrMap )</strong><br/>Returns a single CSR object stitched together from all the individual <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16154965/csr" data-linked-resource-id="16154965" data-linked-resource-version="35" data-linked-resource-type="page">csr</a> objects in the <em>csrMap</em> parameter. Stitching here means the address blocks of individual CSRs are concatenated in the same spaceBlock array. The <em>csrMap</em> is an associative array or object with blockIds as keys and CSR objects as values.</h6><p><br/></p><h2 id="HW-CTFcreateConfigAddressMap-UsagewithConfig-Address-Space">Usage with Config-Address-Space</h2><p>The address-map object can be used to generate parameters for <a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16169247/apb_demux" data-linked-resource-id="16169247" data-linked-resource-version="7" data-linked-resource-type="page">apb_demux</a>, to merge multiple CSRs into a single CSR (<a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16154965/csr" data-linked-resource-id="16154965" data-linked-resource-version="35" data-linked-resource-type="page">csr</a>), and to determine the address-space size of each sub-block within a component. Using the address-map ensures that the order in which the blocks are arranged in the config-address-space is consistent with</p><ol><li>The order in which APB master interfaces are connected to the sub-blocks (blocks that receive the APB).</li><li>The order in which CSRs of the sub-blocks are merged to create a single CSR.</li></ol><p>Because of this the assumption of the order of blocks in the address-space and the conditions of when they exist can be defined in only one part of the code, avoiding code duplication.</p><h2 id="HW-CTFcreateConfigAddressMap-Examples">Examples</h2><p>const blockIds              = [ &quot;ATUI0&quot;, &quot;ATUT0&quot;, &quot;ATUT1&quot;, &quot;PROBE&quot;, &quot;STATS&quot; ];<br/>const sizes                    = [ 12, 12, 12, 12, 12 ];    // Sets size of each-address block to 4K<br/>const addrMap            = createConfigAddressMap(15, sizes, { blockIds });  // Sets size of each address-block to 4K.</p><p>addrMap.baseMasks( 15 );   // Returns [ &quot;15'h7000&quot;, &quot;15'h7000&quot;, 15'h7000&quot;, &quot;15'h7000&quot;, &quot;15'h7000&quot; ]<br/>const atut1Interface     = { name: &quot;apb_atut1_&quot;,  params: { wAddr: addrMap.size(&quot;ATUT1&quot;), wData: 32, wPslvErr: 1 }, &quot;interface&quot;: &quot;InterfaceAPB&quot; };  // Create an APB interface with address-width based on its block-size</p><p><br/></p><p>OR<br/>const offsets                 = [ 0, 0x2000, 0x3000 ];<br/>const sizes                    = [ 11, 10, 10 ];<br/>const addrMap             = createConfigAddressMap( 12, sizes,  { offsets }); // Sets offsets at 0, 2048, and 3072.</p><p>addrMap.baseAddresses( )   // Returns [ &quot;12'h0&quot;, &quot;12'h2000&quot;, &quot;12'h3000&quot; ]<br/>addrMap.baseMasks( )         // Returns [ &quot;12'h800&quot;, &quot;12'hc00&quot;, &quot;12'hc00&quot;  ];<br/>addrMap.blockIds( )             // Returns [ 0, 1, 2 ]</p><p><br/></p><p><br/></p>