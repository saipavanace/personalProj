<p class="auto-cursor-target"><strong>History:</strong></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Date</th><th class="confluenceTh">Comments</th><th class="confluenceTh">Editor</th></tr><tr><td class="confluenceTd"><div class="content-wrapper"><p><time datetime="2021-01-25" class="date-past">25 Jan 2021</time> </p></div></td><td class="confluenceTd"><ul><li>Initial Testplan</li></ul></td><td class="confluenceTd">Bill Chandler</td></tr><tr><td class="confluenceTd"><div class="content-wrapper"><p><time datetime="2021-01-26" class="date-past">26 Jan 2021</time> </p></div></td><td class="confluenceTd"><ul><li>Testplan review</li></ul></td><td class="confluenceTd">Bill Chandler</td></tr></tbody></table></div><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh"><br/></th><th class="confluenceTh">Reference</th><th class="confluenceTh">Comments</th></tr><tr><td class="confluenceTd">1</td><td class="confluenceTd"><a href="https://arterisip.atlassian.net/wiki/spaces/ENGR/pages/16168294/OBSOLETE-DELETE+HW-SYM+sym_firewall_adapter" data-linked-resource-id="16168294" data-linked-resource-version="33" data-linked-resource-type="page">OBSOLETE-DELETE HW-SYM sym_firewall_adapter</a></td><td class="confluenceTd">Design document</td></tr><tr><td colspan="1" class="confluenceTd">2</td><td colspan="1" class="confluenceTd"><p class="with-breadcrumbs"><a class="external-link" href="https://confluence.arteris.com/pages/viewpage.action?pageId=12353558" rel="nofollow">Firewall test plan - transport level</a></p></td><td colspan="1" class="confluenceTd"><p>Unit level test plan</p></td></tr><tr><td colspan="1" class="confluenceTd">3</td><td colspan="1" class="confluenceTd"><a class="external-link" href="https://confluence.arteris.com/display/ENGR/Native+layer+Errors+and+Interrupts+Test+Plan" rel="nofollow">Errors and interrupt test plan</a></td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div><p><br/></p><h1 id="FirewallNativeLayerTestPlan:-Design"><strong>Design</strong></h1><p>For R1, firewall will be used in the request paths of ATUi and ATUt for AXI and APB.</p><p>The firewall is capable of poisoning certain ATP packets and causing an interrupt.</p><p>A firewall adapter may have the following inputs and output interfaces:</p><ul><li>atpSlaveInterface input</li><li>apbInterface input</li><li>genericIoInterface input (optional)</li><li>atpMasterInterface output</li><li>interruptInterface output (optional)</li></ul><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.arteris.com/download/attachments/12353558/firewall%20RTL.png?version=1&amp;modificationDate=1564746785984&amp;api=v2" data-image-src="https://confluence.arteris.com/download/attachments/12353558/firewall%20RTL.png?version=1&amp;modificationDate=1564746785984&amp;api=v2" loading="lazy"></span></p><p><strong style="font-size: 16.0px;letter-spacing: -0.006em;">Below are things that can vary in R1.</strong></p><p>Where a firewall adapter may be located.</p><ul><li>atui_axi request path</li><li>atui_apb request path</li><li>atut_axi request path</li><li>atut_apb request path</li><li><span style="letter-spacing: 0.0px;">in front of ATUi to affect config accesses</span></li><li><span style="letter-spacing: 0.0px;">between switches</span></li><li><span style="letter-spacing: 0.0px;">in response path (allows customers to add their own PMON-like code here), would have interrupts, would never cause errors</span></li></ul><p>Details about a particular firewall adapter.</p><ul><li>interruptInterface is NOT optional for R1. Only one bit wide.</li><li>genericIoInterface is NOT optional for R1</li><li>protectionInterface is NOT available for R1</li><li>simplePipe parameter (false for R1)</li><li>addStage parameter (true/false)</li><li>UDV (customizable user-defined verilog code), including udvLatency (recommended values 0 to 4)</li></ul><h1 id="FirewallNativeLayerTestPlan:-TestingStrategy"><strong>Testing Strategy</strong></h1><p>1) Make sure that the firewall functionality works as intended.</p><ul><li>Create several specific configs with firewall enabled but little general config randomization. Write <strong>directed tests</strong> to test firewall functionality, including packet poisoning and interrupts.</li><li>There will directed tests to cover these two scenarios:<ul><li>Trustzone. </li><li>Config space protection.</li></ul></li></ul><p>2. Make sure that the firewall does not break normal functionality.</p><ul><li>Create random configs with firewall enabled in <strong>pass-through</strong> situation where nothing will be poisoned and no interrupts are generated. Send random stimulus (reuse general-purpose AXI and APB tests) and make sure that having a benign firewall adapter in the path does not cause those tests to fail.</li></ul><h1 id="FirewallNativeLayerTestPlan:-Configurationrequirements"><strong>Configuration requirements</strong></h1><p>Create a set configurations that insert a firewall adapter in the following situations. Not each configuration needs to meet each of these requirements, just the whole set.</p><ul><li>atui_axi request path</li><li>atui_apb request path</li><li>atut_axi request path</li><li>atut_apb request path</li><li><span>config network request path (?)</span></li></ul><p>Most specific configurations will have the following:</p><ul><li>interruptInterface exists</li><li>genericIoInterface exists (?)</li><li>protectionInterface exists (?)</li><li>simplePipe parameter randomized</li><li>addStage parameter randomized</li><li>UDV for either the Trustzone scenario or config space protection.</li></ul><p>One configuration will have the following:</p><ul><li>interruptInterface does not exist</li><li>genericIoInterface does not exist</li><li>protectionInterface does not exist</li></ul><p>TBD: add information about Bronze/Silver/Gold configs and firewall.</p><p>Bronze Phase 3 puts a firewall adapter in the config network request path (?) and UDV to poison or not by packet ID.</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh"><br/></th><th class="confluenceTh">config name</th><th class="confluenceTh">sockets</th><th colspan="1" class="confluenceTh">firewall adapters</th><th colspan="1" class="confluenceTh">UDV</th><th colspan="1" class="confluenceTh">CSR</th><th colspan="1" class="confluenceTh">firewall interrupts</th><th colspan="1" class="confluenceTh">randomized</th><th colspan="1" class="confluenceTh">other / notes</th></tr><tr><td class="confluenceTd">1</td><td class="confluenceTd">maestro_4x4_firewall_<strong>axi_axi_pass_through</strong></td><td class="confluenceTd">4 AXI initiators, 4 AXI targets</td><td colspan="1" class="confluenceTd">On all sockets</td><td colspan="1" class="confluenceTd">pass_through</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">TBD</td><td colspan="1" class="confluenceTd">socket address/data widths</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">2</td><td class="confluenceTd">maestro_4x4_firewall_<strong>axi_axi_poison_all</strong></td><td class="confluenceTd">4 AXI initiators, 4 AXI targets</td><td class="confluenceTd">On all sockets</td><td class="confluenceTd">poison_all</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">TBD</td><td class="confluenceTd">socket address/data widths</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">3</td><td class="confluenceTd">maestro_4x4_firewall_<strong>apb_apb_pass_through</strong></td><td class="confluenceTd">4 APB initiators, 4 APB targets</td><td class="confluenceTd">On all sockets</td><td class="confluenceTd">pass_through</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">TBD</td><td class="confluenceTd">socket address/data widths</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">4</td><td class="confluenceTd">maestro_4x4_firewall_<strong>apb_apb_poison_all</strong></td><td class="confluenceTd">4 APB initiators, 4 APB targets</td><td class="confluenceTd">On all sockets</td><td class="confluenceTd">poison_all</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">TBD</td><td class="confluenceTd">socket address/data widths</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">5</td><td class="confluenceTd">maestro_4x4_firewall_axi_axi_init_only</td><td class="confluenceTd">4 AXI initiators, 4 AXI targets</td><td class="confluenceTd"><strong>Only on 4 AXI initiators</strong></td><td class="confluenceTd">trust_zone</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">yes</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">6</td><td class="confluenceTd">maestro_4x4_firewall_axi_axi_target_only</td><td class="confluenceTd">4 AXI initiators, 4 AXI targets</td><td class="confluenceTd"><strong>Only on 4 AXI targets</strong></td><td class="confluenceTd">trust_zone</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">yes</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">7</td><td class="confluenceTd">maestro_4x4_firewall_apb_apb_init_only</td><td class="confluenceTd">4 APB initiators, 4 APB targets</td><td class="confluenceTd"><strong>Only on 4 APB initiators</strong></td><td class="confluenceTd">trust_zone</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">yes</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">8</td><td class="confluenceTd">maestro_4x4_firewall_apb_apb_target_only</td><td class="confluenceTd">4 APB initiators, 4 APB targets</td><td class="confluenceTd"><strong>Only on 4 APB targets</strong></td><td class="confluenceTd">trust_zone</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">yes</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">9</td><td class="confluenceTd">maestro_4x4_firewall_axi_axi_config_space</td><td class="confluenceTd">4 AXI initiators, 4 AXI targets</td><td class="confluenceTd">config network</td><td class="confluenceTd"><strong>config_space_protection</strong></td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">yes</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">10</td><td class="confluenceTd">maestro_4x4_firewall_<strong>mixed</strong>_trustzone</td><td class="confluenceTd">4x4 Mixed AXI and APB initiators and targets </td><td class="confluenceTd">On some sockets, not all</td><td class="confluenceTd">trust_zone</td><td colspan="1" class="confluenceTd">CSR</td><td colspan="1" class="confluenceTd">some</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr></tbody></table></div><h1 id="FirewallNativeLayerTestPlan:-Stimulus"><strong>Stimulus</strong></h1><p>Stimulus steps:</p><ul><li>Unmask the specific firewall interrupt.</li><li>Send stimulus that will pass through the firewall unpoisoned. (optional)</li><li>Send stimulus that will be poisoned  by the firewall.</li><li>An interrupt should occur and the interrupt service routine should handle it (reuse from Errors and Interrupts Test Plan)</li><li>Repeat to show that the firewall can repeat its functionality.</li></ul><p>Checking:</p><ul><li>Error if an interrupt does not occur within a reasonable time from when it is expected.</li><li>Error if an interrupt occurs at any time before or after the particular window where it should occur.</li></ul><p>Long delay test will test the firewall with long response delays.</p><h1 id="FirewallNativeLayerTestPlan:-Scenarios"><strong>Scenarios</strong></h1><p><strong>Trustzone</strong></p><ul><li>The firewall adapter </li><li>This will require a UDV that uses ATP address bits and prot(1) from atpSlaveInterface and contains eight address space registers.</li><li>Can be used on AXI or APB request links.</li><li>User will provide secure address range using CSR register, on/off, and error logging.<ul><li>Sample code will have four address regions.</li><li>Accessible address only by the transaction with AxPROT[1] ==0</li><li>When the transaction arrives, and if the transaction tried to access a secure region with AxPROT[1] == 1 fields, it generates poison bit and send interrupt.</li><li>Target ATU will see the poison bit and generate Error response.</li><li>Update register to indicates trustzone violation.</li></ul></li></ul><p><strong>Config space protection</strong></p><ul><li>The firewall adapter will poison packets coming from some IDs and not-poison packets coming from other IDs. Uses atpSlaveInterface ID.</li><li>This will require a UDV that uses ATP packet ID.</li></ul><p>There are other ATP fields that can be used by the firewall UDV, but those will not be tested in R1.</p><p><strong>Pass-through mode</strong></p><ul><li>The firewall adapter will be configured to pass through everything and poison nothing. Useful to make sure that the firewall adapter does not interfere with normal behavior.</li></ul><p><strong>Poison all mode</strong></p><ul><li>The firewall adapter will be configured to poison everything. This mode may be used to be a stressful situation for bug hunting.</li></ul><p>Note that all UDVs except pass-through will need a register to clear the interrupt.</p><h1 id="FirewallNativeLayerTestPlan:-Crosseswithotherfeatures"><strong>Crosses with other features</strong></h1><p>Splitting </p><p>Buffered Writes. The buffered write response can arrive before the firewall interrupt response.</p><p><br/></p><h3 id="FirewallNativeLayerTestPlan:-TestingdeferreduntilafterR1."><strong>Testing deferred until after R1.</strong></h3><p>Firewall adapters inserted in the response path.</p><p>Firewall connected to PMON.</p><h3 id="FirewallNativeLayerTestPlan:-Questions."><strong>Questions.</strong></h3><p>The firewall parameter simplePipe mentions depth. Where is depth described?</p><p>Is addState simply a function of sym_pipe? </p><p>&quot;simplePipe&quot; : true or false, // If depth is greater than one, takes &quot;depth&quot; clocks to propagate from input to output if yes.<br/>&quot;addStage&quot; : true or false, // add an additional stage to sym_pipe in the sym_atp_depack.</p><p>Does Maestro control both parameters or can either of them be randomized independently.</p><p>Unit testplan mentioned firewall disable (register bit?). Where is this?</p><p>How do we get the trustzone-style UDV with four registers as requested by Junie?</p><h3 id="FirewallNativeLayerTestPlan:-Reviewnotes:"><strong>Review notes:</strong></h3><p>(notes from 1/26/2021 review)</p><p>TBD</p>