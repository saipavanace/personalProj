<p>The new format will be an array of objects which describes how bits are packed into a packet where each object in the array is formatted as follows:</p><pre>{</pre><pre>  &quot;type&quot; : string</pre><pre>  &quot;name&quot; : string</pre><pre>  &quot;width&quot; : int</pre><pre>  &quot;minWidth: int</pre><pre>  &quot;mf&quot; : string </pre><pre>  &quot;payload&quot; : int</pre><pre>}</pre><h2 id="HW-SYMpacketDesc-type:">type:</h2><p>Type describes the field type the header is:</p><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><th class="confluenceTh">Type</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">H</td><td class="confluenceTd">Header field</td></tr><tr><td class="confluenceTd">N</td><td class="confluenceTd">Null field</td></tr><tr><td class="confluenceTd">F</td><td class="confluenceTd">Fixed field</td></tr><tr><td class="confluenceTd">C</td><td class="confluenceTd">Clone field</td></tr></tbody></table></div><h2 id="HW-SYMpacketDesc-name:">name:</h2><p>Name is the name of the field, but there are naming conventions to aid in reading and querying structure:</p><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><th class="confluenceTh">fieldName</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">begins with H_</td><td class="confluenceTd">This is a header field.</td></tr><tr><td class="confluenceTd">begins with NU</td><td class="confluenceTd">This is a NULL field.</td></tr><tr><td colspan="1" class="confluenceTd">begins with F_</td><td colspan="1" class="confluenceTd">This is a Fixed field.</td></tr><tr><td colspan="1" class="confluenceTd">begins with C_</td><td colspan="1" class="confluenceTd">This is a Cloned field.</td></tr></tbody></table></div><p>The base packet format is link width independent and probably will never have NULL fields. Link packet formats indicate how a base packet format is mapped onto a link knowing the link width and whether the link is HP(Header Penalty)=0 or 1.</p><p>A header field is never broken up.</p><p>A NULL field is used to move fields around so they fit well on the link based on its width. For example, a NULL field can be added to prevent a field from spanning beats on a link.</p><p>A fixed field can be broken up, but the second fieldData indicates the minimum size it can be broken into. And example of this would be Data or Byte Enables.</p><p>A cloned field can be broken up, but it is always the same width, so when it's being broken up, it's cloned, and when it's being collapsed it is merged. To help with merging, there is a merging function.</p><h2 id="HW-SYMpacketDesc-width:">width:</h2><p>Indicates the width of the field in the packet. Used for all types.</p><h2 id="HW-SYMpacketDesc-minWidth:">minWidth:</h2><p>Only used by a fixed field. When a width is being changed, indicates the boundaries that the filed can be broken at. Must be evenly dividable into width. For example, if type = F, width = 32, the acceptable values for minWidth are 32, 16, 8, 4, 2,1. In addition, all fixed fields in a payload definition must have a minField that divides the same number of times into width. For example if you had type = F, name = F_data, width = 32, minWidth = 8 and you had another F field width/minWidth must equal 4 because 32/8 = 4. So you could have name = F_be, width = 4,  minWidth = 1.</p><h2 id="HW-SYMpacketDesc-mf:">mf:</h2><p>Only used by a clone field. Clone fields don't change widths when width conversions are applied. When the number of beats are expanded, then the value in the field is cloned to the expanded beat. But when the number of beats collapse, there needs to a description of how multiple clone fields are combined to form a single field. This is called the Merging Function (mf). It's a string with the following acceptable values:</p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><th class="confluenceTh">merging Function</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">OR</td><td class="confluenceTd">When the fields are merged it is a bitwise OR. Field is copied when expanded.</td></tr><tr><td class="confluenceTd">AND</td><td class="confluenceTd">When the fields are merged it is a bitwise AND. Field is copied when expanded.</td></tr><tr><td class="confluenceTd">FIRST</td><td class="confluenceTd">When the fields are merged or expanded, the first beat maintains the value and following beats are zeroed out</td></tr><tr><td colspan="1" class="confluenceTd">LAST</td><td colspan="1" class="confluenceTd">When the fields are merged or expanded, the last beat maintains the value and the leading beats are zeroed out</td></tr><tr><td colspan="1" class="confluenceTd">DUM</td><td colspan="1" class="confluenceTd">When the fields are merged or expanded, if the last beat contains no data, make a 1, else a 0</td></tr></tbody></table></div><h1 id="HW-SYMpacketDesc-payload:">payload:</h1><p>Packets can have multiple payloads. This is indicated by the number put on payload for fixed and cloned field types. Payload is 0 for header fields. First data payload starts with 1.</p><h1 id="HW-SYMpacketDesc-FieldNamingConventions">Field Naming Conventions</h1><p>When a fixed field gets broken up, an _number will be added. The order in the packet will be _0, _1, ... _n.</p><p>For null fields, the convention will be to number them accordingly. So the first null field will be NULL_0, the second NULL_1 and so on.</p><h1 id="HW-SYMpacketDesc-ATPlinkparameterExample:">ATP link parameter Example:</h1><p>&quot;pktHP&quot; : header penalty, HP=0 or header parallel, else HP = 1 or header serial<br/>&quot;pktFormat&quot; : packet format for this link</p><p> Example of a Header Parallel link packet -</p><p>&quot;pktHP&quot; : 0,<br/>&quot;pktFormat&quot; :[{&quot;type&quot; : &quot;H&quot;, &quot;name&quot; : &quot;H_route&quot;,       &quot;width&quot; : 4,   &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 0},<br/>                      {&quot;type&quot; : &quot;H&quot;, &quot;name&quot; : &quot;H_tid&quot;,           &quot;width&quot; : 1,   &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 0},<br/>                      {&quot;type&quot; : &quot;H&quot;, &quot;name&quot; : &quot;H_sid&quot;,          &quot;width&quot; : 1,   &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 0},<br/>                      {&quot;type&quot; : &quot;H&quot;, &quot;name&quot; : &quot;H_tier&quot;,          &quot;width&quot; : 4,   &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 0}, <br/>                      {&quot;type&quot; : &quot;H&quot;, &quot;name&quot; : &quot;H_dp_pres&quot;,  &quot;width&quot; : 4,   &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 0},<br/>                      {&quot;type&quot; : &quot;H&quot;, &quot;name&quot; : &quot;H_ndp_len&quot;,  &quot;width&quot; : 5,   &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 0},<br/>                      {&quot;type&quot; : &quot;H&quot;, &quot;name&quot; : &quot;H_ndp_data&quot;,&quot;width&quot; : 32, &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 0,<br/>                      {&quot;type&quot; : &quot;C&quot;, &quot;name&quot; : &quot;C_last_0&quot;,      &quot;width&quot; : 1,   &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;LAST&quot;, &quot;payload&quot; : 1},<br/>                      {&quot;type&quot; : &quot;F&quot;, &quot;name&quot; : &quot;F_user_0&quot;,     &quot;width&quot; : 8,   &quot;minWidth&quot; : 1, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 1},<br/>                      {&quot;type&quot; : &quot;F&quot;, &quot;name&quot; : &quot;F_be_0&quot;,        &quot;width&quot; : 8,   &quot;minWidth&quot; : 1, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 1},<br/>                      {&quot;type&quot; : &quot;F&quot;, &quot;name&quot; : &quot;F_data_0&quot;,     &quot;width&quot; : 64, &quot;minWidth&quot; : 8, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 1},<br/>                      {&quot;type&quot; : &quot;N&quot;, &quot;name&quot; : &quot;NULL_0&quot;,       &quot;width&quot; : 48, &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 1},<br/>                      {&quot;type&quot; : &quot;C&quot;, &quot;name&quot; : &quot;C_last_1&quot;,      &quot;width&quot; : 1,   &quot;minWidth&quot; : 0, &quot;mf&quot; : &quot;LAST&quot;, &quot;payload&quot; : 1},<br/>                      {&quot;type&quot; : &quot;F&quot;, &quot;name&quot; : &quot;F_user_1&quot;,     &quot;width&quot; : 8,   &quot;minWidth&quot; : 1, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 1},<br/>                      {&quot;type&quot; : &quot;F&quot;, &quot;name&quot; : &quot;F_be_1&quot;,        &quot;width&quot; : 8,   &quot;minWidth&quot; : 1, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 1},<br/>                      {&quot;type&quot; : &quot;F&quot;, &quot;name&quot; : &quot;F_data_1&quot;,     &quot;width&quot; : 64, &quot;minWidth&quot; : 8, &quot;mf&quot; : &quot;&quot;, &quot;payload&quot; : 1}]</p><h1 id="HW-SYMpacketDesc-HeaderRestrictions(Rev1.0)">Header Restrictions (Rev 1.0)</h1><ol><li>The Header fields are same for a given packet type per fabric (post Rev1.0 also) - and there will be only one packet type supported.</li><li>The Header field positions can not be changed from link to link for a given fabric.</li><li>The H_NDP (non data payload) field must always be the last field of the header. Post Rev1.0, NDP will be moved out of header.</li><li>Header is always single PHIT, the first PHIT (Header Parallel or Full Header Serial) for primary fabric.</li><li>Only fabric to support split header (fixed serial mode) is the configuration fabric, with following restrictions:<br/>- Fields used for Route must be in first PHIT of the packet<br/>- No Header field should be split except for Address<br/>- There is no NDP</li><li>Only one payload.</li></ol><h1 id="HW-SYMpacketDesc-CreatingaLinkPacketDefinitionfromaBasePacketDefinition:">Creating a Link Packet Definition from a Base Packet Definition:</h1><h2 id="HW-SYMpacketDesc-1)Createaregressareausingthestandardscripts:">1) Create a regress area using the standard scripts:</h2><p><br/> mkdir regress<br/> cd regress <br/> /engr/dev/tools/script/setup_sym -d master</p><pre> source SOURCEME.tcsh (Theres a SOURCEME.bash also available)</pre><h2 id="HW-SYMpacketDesc-2)Godowntothebringupdirectoryforthelibrary:">2) Go down to the bringup directory for the library:</h2><pre> cd hw/rtl/lib/bringup</pre><h2 id="HW-SYMpacketDesc-3)Theresashscriptlocatedherecalled:">3) Theres a sh script located here called:</h2><p>basePktParams2lnkPktCpr.sh</p><h2 id="HW-SYMpacketDesc-4)Ifjustrunit,youwillgetusageinfo:">4) If just run it, you will get usage info:</h2><div><pre><br/></pre><pre>[jcodd@mondavi bringup]$ ./basePktParams2lnkPktCpr.sh BasePktParamsExpl.json 32 fixed PacketFixed </pre><pre>ERROR: ./basePktParams2lnkPktCpr.sh Not enough arguments</pre><pre>USAGE: ./basePktParams2lnkPktCpr.sh $1 $2 $3 $4 $5</pre><pre>  $1 = base packet parameters</pre><pre>  $2 = target data width</pre><pre>  $3 = packet type (parallel, serial or fixed)</pre><pre>  $4 = name to give link packet object</pre><pre>  $5 = number of VCs in ATP interface</pre><pre><br/></pre><pre>Program generates two files:</pre><pre>  $4.packet.cpr: link packet object definition</pre><pre>  $4_atp.json:   InterfaceATP params</pre></div><pre> ./basePktParams2lnkPktCpr.sh BasePktParamsExpl.json 32 serial PacketSerial</pre><h2 id="HW-SYMpacketDesc-4)Anexample(butnotlegalandmaybeold)ofabasepacketparametersfilelookssomethinglike:">4) An example (but not legal and maybe old) of a base packet parameters file looks something like:</h2><div><pre>{<br/>  &quot;params&quot; :{<br/>    &quot;wH_vnid&quot;: 0,<br/>    &quot;wH_txn_resp&quot;: 0,<br/>    &quot;wH_txn_hdr_region&quot;: 0,<br/>    &quot;wH_txn_hdr_memattr&quot;: 5,<br/>    &quot;wH_txn_hdr_maxbsize&quot;: 5,<br/>    &quot;wH_txn_hdr_btype&quot;: 5,<br/>    &quot;wH_txn_hdr_bsize&quot;: 3,<br/>    &quot;wH_txn_hdr_atomic&quot;: 2,<br/>    &quot;wH_tier&quot;: 2,<br/>    &quot;wH_tid&quot;: 4,<br/>    &quot;wH_steer&quot;: 2,<br/>    &quot;wH_sid&quot;: 4,<br/>    &quot;wH_sec_fail&quot;: 1,<br/>    &quot;wH_sec&quot;: 5,<br/>    &quot;wH_route&quot;: 6,<br/>    &quot;wH_qos&quot;: 0,<br/>    &quot;wH_pri&quot;: 0,<br/>    &quot;wH_pkt_type&quot;: 0,<br/>    &quot;wH_pkt_multi&quot;: 0,<br/>    &quot;wH_pkt_id&quot;: 2,<br/>    &quot;wH_ordering_model&quot;: 0,<br/>    &quot;wH_ordering_id&quot;: 0,<br/>    &quot;wH_ndp_len&quot;: 0,<br/>    &quot;wH_ndp_data&quot;: 0,<br/>    &quot;wH_multi&quot;: 0,<br/>    &quot;wH_msg_user&quot;: 0,<br/>    &quot;wH_msg_type_attr&quot;: 4,<br/>    &quot;wH_msg_type&quot;: 4,<br/>    &quot;wH_msg_seqnum&quot;: 0,<br/>    &quot;wH_msg_sec&quot;: 0,<br/>    &quot;wH_msg_qos&quot;: 0,<br/>    &quot;wH_msg_len&quot;: 0,<br/>    &quot;wH_msg_id&quot;: 1,<br/>    &quot;wH_msg_err&quot;: 1,<br/>    &quot;wH_chl_id&quot;: 1,<br/>    &quot;wH_addr&quot;: 16,<br/>    &quot;wF_user&quot;: 256,<br/>    &quot;wF_userMin&quot;: 4,<br/>    &quot;wF_data&quot;: 512,<br/>    &quot;wF_dataMin&quot;: 8, <br/>    &quot;wF_prot&quot;: 0,<br/>    &quot;wF_protMin&quot;: 0, <br/>    &quot;wF_be&quot;: 64,<br/>    &quot;wF_beMin&quot;: 1,<br/>    &quot;wC_resp&quot;: 1,<br/>    &quot;wC_last&quot;: 1,<br/>    &quot;wC_err&quot;: 1,<br/>    &quot;wC_dummy&quot;: 1<br/>  }<br/>}</pre></div><h2 id="HW-SYMpacketDesc-5)Runningtheprogramgivesyouresultssomethinglike:">5) Running the program gives you results something like:</h2><pre>[jcodd@mondavi bringup]$ ./basePktParams2lnkPktCpr.sh BasePktParamsExpl.json 32 serial PacketSerial 1<br/>Bus width: 74<br/>max_beats: 17<br/>header_width: 74<br/>max_header_field_width: 6<br/>data_beat_multiplier: 4<br/>data_beat_width: 56<br/>min_data_beat_width_F: 13<br/>min_data_beat_width_C: 4<br/>min_data_width: 8<br/>number_data_beats: 16<br/>null bits to total bits: 0.2289348171701113<br/>data bits to beat bits: 0.7567567567567568<br/>[jcodd@mondavi bringup]$ ./basePktParams2lnkPktCpr.sh BasePktParamsExpl.json 32 parallel PacketParallel 1<br/>Bus width: 130<br/>max_beats: 16<br/>header_width: 74<br/>max_header_field_width: 6<br/>data_beat_multiplier: 4<br/>data_beat_width: 56<br/>min_data_beat_width_F: 13<br/>min_data_beat_width_C: 4<br/>min_data_width: 8<br/>number_data_beats: 16<br/>null bits to total bits: 0.5336538461538461<br/>data bits to beat bits: 0.4307692307692308<br/>[jcodd@mondavi bringup]$ ./basePktParams2lnkPktCpr.sh BasePktParamsExpl.json 32 fixed PacketFixed 1<br/>Bus width: 56<br/>max_beats: 18<br/>header_width: 74<br/>max_header_field_width: 6<br/>data_beat_multiplier: 4<br/>data_beat_width: 56<br/>min_data_beat_width_F: 13<br/>min_data_beat_width_C: 4<br/>min_data_width: 8<br/>number_data_beats: 16<br/>null bits to total bits: 0.037698412698412696<br/>data bits to beat bits: 1</pre><pre><br/></pre>