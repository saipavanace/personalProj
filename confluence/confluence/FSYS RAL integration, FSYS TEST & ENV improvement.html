<style type="text/css">/*<![CDATA[*/
div.rbtoc1759725027680 {padding: 0px;}
div.rbtoc1759725027680 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1759725027680 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1759725027680"><style>[data-colorid=kyzl7bmwh1]{color:#bf2600} html[data-color-mode=dark] [data-colorid=kyzl7bmwh1]{color:#ff6640}[data-colorid=vmwnit7g6q]{color:#bf2600} html[data-color-mode=dark] [data-colorid=vmwnit7g6q]{color:#ff6640}[data-colorid=vhc8g74vtx]{color:#bf2600} html[data-color-mode=dark] [data-colorid=vhc8g74vtx]{color:#ff6640}[data-colorid=m0bgnt6w7e]{color:#bf2600} html[data-color-mode=dark] [data-colorid=m0bgnt6w7e]{color:#ff6640}[data-colorid=s6ss6efpfr]{color:#bf2600} html[data-color-mode=dark] [data-colorid=s6ss6efpfr]{color:#ff6640}[data-colorid=i3t5cf6n3h]{color:#bf2600} html[data-color-mode=dark] [data-colorid=i3t5cf6n3h]{color:#ff6640}[data-colorid=vvgaxxq0ui]{color:#bf2600} html[data-color-mode=dark] [data-colorid=vvgaxxq0ui]{color:#ff6640}[data-colorid=p0rft8wcpt]{color:#bf2600} html[data-color-mode=dark] [data-colorid=p0rft8wcpt]{color:#ff6640}[data-colorid=ul0lw9cglh]{color:#bf2600} html[data-color-mode=dark] [data-colorid=ul0lw9cglh]{color:#ff6640}[data-colorid=hklt6f25ge]{color:#bf2600} html[data-color-mode=dark] [data-colorid=hklt6f25ge]{color:#ff6640}[data-colorid=gro0lbuftg]{color:#bf2600} html[data-color-mode=dark] [data-colorid=gro0lbuftg]{color:#ff6640}</style>
<ul class="toc-indentation">
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Goals">Goals</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Backdoor">Backdoor</a>
<ul class="toc-indentation">
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-WithQuesta">With Questa</a>
<ul class="toc-indentation">
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Constraints">Constraints</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Build">Build</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Conclusion">Conclusion</a></li>
</ul>
</li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-WithVCS(evaluationTODO)">With VCS (evaluation TO DO)</a></li>
</ul>
</li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-NewBoot:">New Boot:</a>
<ul class="toc-indentation">
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Goals.1">Goals</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Build.1">Build</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Writeregisterrecommendation">Write register recommendation</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Demoter">Demoter</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Conclusion.1">Conclusion</a></li>
</ul>
</li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-RestructuringFSYSTEST">Restructuring FSYS TEST</a>
<ul class="toc-indentation">
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-LegacyFSYSteststructure">Legacy FSYS test structure</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-NewFSYSteststructure">New FSYS test structure</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Createanewtestcase">Create a new test case</a>
<ul class="toc-indentation">
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-1-Start_of_simulationphase">1- Start_of_simulation phase</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-2-Main_phase">2- Main_phase</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-3-exec_inhouse_seqtask">3-exec_inhouse_seq task</a></li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-4-hooktask">4- hook task</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-RestructuringFSYSENV">Restructuring FSYS ENV</a>
<ul class="toc-indentation">
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Rules">Rules</a></li>
</ul>
</li>
<li><a href="#FSYSRALintegration,FSYSTEST&amp;ENVimprovement-RestructuringFSYSSEQUENCE&amp;VirtualSEQUENCE&lt;ONGOING>">Restructuring FSYS SEQUENCE &amp; Virtual SEQUENCE &lt;ONGOING&gt; Naveen Rajagopal</a></li>
</ul>
</div><h1 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Goals"><u>Goals</u></h1><ol start="1"><li><p>RAL integration to allow use directly the env.ral.agent.reg.field.value in unit scoreboard instead of assign directly in the value in the scoreboard, use the DB or a probe the apb bus to capture the configuration.</p></li><li><p>New boot + BACKDOOR accesses&nbsp; to accelerate the fsys simulation</p></li><li><p>restructure the full sys and use the uvm_phase (put the boot in the configure_phase) create a test_cfg != env_cfg </p></li></ol><h1 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Backdoor"><u>Backdoor</u></h1><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-WithQuesta"><u>With Questa</u></h2><h3 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Constraints"><u>Constraints</u></h3><p>With Questa , we have to enable the compilation +acc=rpn in the scripts/rsimMethods.js</p><p>instead of <code>&nbsp;vopt_cmd = vopt_cmd + ' +acc=r +noacc+tb_top.';</code></p><p>to allow the backdoor access</p><h3 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Build"><u>Build</u></h3><p>We create a class to update the RAL generate by ral_gen to add the path:</p><p>We extract the path with JS scripts from the JSON file &amp; known structure of the DUT.</p><p class="media-group"><a href="/wiki/spaces/ENGR/pages/242024468/FSYS+RAL+integration+FSYS+TEST+ENV+improvement?preview=%2F242024468%2F242515995%2Fconcerto_register_map_ext.svh"><span style="background: url('/wiki/s/-672721829/6452/d621ad2a33e27b90ca05c475b216bfab745e08a2/1000.0.0-d621ad2a33e2/_/download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-file.png'); width: 250px; height: 95px; display: inline-block; padding-top: 155px; margin: 2px; border: 1px solid #ddd; text-align: center; vertical-align: text-bottom; text-decoration: none; font-size: 12px; color: #000;">concerto_register_map_ex&hellip;</span></a></p><p>During the build_phase , we update the ral path:</p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" width="544" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230530-112354.png?api=v2" /></span><p>We use <code>set_hdl_path_root</code> &amp; <code>add_hdl_path_slice </code>in the generated lines:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230530-113244.png?api=v2" /></span><p>A example of generated file for the hw_cfg_45:</p><p class="media-group"><a href="/wiki/spaces/ENGR/pages/242024468/FSYS+RAL+integration+FSYS+TEST+ENV+improvement?preview=%2F242024468%2F242155539%2Fconcerto_register_map_ext+%5Bgenerated%5D.svh"><span style="background: url('/wiki/s/-672721829/6452/d621ad2a33e27b90ca05c475b216bfab745e08a2/1000.0.0-d621ad2a33e2/_/download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-file.png'); width: 250px; height: 95px; display: inline-block; padding-top: 155px; margin: 2px; border: 1px solid #ddd; text-align: center; vertical-align: text-bottom; text-decoration: none; font-size: 12px; color: #000;">concerto_register_map_ex&hellip;</span></a></p><h3 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Conclusion"><u>Conclusion</u></h3><p><strong><span data-colorid="i3t5cf6n3h">There are no gain to use BACKDOOR in simulation &amp; memory footprint</span></strong> </p><p>We haven&rsquo;t the granularity in the +acc=rpn option and so<span data-colorid="vvgaxxq0ui"> </span><strong><span data-colorid="m0bgnt6w7e">the memory footprint skyrocketed without any gain in simulation.</span></strong><br /></p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230530-114657.png?api=v2" /></span><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-WithVCS(evaluationTODO)">With VCS (evaluation TO DO)</h2><h1 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-NewBoot:"><u>New Boot:</u></h1><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Goals.1"><u>Goals</u></h2><ol start="1"><li><p>use the uvm_phase &amp; push the boot sequence in the configure_phase.</p></li><li><p>Use the RAL capability to access mirrored value</p></li><li><p>Boot on the APB debug port</p></li><li><p>restructure the boot to allow a initialisation of the DMI, IOAIU &amp; DCE memory in parallel</p></li><li><p>create a concerto_test_cfg to pilot the CSR setup sequence with specific plusargs</p></li></ol><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Build.1"><u>Build</u></h2><p>1- we created 2 new uvm_component : full_sys/tests/concerto_boot_tasks.svh &amp; full_sys/tests/concerto_test_cfg.svh which are only created in the concerto_fullsys_test (will be removed in the concerto_base_test soon ) then they are automatically launch during the uvm_phase.<br /></p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" width="340" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230530-121506.png?api=v2" /></span><p><strong><span data-colorid="vmwnit7g6q">We are using the both phase run_phase &amp; the set of phases in parallel in the concerto_fullsys_test because some sequences aren&rsquo;t depend of the others phase &amp; avoid some issues with the sequencer during phase transition. </span></strong></p><p>2- We will able to access to reg &amp; field with <code>m_concerto_env.m_regs.get_reg_by_name(&quot;&lt;REG NAME&gt;).get_field_by_name(&quot;&lt;Field name&gt;&quot;).value</code><br />we <code>m_concerto_env.m_regs.get_reg_by_name(&quot;&lt;REG NAME&gt;).reset()</code> all registers to initialize all the mirrored values.  <br />During the boot with use the .write(..) &amp; .read(&hellip;) ral method to access &amp; update the mirrored values.<br />3-  </p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230530-120856.png?api=v2" /></span><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230530-120810.png?api=v2" /></span><p>4-  </p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230530-121317.png?api=v2" /></span><p>5- We decided to create a specific object to configure the test.  Env_cfg will be use in the creation of uvm object &amp; specific static parameter regarding a hardware configure and args_units is more use in case of constraints randomization.</p><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Writeregisterrecommendation"><span data-colorid="ul0lw9cglh">Write register recommendation</span></h2><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230729-164724.png?api=v2" /></span><p><span data-colorid="hklt6f25ge">As, we can write full reg only and not only the field. we recommend to use the common task ral_fill_field</span><br /><span data-colorid="vhc8g74vtx">We can get the register with get_reg_by_name.</span></p><p><span data-colorid="p0rft8wcpt">Then, we get the value of the whole register with get_reset or get_mirrored_value.</span></p><p><span data-colorid="gro0lbuftg">Then fill the field with field name &amp; value.</span></p><p><span data-colorid="s6ss6efpfr">When all the field are written. Use uvm_reg.write to write the mirrored &amp; RTL register via the APB debug port.</span></p><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Demoter"><u>Demoter</u><br /></h2><p>To avoid to have too many messages in the log with demote some UVM warning.<br /></p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230609-192503.png?api=v2" /></span><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Conclusion.1"><br /><u>Conclusion</u></h2><p><strong><span data-colorid="kyzl7bmwh1">We have only  a gain of 10% in the simulation with the new boot.</span></strong> It seems the simulator pass more time in the main phase during the real txn stimulus phase (all the agents are working in same time with large logical cone).</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230530-123836.png?api=v2" /></span><h1 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-RestructuringFSYSTEST"><u>Restructuring FSYS TEST</u><br /></h1><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-LegacyFSYSteststructure"><u>Legacy FSYS test structure</u></h2><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230727-142319.png?api=v2" /></span><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-NewFSYSteststructure"><u>New FSYS test structure</u></h2><p>We are:<br /> - using the uvm_phase by heritage or by instantiation <br /> - using more heritage<br /> - specializing the class<br />to allow</p><ul><li><p>reusability</p></li><li><p>easier to debug</p></li><li><p>maintainability<br /></p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230609-193741.png?api=v2" /></span></li></ul><p /><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Createanewtestcase">Create a new test case</h2><p>By default, the concerto_fullsys_test generate random txn  from plusargs setup.</p><p>We have many possibilities to extend the concerto_fullsys_test:</p><h3 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-1-Start_of_simulationphase">1- Start_of_simulation phase</h3><p>We can modify the weight of txn in start_of_simulation phase  example: concerto_bootregion_test = only noncoh txn</p><h3 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-2-Main_phase">2- Main_phase</h3><p>we can overwrite (ex: concerto_bootregion_test) or extend the main phase ( ex : concerto_fullsys_perfmon_legacy_test  setup perfmon registers before super.main_phase) </p><h3 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-3-exec_inhouse_seqtask">3-exec_inhouse_seq task</h3><p>This task launch all the txn sequences in the main_phase. We can overwrite this task in the main phase (ex: <code>concerto_fullsys_direct_wr_rd_legacy_test</code>) and continue to use the wait_seq_totally_done &amp; final check from concerto_fullsys_test main phase.</p><h3 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-4-hooktask">4- hook task</h3><p>We have create some empty virtual tasks in the concerto_fullsys_test which can be used in the child object.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence">virtual task main_seq_pre_hook(uvm_phase phase); endtask// before the iteration (outside the iteration loop)
virtual task main_seq_post_hook(uvm_phase phase); endtask// after the iteration (outside the iteration loop)
virtual task main_seq_iter_pre_hook(uvm_phase phase, int iter=0); endtask// at the beginning of the iteration(inside the iteration loop)
virtual task main_seq_iter_post_hook(uvm_phase phase, int iter=0); endtask// at the end of the iteration (inside the iteration)
virtual task main_seq_hook_end_run_phase(uvm_phase phase); endtask</pre>
</div></div><p>By default, we have only 1 iterations in concerto_fullsys_test</p><p>We implemented a forloop with max_iteration value which can be overwrite in the child object and so we loop and send the same number of txn . We use this hook function to setup between 2 iterations the CSR , the environment  or check some CSR values. (ex: <code>concerto_fullsys_perfmon_test</code> we check &amp; reset the perfmon after each iterations)</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="https://arterisip.atlassian.net/wiki/download/attachments/242024468/image-20230729-170052.png?api=v2" /></span><p /><h1 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-RestructuringFSYSENV"><u>Restructuring FSYS ENV</u></h1><h2 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-Rules">Rules</h2><p>Concerto_env instantiate 2 specific envs: concerto_env_inhouse &amp; concerto_env_snps</p><p>All agents, sequencer &amp; scoreboard are instantiate in their specific concerto_env  inhouse or synopsys (snps)</p><p>We build only the agent corresponding to the has_XXX_vip_snps case or inhouse by default</p><p>&hellip;. &lt;ONGOING&gt;</p><p /><h1 id="FSYSRALintegration,FSYSTEST&amp;ENVimprovement-RestructuringFSYSSEQUENCE&amp;VirtualSEQUENCE&lt;ONGOING>"><u>Restructuring FSYS SEQUENCE &amp; Virtual SEQUENCE &lt;ONGOING&gt; </u><a class="confluence-userlink user-mention" data-account-id="624b378f699649006ae98ff1" href="https://arterisip.atlassian.net/wiki/people/624b378f699649006ae98ff1?ref=confluence" target="_blank" data-linked-resource-id="789132" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://arterisip.atlassian.net/wiki">Naveen Rajagopal</a> </h1>