<h2 id="MaestroModularDevelopment-Introduction">Introduction</h2><p>Maestro development methodology utilizes two mechanisms for modular development: packages, and submodules.  The usage for each is summarized below</p><ul><li>packages – relies on the C++ package management system conan.io (<a class="external-link" href="https://conan.io)" rel="nofollow">https://conan.io)</a>– this allows for the independent development and build of software components.  Maestro utilizes a package when it is desirable to have a separate build that is then integrated into the Maestro.</li><li>submodules – relies on the git submodule system – this allows for the independent development of software components.  Maestro utilizes a submodule when it is desirable to have separate repositories/development tracks but it is still desirable or acceptable for the Maestro build to include building said module.</li></ul><p>This document provides information on the setup and use of both mechanisms.</p><h2 id="MaestroModularDevelopment-Packages">Packages</h2><p>Packages are managed by a server running on gr6-3.  The server is responsible for storing package source-files along with pre-built binaries.  Pre-built binaries can be included by Maestro software components to reduce build-time and ensure that all components utilize a consist set of binaries.</p><p>Before being able to utilize packages, each user needs to setup a pointer to Arteris's package repository and their own user cache:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">conan config install /scratch3/maestro/conan/config/conan_config_arteris.tar.gz </pre>
</div></div><p>For more information on the use of packages,and how to create packages, consult the conan.io documentation: <a class="external-link" href="http://docs.conan.io/en/latest/" rel="nofollow">http://docs.conan.io/en/latest/</a></p><h2 id="MaestroModularDevelopment-Submodules">Submodules</h2><p>Submodules are first-class git repositories that are linked to by the main Maestro project.  Note that the link is to a particular commit of the submodule, and NOT the head.  This means that Maestro will not automatically track the latest commit of a submodule without manual intervention.  This allows for submodule development to advance without breaking the main Maestro development.</p><p>Below are git command templates for common operations:</p><ul><li><p>Update working copy from remote repository</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;ensure clean directory structure without any uncommitted modifications&gt;
&lt;can use git stash / git stash pop to store modifications&gt;
$ git pull --rebase
&lt;resolve conflicts&gt;
$ git submodule update 
&lt;if new submodules were added&gt;
$ git submodule update --init</pre>
</div></div></li><li><p>Initialize submodules (needed on checkout and when new submodules are added)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">git submodule update --init</pre>
</div></div></li><li><p>Update a particular submodule to the latest.  Note the additional add/commit and push</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">$ git submodule update --remote contrib/thirdparty
remote: Counting objects: 343, done.
...
c2f5271..789ad2c master -&gt; origin/master
Submodule path &#39;contrib/thirdparty&#39;: checked out &#39;789ad2ce5c7c491077d4f4933308502abe4ef522&#39;
$ git add contrib/thirdparty
$ git commit -m &quot;Updated submodule contrib/thirdparty to commit 789ad2ce5c7&quot;
$ git push</pre>
</div></div></li><li><p>Update all submodules to the latest</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">git submodule update --remote</pre>
</div></div></li><li>Update and make changes to a submodule when development from a Maestro working copy<br/><ol><li><p>Ensure that the  submodule is not in a &quot;detached head' state, but on a particular branch (ex. master)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">$ git status
HEAD detached at c2f5271
$ git checkout master
$ git status 
On branch master</pre>
</div></div></li><li><p>Perform normal development on submodule</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">$ git add &lt;xxx&gt;
$ git commit 
$ git push</pre>
</div></div></li><li><p>Integrate changes into main Maestro and update submodule to the last commit</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">$ cd ../../
$ git status
On branch master
Your branch is up-to-date with &#39;origin/master&#39;.
Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)
        modified:   contrib/libdm (new commits)
$ git add contrib/libdm
$ git commit
$ git push</pre>
</div></div></li><li><strong>Remember to push both the submodule and Maestro commits</strong><br/><br/></li></ol></li><li><p>I forgot to change my submodule to the branch before making a commit! To move orphan commits to the main branch, use git cherry-pick (<a class="external-link" href="https://git-scm.com/docs/git-cherry-pick" rel="nofollow">https://git-scm.com/docs/git-cherry-pick</a>)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">$ git checkout master
Warning: you are leaving 1 commit behind, not connected to
any of your branches:
  c7e101f Test
...
 
$ git cherry-pick c7e101f 
 
&lt;if there are merge conflicts, resolve conflicts and continue&gt;
error: could not apply c7e101f... Test
hint: after resolving the conflicts, mark the corrected paths
hint: with &#39;git add &lt;paths&gt;&#39; or &#39;git rm &lt;paths&gt;&#39;
hint: and commit the result with &#39;git commit&#39;
$ vi &lt;&gt;
$ git add &lt;&gt;
$ git cherry-pick --continue</pre>
</div></div></li></ul><p>For more information on submodules, refer to the following third-party documentation:</p><ul><li><a class="external-link" href="https://medium.com/@porteneuve/mastering-git-submodules-34c65e940407" rel="nofollow">https://medium.com/@porteneuve/mastering-git-submodules-34c65e940407</a></li><li><a class="external-link" href="https://www.activestate.com/blog/2014/05/getting-git-submodule-track-branch" rel="nofollow">https://www.activestate.com/blog/2014/05/getting-git-submodule-track-branch</a></li></ul>