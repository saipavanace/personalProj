<p>Like for any other commands, broadly speaking, creating a new command involves:</p><ul><li><p>Implementing an AdmRequest in <code>libaccess</code> and its unit tests,</p></li><li><p>Implementing a command in <code>libcmd</code> and writing a TCL test,</p></li><li><p>Providing a GUI frontend if appropriate.</p></li></ul><p>The information below is specifically for debug or license-restricted commands.</p><h2 id="Authoringdebugorlicense-restrictedTCLcommandsinMaestro-Commandsthatarerestrictedtothedebuglicense">Commands that are restricted to the debug license</h2><p>This applies to commands that must be completely inaccessible to users without the debug license.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The current list of relevant commands is:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">AddLicenseCmd            // Developer only
ConnectivityCmd          // Awaiting productization
DisableDebugCmd          // Developer only
EnableDebugCmd           // Developer only
ExportDesignCmd          // Awaiting productization
ExportRoutesCmd          // Awaiting productization?
ForceCrashCmd            // Developer only
GenGlobalCollateralCmd   // Awaiting productization
PrintRoutesCmd           // Awaiting productization?
SetSocketDependencyCmd   // Awaiting productization?
SetTemporaryConfigCmd    // Developer only
StopOnErrorsCmd          // Developer only
UndoStackCmd             // Developer only</pre>
</div></div><p>This list can change over time as new restricted commands are added, commands are promoted to user-visible, or commands are hidden.</p></div></div><ul><li><p>To ensure that the command isn’t accessible to users without the license, in <code>contrib/libcmd/src/tclCmdRegistration.cc</code>, the registration must be in the <code>if (maestro::adm::isDebugLicenseAvailable()) {}</code> clause. This ensures that the command either exists or not; the decision is made at Maestro boot based on the license file in the environment.</p></li><li><p>The following are good policies:</p><ul><li><p>The TCL command should have a <code>debug_</code> prefix, even though the <code>Cmd</code> file in <code>libcmd</code> should not (in view of possible future productization). For example, <code>ForceCrashCmd</code> provides <code>debug_force_crash</code>. This reinforces awareness that the command is for internal use. If later the command is productized, the <code>debug_</code> prefix must be dropped.</p></li><li><p>The command should have the string <code>(DEBUG LICENSE COMMAND ONLY!) </code> prefix in its <code>setShortDescription()</code> and <code>setDescription()</code> APIs. This is so that developers/AEs are reminded that these commands are not accessible to regular users.</p></li><li><p>The TCL command should have <code>setCategory(&quot;Hidden&quot;);</code> to further ensure it doesn’t show up in the output of the <code>help</code> command. Only users that have the debug license will be able to ask for help, e.g. with <code>&lt;commandname&gt; -help</code> or <code>help -hidden</code>. Note that this is somewhat redundant because, without the debug license, the command won’t exist at all - including in the help; but this still provides a further layer of protection against misuse if something goes wrong in the field.</p></li></ul></li></ul><h2 id="Authoringdebugorlicense-restrictedTCLcommandsinMaestro-Commandsthatarerestrictedtoanotherlicensefeature">Commands that are restricted to another license feature</h2><p>This applies to commands that must be completely inaccessible to users without a specific license feature.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The current list of relevant commands is:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">// LEFDEF license commands
ImportFloorplanLefDefCmd
ImportFloorplanBackgroundCmd
MoveObjectCmd
ReportLinkSegmentsCmd
SetObjectOrientationCmd

// VISU license commands
ImportPerformanceDataCmd</pre>
</div></div><p>This list can change over time.</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>We cannot presently make commands selectively <em>exist or not</em> based on a license feature, like <code>LEFDEF</code> or <code>VISU</code>. This is because command registration is done at Maestro boot time, while the availability of these features becomes known at project creation/loading time. We would need to support incremental command registration/deregistration to make the commands appear and disappear as the customer loads projects with or without access to those features. Instead, we have to ensure the command always exists, and check for the license on invocation.</p></div></div><ul><li><p>It is <strong>mandatory </strong>for these commands to perform license checks in the <code>tclCallback()</code> method. For example, <code>MoveObjectCmd::tclCallback()</code> checks for the <code>LEFDEF</code> license before doing anything.</p></li><li><p>It is <strong>optionally </strong>possible for these commands to remind the user about license requirements in <code>setShortDescription()</code> or <code>setDescription()</code>.</p></li><li><p>It is <strong>recommended</strong> that when checking for the required license, the commands allow the debug license as an alternative. This means that a developer with such a license, or Jenkins, can test the capabilities without restrictions even if the specific license is not available. The license server can be pointed to one that does not contain the debug license when trying to do negative testing.</p></li></ul><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>All our current examples of these commands also presently have <code>setCategory(“Hidden”)</code>. The reasons are explained below under “Other Restrictions”. </p></div></div><h2 id="Authoringdebugorlicense-restrictedTCLcommandsinMaestro-Commandsthathavearestrictedoption">Commands that have a restricted option</h2><ul><li><p>If the option is conditional on the debug license, then the most efficient way to disable access to it is to completely skip the registration of the option in the constructor of the command. For example, <code>GetParameterCmd::GetParameterCmd()</code> does not register the <code>-hidden</code> option if the debug license isn’t detected. In such a case, the option will not work and will not be presented in the <code>help</code>.</p></li><li><p>If the option is conditional on another license feature, then the initial registration must be performed, but the checks must be done in the <code>tclCallback()</code> method. For example, <code>GenCollateralCmd::tclCallback()</code> checks for the <code>SYSC</code> license before allowing certain options to perform their work.</p></li></ul><h2 id="Authoringdebugorlicense-restrictedTCLcommandsinMaestro-Otherrestrictions">Other restrictions</h2><ul><li><p>For some commands, we enforce <code>setCategory(&quot;Hidden&quot;);</code> to ensure they don’t show up in the help. This includes:</p><ul><li><p>Commands that we have deprecated, like <code>query_attribute</code> (use <code>get_parameter</code> instead).</p></li><li><p>Commands that, in addition to being subject to a license, we don’t want the user to know about because the development is confidential. All commands that are conditional on the <code>VISU</code> and <code>LEFDEF</code> license are also hidden, because we don’t publicly disclose that Maestro has initial support for those capabilities.</p></li><li><p>Commands like <code>source_encrypted_tcl</code>, which, while not dangerous, usually only serve internal functions, and are not useful to users.</p></li><li><p>A user that knows about the existence of these commands (typically, only Arteris internals) can still get help with <code>help -hidden</code> (itself subject to an additional debug license check), or <code>&lt;commandname&gt; -help</code>.</p></li></ul></li></ul>